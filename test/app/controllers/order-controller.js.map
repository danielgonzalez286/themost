{"version":3,"sources":["app/controllers/order-controller.es6"],"names":["Q","_","HttpDataController","httpAction","httpGet","httpController","url","LangUtils","TraceUtils","OrderController","context","result","hasOwnProperty","urlObject","parse","request","$skip","parseInt","query","$top","total","$count","search","format","assign","skip","nextLink","getNextLink","prevLink","getPrevLink","value","nbind"],"mappings":";;;;;;;;;;;wDAAA;;;;;;;;;;AAQA;;IAAOA,C;;AACP;;IAAOC,C;;AACP;;IAAOC,kB;;AACP;;IAAQC,U,eAAAA,U;IAAYC,O,eAAAA,O;IAASC,c,eAAAA,c;;AAC7B;;IAAOC,G;;AACP;;IAAQC,S,UAAAA,S;;AACR;;IAAQC,U,WAAAA,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAGaC,e,WADpBJ,gB,UAkDID,S,UACAD,WAAW,OAAX,C;;;AAhDD,6BAAYO,OAAZ,EAAqB;AAAA;;AAAA,iIACXA,OADW;AAEpB;;;;oCAEWC,M,EAAQ;AAChB,gBAAIA,OAAOC,cAAP,CAAsB,OAAtB,CAAJ,EAAoC;AAChC,oBAAMC,YAAYP,IAAIQ,KAAJ,CAAU,KAAKJ,OAAL,CAAaK,OAAb,CAAqBT,GAA/B,EAAoC,IAApC,CAAlB;AACA;AACA,oBAAMU,QAAQT,UAAUU,QAAV,CAAmBJ,UAAUK,KAAV,CAAgBF,KAAnC,CAAd;AACA,oBAAMG,OAAOZ,UAAUU,QAAV,CAAmBJ,UAAUK,KAAV,CAAgBC,IAAnC,KAA4C,EAAzD;AACA,oBAAIR,OAAOS,KAAP,IAAcJ,QAAMG,IAAxB,EAA8B;AAC1BN,8BAAUK,KAAV,CAAgBF,KAAhB,GAAwBA,QAAMG,IAA9B;AACAN,8BAAUK,KAAV,CAAgBC,IAAhB,GAAuBA,IAAvB;AACAN,8BAAUK,KAAV,CAAgBG,MAAhB,GAAyB,IAAzB;AACA,2BAAOR,UAAUS,MAAjB;AACA,2BAAOhB,IAAIiB,MAAJ,CAAWV,SAAX,CAAP;AACH;AACJ;AACJ;;;oCAEWF,M,EAAQ;AAChB,gBAAIA,OAAOC,cAAP,CAAsB,OAAtB,CAAJ,EAAoC;AAChC,oBAAMC,YAAYP,IAAIQ,KAAJ,CAAU,KAAKJ,OAAL,CAAaK,OAAb,CAAqBT,GAA/B,EAAoC,IAApC,CAAlB;AACA;AACA,oBAAMU,QAAQT,UAAUU,QAAV,CAAmBJ,UAAUK,KAAV,CAAgBF,KAAnC,CAAd;AACA,oBAAMG,OAAOZ,UAAUU,QAAV,CAAmBJ,UAAUK,KAAV,CAAgBC,IAAnC,KAA4C,EAAzD;AACA,oBAAIH,QAAMG,IAAN,IAAY,CAAhB,EAAmB;AACfN,8BAAUK,KAAV,CAAgBF,KAAhB,GAAwBA,QAAMG,IAA9B;AACAN,8BAAUK,KAAV,CAAgBC,IAAhB,GAAuBA,IAAvB;AACAN,8BAAUK,KAAV,CAAgBG,MAAhB,GAAyB,IAAzB;AACA,2BAAOR,UAAUS,MAAjB;AACA,2BAAOhB,IAAIiB,MAAJ,CAAWV,SAAX,CAAP;AACH;AACJ;AACJ;;;kCAESF,M,EAAQ;AACdV,cAAEuB,MAAF,CAAS;AACLJ,uBAAMT,OAAOS,KADR;AAELK,sBAAKd,OAAOc,IAFP;AAGLC,0BAAS,KAAKC,WAAL,CAAiBhB,MAAjB,CAHJ;AAILiB,0BAAS,KAAKC,WAAL,CAAiBlB,MAAjB;AAJJ,aAAT,EAKG;AACCmB,uBAAMnB,OAAOmB;AADd,aALH;AAQH;;;mCAIU;AACP,mBAAO9B,EAAE+B,KAAF,+GAAqB,IAArB,GAAP;AACH;;;;EArDwC7B,kB;kBAAxBO,e","file":"order-controller.js","sourcesContent":["/**\r\n * @license\r\n * MOST Web Framework 2.0 Codename Blueshift\r\n * Copyright (c) 2017, THEMOST LP All rights reserved\r\n *\r\n * Use of this source code is governed by an BSD-3-Clause license that can be\r\n * found in the LICENSE file at https://themost.io/license\r\n */\r\nimport Q from 'q';\r\nimport _ from 'lodash';\r\nimport HttpDataController from '../../../modules/@themost/web/controllers/data';\r\nimport {httpAction, httpGet, httpController} from '../../../modules/@themost/web/decorators';\r\nimport url from 'url';\r\nimport {LangUtils} from '../../../modules/@themost/common/utils'\r\nimport {TraceUtils} from \"../../../modules/@themost/common\";\r\n\r\n@httpController()\r\nexport default class OrderController extends HttpDataController {\r\n\r\n    constructor(context) {\r\n        super(context);\r\n    }\r\n\r\n    getNextLink(result) {\r\n        if (result.hasOwnProperty(\"total\")) {\r\n            const urlObject = url.parse(this.context.request.url, true);\r\n            //get next link\r\n            const $skip = LangUtils.parseInt(urlObject.query.$skip);\r\n            const $top = LangUtils.parseInt(urlObject.query.$top) || 25;\r\n            if (result.total>=$skip+$top) {\r\n                urlObject.query.$skip = $skip+$top;\r\n                urlObject.query.$top = $top;\r\n                urlObject.query.$count = true;\r\n                delete urlObject.search;\r\n                return url.format(urlObject);\r\n            }\r\n        }\r\n    }\r\n\r\n    getPrevLink(result) {\r\n        if (result.hasOwnProperty(\"total\")) {\r\n            const urlObject = url.parse(this.context.request.url, true);\r\n            //get next link\r\n            const $skip = LangUtils.parseInt(urlObject.query.$skip);\r\n            const $top = LangUtils.parseInt(urlObject.query.$top) || 25;\r\n            if ($skip-$top>=0) {\r\n                urlObject.query.$skip = $skip-$top;\r\n                urlObject.query.$top = $top;\r\n                urlObject.query.$count = true;\r\n                delete urlObject.search;\r\n                return url.format(urlObject);\r\n            }\r\n        }\r\n    }\r\n\r\n    mapResult(result) {\r\n        _.assign({\r\n            total:result.total,\r\n            skip:result.skip,\r\n            nextLink:this.getNextLink(result),\r\n            prevLink:this.getPrevLink(result)\r\n        }, {\r\n            value:result.value\r\n        });\r\n    }\r\n\r\n    @httpGet()\r\n    @httpAction('index')\r\n    getItems() {\r\n        return Q.nbind(super.index, this)();\r\n    }\r\n\r\n}"]}