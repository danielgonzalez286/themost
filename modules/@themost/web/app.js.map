{"version":3,"sources":["app.es6"],"names":["url","_","async","Args","TraceUtils","HttpError","HttpNotFoundError","HttpMethodNotAllowedError","HttpNextResult","HttpResult","HttpAnyResult","AuthConsumer","BasicAuthConsumer","EncryptionStrategy","DefaultEncyptionStrategy","AuthStrategy","RestrictAccessConsumer","RestrictAccessService","HttpConsumer","HttpRouteConsumer","HttpErrorConsumer","StaticContentConsumer","MapStaticContentConsumer","HttpContext","RoutingStrategy","DefaultRoutingStrategy","RouteConsumer","LocalizationStrategy","DefaultLocalizationStrategy","CacheStrategy","DefaultCacheStrategy","DataConfigurationStrategy","Q","path","http","https","ViewConsumer","FormatterStrategy","DefaultFormatterStrategy","QuerystringConsumer","ModuleLoaderStrategy","ActiveModuleLoaderStrategy","HttpConfiguration","PostContentConsumer","MultipartContentConsumer","JsonContentConsumer","HTTP_SERVER_DEFAULT_BIND","HTTP_SERVER_DEFAULT_PORT","startInternal","options","self","opts","bind","process","env","IP","port","PORT","assign","server_","createServer","request","response","context","createContext","nbind","processRequestInternal","then","finalize","end","catch","err","processErrorInternal","res","error","statusCode","status","writeHead","write","message","serverProperty","listen","log","callback","consumers","getApplication","consumersProperty","eachSeries","consumer","cb","run","result","finalRes","isNil","otherWiseConsumer","otherwiseConsumerProperty","isFunction","callable","ReferenceError","execute","intermediateRes","Error","errorConsumers","errorConsumersProperty","length","call","createRequestInternal","opt","IncomingMessage","method","httpVersion","headers","host","accept","connection","cookie","cookies","session","params","query","form","body","files","createResponseInternal","req","ServerResponse","currentProperty","Symbol","configProperty","servicesProperty","executionPathProperty","configPathProperty","HttpApplication","executionPath","cwd","resolve","config","join","useStrategy","NODE_ENV","useQuerystring","arg","check","isString","getExecutionPath","getConfiguration","getStrategy","extension","find","getSourceAt","x","push","consumerConstructor","findIndex","uri","serviceCtor","notFunction","name","strategyCtor","hasOwnProperty","any","useService","rootDir","whenDir","hasService","hasConsumer","fn","nfcall","account","getService","getUnattendedExecutionAccount","isEmpty","user","authenticationType","data","require","parse","httpModule","protocol","setEncoding","on","chunk","encoding","JSON","stringify","toString","requestOptions","indexOf","executeExternalRequest","setHeader","requestContext","_header","arr","split","i","header","k","substr","isArray","output","outputEncodings","runtimeParser","next","isObject","finished"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n\nimport 'source-map-support/register';\nimport url from 'url';\nimport _ from 'lodash';\nimport async from 'async';\nimport {Args, TraceUtils} from '@themost/common/utils';\nimport {HttpError, HttpNotFoundError, HttpMethodNotAllowedError} from '@themost/common/errors';\nimport {HttpNextResult,HttpResult,HttpAnyResult} from './results';\nimport {AuthConsumer, BasicAuthConsumer, EncryptionStrategy, DefaultEncyptionStrategy, AuthStrategy} from './consumers/auth';\nimport {RestrictAccessConsumer,RestrictAccessService} from './consumers/restrict_access';\nimport {HttpConsumer,HttpRouteConsumer,HttpErrorConsumer} from './consumers';\nimport {StaticContentConsumer, MapStaticContentConsumer} from './consumers/static';\nimport {HttpContext} from './context';\nimport {RoutingStrategy,DefaultRoutingStrategy,RouteConsumer} from './consumers/route';\nimport {LocalizationStrategy,DefaultLocalizationStrategy} from './localization';\nimport {CacheStrategy,DefaultCacheStrategy} from './cache';\nimport {DataConfigurationStrategy} from '@themost/data/config';\nimport Q from 'q';\nimport path from 'path';\nimport http from 'http';\nimport https from 'https';\nimport {ViewConsumer} from \"./consumers/view\";\nimport {FormatterStrategy, DefaultFormatterStrategy} from \"./formatters\";\nimport {QuerystringConsumer} from \"./consumers/querystring\";\nimport {ModuleLoaderStrategy, ActiveModuleLoaderStrategy} from \"@themost/common/config\";\nimport {HttpConfiguration} from \"./config\";\nimport {PostContentConsumer} from \"./consumers/post\";\nimport {MultipartContentConsumer} from \"./consumers/multipart\";\nimport {JsonContentConsumer} from \"./consumers/json\";\n\nconst HTTP_SERVER_DEFAULT_BIND = '127.0.0.1';\nconst HTTP_SERVER_DEFAULT_PORT = 3000;\n\n/**\n * Starts current application\n * @private\n * @static\n * @param {*} options\n */\nfunction startInternal(options) {\n    /**\n     * @type {HttpApplication|*}\n     */\n    const self = this;\n    try {\n        /**\n         * @memberof process.env\n         * @property {number} PORT\n         * @property {string} IP\n         * @property {string} NODE_ENV\n         */\n        const opts = {\n            bind:(process.env.IP || HTTP_SERVER_DEFAULT_BIND),\n            port:(process.env.PORT ? process.env.PORT: HTTP_SERVER_DEFAULT_PORT)\n        };\n        //extend options\n        _.assign(opts, options);\n\n        const server_ = http.createServer((request, response) => {\n            const context = self.createContext(request, response);\n            //begin request processing\n            return Q.nbind(processRequestInternal,self)(context).then(()=> {\n                context.finalize(function() {\n                    if (context.response) { context.response.end(); }\n                });\n            }).catch((err)=> {\n                return Q.nbind(processErrorInternal,self)(context, err).then((res)=> {\n                    context.finalize(function() {\n                        if (context.response) { context.response.end(); }\n                    });\n                }).catch((err)=> {\n                    //an error occurred while handling request error\n                    TraceUtils.error(err);\n                    if (context && context.response) {\n                        if (err instanceof HttpError) {\n                            const statusCode = err.status || 500;\n                            //send a text/plain error (and safely end response)\n                            context.response.writeHead(statusCode, {\"Content-Type\": \"text/plain\"});\n                            context.response.write(statusCode + ' ' + err.message + '\\n');\n                        }\n                        else {\n                            //send a text/plain error (and safely end response)\n                            context.response.writeHead(500, {\"Content-Type\": \"text/plain\"});\n                            context.response.write('500 Internal Server Error\\n');\n                        }\n\n                        if (typeof context.finalize === 'function') {\n                            context.finalize(function() {\n                                if (context.response) { context.response.end(); }\n                            });\n                        }\n                        else {\n                            if (context.response) { context.response.end(); }\n                        }\n\n                    }\n                });\n            });\n        });\n        self[serverProperty] = server_;\n        //start listening\n        server_.listen(opts.port, opts.bind);\n        TraceUtils.log('Web application is running at http://%s:%s/', opts.bind, opts.port);\n    } catch (err) {\n        TraceUtils.log(err);\n    }\n}\n\n/**\n * Processes an HTTP request under current application\n * @private\n * @static\n * @param {HttpContext} context\n * @param {Function} callback\n */\nfunction processRequestInternal(context, callback) {\n    /**\n     * @type {HttpApplication|*}\n     */\n    const self = this,\n        /**\n         * @type {Array}\n         */\n        consumers = context.getApplication()[consumersProperty];\n\n    return async.eachSeries(consumers,\n        /**\n         * @param {HttpConsumer} consumer\n         * @param {Function} cb\n         */\n        (consumer, cb) => {\n            try {\n                consumer.run(context).then((result)=> {\n                    //if result is an instance of HttpNextResult\n                    if (result instanceof HttpNextResult) {\n                        //continue series execution (call series callback with no error)\n                        return cb();\n                    }\n                    else if (result instanceof HttpResult) {\n                        //continue series execution (call series callback with no error)\n                        return cb(result);\n                    }\n                    //else break series execution and return result\n                    return cb(new HttpAnyResult(result));\n                }).catch((err)=> {\n                    return cb(err);\n                });\n            }\n            catch(err) {\n                return cb(err);\n            }\n\n        }, (finalRes) => {\n            if (_.isNil(finalRes)) {\n                //get otherwise consumer\n                const otherWiseConsumer = self[otherwiseConsumerProperty];\n                if (otherWiseConsumer instanceof HttpConsumer) {\n                    if (!_.isFunction(otherWiseConsumer.callable)) {\n                        return callback(new ReferenceError('HTTP consumer callable must be a function.'));\n                    }\n                    return otherWiseConsumer.run(context).then(result=> {\n                        if (result instanceof HttpNextResult) {\n                            return callback(new HttpNotFoundError());\n                        }\n                        if (result instanceof HttpResult) {\n                            if (typeof finalRes.execute === 'function') {\n                                //execute result\n                                return finalRes.execute(context).then(() => {\n                                    return callback();\n                                }).catch((err) => {\n                                    return callback(err);\n                                });\n                            }\n                            return callback(null, result);\n                        }\n                        else {\n                            //create an instance of HttpAnyResult class\n                            const intermediateRes = new HttpAnyResult(result);\n                            return intermediateRes.execute(context).then(() => {\n                                callback();\n                            }).catch((err) => {\n                                return callback(err);\n                            });\n                        }\n                    }).catch((err) => {\n                        return callback(err);\n                    });\n                }\n                else {\n                    return callback(new HttpNotFoundError());\n                }\n            }\n            ///////////////////////\n            //Final Execution\n            ///////////////////////\n            //handle error\n            if (finalRes instanceof Error) {\n                return callback(finalRes);\n            }\n            //handle HttpAnyResult\n            else if (finalRes instanceof HttpResult) {\n                try {\n                    if (typeof finalRes.execute === 'function') {\n                        //execute result\n                        return finalRes.execute(context).then(() => {\n                            return callback();\n                        }).catch((err) => {\n                            return callback(err);\n                        });\n                    }\n                }\n                catch(err) {\n                    return callback(err);\n                }\n\n                return callback(null, finalRes);\n            }\n            //throw exception\n            return callback(new HttpMethodNotAllowedError());\n\n        });\n}\n\n\n/**\n * Processes HTTP errors under current application\n * @param {HttpContext} context\n * @param {Error|*} error\n * @param {Function} callback\n */\nfunction processErrorInternal(context, error, callback) {\n  /**\n   * @type {Array}\n   */\n  const errorConsumers = context.getApplication()[errorConsumersProperty];\n    if (errorConsumers.length===0) {\n        return callback(error);\n    }\n    return async.eachSeries(errorConsumers, (consumer, cb) => {\n        consumer.callable.call(context, error).then(result=> {\n            if (result instanceof HttpNextResult) {\n                return cb();\n            }\n            return cb(result);\n        }).catch((err)=> {\n            return cb(err);\n        });\n    }, (err) => {\n        return callback(err);\n    });\n}\n\n/**\n * Creates a mock-up server request\n * @private\n * @param {*} options\n */\nfunction createRequestInternal(options) {\n    const opt = options ? options : {};\n    const request = new http.IncomingMessage();\n    request.method = (opt.method) ? opt.method : 'GET';\n    request.url = (opt.url) ? opt.url : '/';\n    request.httpVersion = '1.1';\n    request.headers = (opt.headers) ? opt.headers : {\n        host: 'localhost',\n        'user-agent': 'Mozilla/5.0 (X11; Linux i686; rv:10.0) Gecko/20100101 Firefox/22.0',\n        accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n        'accept-language': 'en-US,en;q=0.5',\n        'accept-encoding': 'gzip, deflate',\n        connection: 'keep-alive',\n        'cache-control': 'max-age=0' };\n    if (opt.cookie)\n        request.headers.cookie = opt.cookie;\n    request.cookies = (opt.cookies) ? opt.cookies : {};\n    request.session = (opt.session) ? opt.session : {};\n    request.params = (opt.params) ? opt.params : {};\n    request.query = (opt.query) ? opt.query : {};\n    request.form = (opt.form) ? opt.form : {};\n    request.body = (opt.body) ? opt.body : {};\n    request.files = (opt.files) ? opt.files : {};\n    return request;\n}\n\n/**\n * Creates a mock-up server response\n * @param {ClientRequest} req\n * @returns {ServerResponse|*}\n * @private\n */\nfunction createResponseInternal(req) {\n    return new http.ServerResponse(req);\n}\n\nconst currentProperty = Symbol('current');\nconst consumersProperty = Symbol('consumers');\nconst errorConsumersProperty = Symbol('errorConsumers');\nconst otherwiseConsumerProperty = Symbol('otherwise');\nconst configProperty = Symbol('config');\nconst serverProperty = Symbol('server');\nconst servicesProperty = Symbol('services');\nconst executionPathProperty = Symbol('executionPath');\nconst configPathProperty = Symbol('configPath');\n\n/**\n * @classdesc Represents an HTTP server application\n * @class\n */\nexport class HttpApplication {\n    /**\n     * @param {string=} executionPath\n     * @constructor\n     */\n    constructor(executionPath) {\n        this[consumersProperty] = [];\n        this[errorConsumersProperty] = [];\n        this[servicesProperty] = {};\n        this[executionPathProperty] = _.isNil(executionPath) ? process.cwd() : path.resolve(executionPath);\n        const config = new HttpConfiguration(path.join(this[executionPathProperty],'config'));\n        config.useStrategy(DataConfigurationStrategy, ()=> {\n            return new DataConfigurationStrategy(config);\n        });\n        if (process.env.NODE_ENV==='development') {\n            //load active module watcher strategy\n            config.useStrategy(ModuleLoaderStrategy, ActiveModuleLoaderStrategy);\n        }\n        //change module loader strategy\n        this[configProperty] = config;\n        //load default consumers\n        this.useQuerystring();\n    }\n    /**\n     * @param {string=} executionPath\n     * @returns HttpApplication\n     */\n    static create(executionPath) {\n        return new HttpApplication(executionPath);\n    }\n\n    /**\n     * Gets the execution path of the current HTTP application\n     * @returns {string}\n     */\n    getExecutionPath() {\n        return this[executionPathProperty];\n    }\n\n    /**\n     * Resolves the given path\n     * @param {string} arg\n     */\n    mapExecutionPath(arg) {\n        Args.check(_.isString(arg),'Path must be a string');\n        return path.resolve(this.getExecutionPath(), arg);\n    }\n\n    /**\n     * Gets the configuration path of the current HTTP application\n     * @returns {string}\n     */\n    getConfigurationPath() {\n        return this[configPathProperty];\n    }\n\n    /**\n     * @returns {HttpConfiguration}\n     */\n    getConfiguration() {\n        return this[configProperty];\n    }\n\n    /**\n     *\n     * @returns {HttpConfiguration}\n     */\n    getApplicationConfiguration() {\n        return this.getConfiguration().getStrategy(HttpConfiguration);\n    }\n\n    getMimeType(extension) {\n        return _.find(this.getConfiguration().getSourceAt('mimes'),function(x) {\n            return (x.extension===extension) || (x.extension==='.'+extension);\n        });\n    }\n\n    /**\n     * @returns {Server|*}\n     */\n    getServer() {\n        return this[serverProperty];\n    }\n\n    /**\n     * @param {Function|HttpConsumer} consumer\n     * @param {*=} params\n     * @returns HttpApplication\n     */\n    any(consumer, params) {\n        if (consumer instanceof HttpConsumer) {\n            this[consumersProperty].push(consumer);\n        }\n        else {\n            this[consumersProperty].push(new HttpConsumer(consumer, params));\n        }\n        return this;\n    }\n\n    /**\n     * @param {Function} consumerConstructor\n     * @returns {boolean}\n     */\n    hasConsumer(consumerConstructor) {\n        if (typeof consumerConstructor !== 'function') {\n            return false;\n        }\n        return _.findIndex(this[consumersProperty],(x)=> {\n            return x instanceof consumerConstructor;\n        })>=0;\n    }\n\n    /**\n     * @param {Function|HttpErrorConsumer} consumer\n     * @param {*=} params\n     * @returns HttpApplication\n     */\n    error(consumer, params) {\n        if (consumer instanceof HttpErrorConsumer) {\n            this[errorConsumersProperty].push(consumer);\n        }\n        else {\n            this[errorConsumersProperty].push(new HttpErrorConsumer(consumer, params));\n        }\n        return this;\n    }\n\n    /**\n     * @param {string} uri\n     * @param {Function|HttpConsumer} consumer\n     * @param {*=} params\n     * @returns HttpApplication\n     */\n    when(uri, consumer, params) {\n        if (consumer instanceof HttpRouteConsumer) {\n            this[consumersProperty].push(consumer);\n        }\n        else {\n            this[consumersProperty].push(new HttpRouteConsumer(uri,consumer, params));\n        }\n        return this;\n    }\n\n    /**\n     * @param {Function|HttpConsumer} consumer\n     * @param {*=} params\n     * @returns HttpApplication\n     */\n    otherwise(consumer, params) {\n        if ((consumer instanceof HttpConsumer) || (consumer instanceof HttpErrorConsumer)) {\n            this[otherwiseConsumerProperty] = consumer;\n        }\n        else {\n            this[otherwiseConsumerProperty] = new HttpConsumer(consumer, params);\n        }\n        return this;\n    }\n\n    /**\n     * Register a service type in application services\n     * @param {Function} serviceCtor\n     * @returns HttpApplication\n     */\n    useService(serviceCtor) {\n        Args.notFunction(serviceCtor,\"Service constructor\");\n        this[servicesProperty][`${serviceCtor.name}`] = new serviceCtor(this);\n        return this;\n    }\n\n    /**\n     * Register a service type in application services\n     * @param {Function} serviceCtor\n     * @param {Function} strategyCtor\n     * @returns HttpApplication\n     */\n    useStrategy(serviceCtor, strategyCtor) {\n        Args.notFunction(strategyCtor,\"Service constructor\");\n        Args.notFunction(strategyCtor,\"Strategy constructor\");\n        this[servicesProperty][`${serviceCtor.name}`] = new strategyCtor(this);\n        return this;\n    }\n\n    /**\n     * Register a service type in application services\n     * @param {Function} serviceCtor\n     */\n    getService(serviceCtor) {\n        Args.notFunction(serviceCtor,\"Service constructor\");\n        return this[servicesProperty][`${serviceCtor.name}`];\n    }\n\n    /**\n     * Checks if a service of the given type exists in application services\n     * @param {Function} serviceCtor\n     * @returns boolean\n     */\n    hasService(serviceCtor) {\n        return this[servicesProperty].hasOwnProperty(`${serviceCtor.name}`);\n    }\n\n\n    /**\n     * Enables application default routing strategy\n     * @returns {HttpApplication}\n     */\n    useRoutingStrategy() {\n        return this.useStrategy(RoutingStrategy, DefaultRoutingStrategy);\n    }\n\n    /**\n     * Enables application default routing strategy\n     * @returns {HttpApplication}\n     */\n    useFormatterStrategy() {\n        return this.useStrategy(FormatterStrategy, DefaultFormatterStrategy);\n    }\n\n    /**\n     * Enables application default routing strategy\n     * @returns {HttpApplication}\n     */\n    useCacheStrategy() {\n        return this.useStrategy(CacheStrategy, DefaultCacheStrategy);\n    }\n\n    /**\n     * Enables application default routing strategy\n     * @returns {HttpApplication}\n     */\n    useEncryptionStrategy() {\n        return this.useStrategy(EncryptionStrategy, DefaultEncyptionStrategy);\n    }\n\n    /**\n     * Enables application default localization strategy\n     * @returns {HttpApplication}\n     */\n    useLocalization() {\n        return this.useStrategy(LocalizationStrategy, DefaultLocalizationStrategy);\n    }\n\n    /**\n     * Enables basic authentication\n     * @returns {HttpApplication}\n     */\n    useBasicAuthentication() {\n        return this.any(new BasicAuthConsumer());\n    }\n\n    /**\n     * Enables application authentication\n     * @returns {HttpApplication}\n     */\n    useRestrictAccess() {\n        this.useService(RestrictAccessService);\n        return this.any(new RestrictAccessConsumer());\n    }\n\n    /**\n     * Enables application authentication based on the registered authentication strategy\n     * @returns {HttpApplication}\n     */\n    useAuthentication() {\n        this.useStrategy(EncryptionStrategy, DefaultEncyptionStrategy);\n        return this.any(new AuthConsumer());\n    }\n\n    /**\n     * Enables static content requests\n     * @param {string=} rootDir\n     * @returns {HttpApplication}\n     */\n    useStaticContent(rootDir) {\n        return this.any(new StaticContentConsumer(rootDir));\n    }\n\n    /**\n     * Enables static content requests\n     * @returns {HttpApplication}\n     */\n    useQuerystring() {\n        return this.any(new QuerystringConsumer());\n    }\n\n    /**\n     * Enables HTTP application/x-www-form-urlencoded request processing\n     * @returns {HttpApplication}\n     */\n    usePostContent() {\n        return this.any(new PostContentConsumer());\n    }\n\n    /**\n     * Enables HTTP multipart/form-data request processing\n     * @returns {HttpApplication}\n     */\n    useMultipartContent() {\n        return this.any(new MultipartContentConsumer());\n    }\n\n    /**\n     * Enables HTTP application/json request processing\n     * @returns {HttpApplication}\n     */\n    useJsonContent() {\n        return this.any(new JsonContentConsumer());\n    }\n\n    /**\n     * Enables static content requests\n     * @param {string=} whenDir\n     * @param {string=} rootDir\n     * @returns {HttpApplication}\n     */\n    mapStaticContent(whenDir, rootDir) {\n        return this.any(new MapStaticContentConsumer(whenDir, rootDir));\n    }\n\n    /**\n     * Enables static content requests\n     * @returns {HttpApplication}\n     */\n    useViewContent() {\n        //check if application does not have a service of type RoutingStrategy\n        if (!this.hasService(RoutingStrategy))  {\n            this.useStrategy(RoutingStrategy, DefaultRoutingStrategy);\n        }\n        //check if application does not have a consumer of type RouteConsumer\n        if (!this.hasConsumer(RouteConsumer))\n            //and add it\n            this.any(new RouteConsumer());\n        //check if application does not have a consumer of type ViewConsumer\n        if (!this.hasConsumer(ViewConsumer))\n            //and add it\n            return this.any(new ViewConsumer());\n    }\n\n    /**\n     * Starts the current HTTP application.\n     * @param {HttpApplicationOptions=} options\n     * @return {HttpApplication}\n     */\n    start(options) {\n        startInternal.bind(this)(options);\n        return this;\n    }\n\n    /**\n     * Creates an instance of HttpContext class.\n     * @param {ClientRequest} request\n     * @param {ServerResponse} response\n     * @returns {HttpContext}\n     */\n    createContext(request, response) {\n        return new HttpContext(this, request, response);\n    }\n\n    /**\n     * @returns {HttpApplication}\n     */\n    static getCurrent() {\n        if (_.isNil(HttpApplication[currentProperty])) {\n            HttpApplication[currentProperty] = new HttpApplication();\n        }\n        return HttpApplication[currentProperty];\n    }\n\n    /**\n     * Creates a new context and executes the given function\n     * @param {Function} fn - A function to execute. The first argument is the current context\n     * @returns {Promise}\n     */\n    execute(fn) {\n        const self = this;\n        return Q.nfcall(function(callback) {\n            //create context\n            const request = createRequestInternal.call(self),\n                response = createResponseInternal.call(self,request);\n            let context = self.createContext(request, response);\n            fn(context).then(()=>{\n                return callback();\n            }).catch((err) => {\n                return callback(err);\n            });\n        });\n    }\n\n    /**\n     * Creates a new context and executes the given function in unattended mode\n     * @param {Function} fn\n     * @returns {Promise}\n     */\n    executeUnattended(fn) {\n        const self = this;\n        return Q.nfcall(function(callback) {\n            //create context\n            const request = createRequestInternal.bind(self)(),\n                response = createResponseInternal.bind(self)(request);\n            let context = self.createContext(request, response);\n            //get unattended execution account\n            if (this.hasService(AuthStrategy)) {\n                const account = this.getService(AuthStrategy).getUnattendedExecutionAccount();\n                if (_.isEmpty(account)) {\n                    context.user = { name: account, authenticationType: 'Basic'};\n                }\n            }\n            fn(context).then(()=>{\n                return callback();\n            }).catch((err) => {\n                return callback(err);\n            });\n        });\n    }\n\n    /**\n     * Executes and external HTTP request\n     * @param {string|*} options\n     * @param {*} data\n     * @returns {Promise}\n     */\n    executeExternalRequest(options, data) {\n\n        return Q.nfcall(function(callback) {\n            //make request\n            const https = require('https'),\n                opts = (typeof options==='string') ? url.parse(options) : options,\n                httpModule = (opts.protocol === 'https:') ? https : http;\n            const req = httpModule.request(opts, (res) => {\n                res.setEncoding('utf8');\n                let data = '';\n                res.on('data', function (chunk) {\n                    data += chunk;\n                });\n                res.on('end', () => {\n                    return callback(null,\n                        { statusCode: res.statusCode,\n                            headers: res.headers,\n                            body:data,\n                            encoding:'utf8'\n                        });\n                });\n            });\n            req.on('error', (err)=> {\n                //return error\n                return callback(err);\n            });\n            if(data)\n            {\n                if (typeof data ===\"object\" )\n                    req.write(JSON.stringify(data));\n                else\n                    req.write(data.toString());\n            }\n            req.end();\n        });\n\n\n    }\n\n    /**\n     * Executes an external or internal HTTP request\n     * @param {*|string} options\n     * @returns {Promise|*}\n     */\n    executeRequest(options) {\n        const self = this;\n        return Q.nbind((callback) => {\n            const requestOptions = { };\n            if (typeof options === 'string') {\n                _.assign(requestOptions, { url:options });\n            }\n            else {\n                _.assign(requestOptions, options);\n            }\n            if (_.isNil(requestOptions.url)) {\n                return callback(new Error('Internal request url cannot be empty at this context.'));\n            }\n            if (requestOptions.url.indexOf('/')!==0)\n            {\n                _.assign(requestOptions, url.parse(requestOptions.url));\n                //execute external request\n                return this.executeExternalRequest(requestOptions,null).then((res)=> {\n                    return callback(null, res);\n                }).catch((err)=> {\n                    return callback(err);\n                });\n            }\n            else {\n                //create request and response\n                const request = createRequestInternal.bind(this)(requestOptions),\n                    response = createResponseInternal.bind(this)(request);\n                //set content length header to -1 (for backward compatibility issues)\n                response.setHeader('Content-Length',-1);\n                //create context\n                const requestContext = this.createContext(request, response);\n                //and finally process context\n                return processRequestInternal.call(self, requestContext, function(err) {\n                    if (err) {\n                        return callback(err);\n                    }\n                    else {\n                        try {\n                            //get statusCode\n                            const statusCode = response.statusCode;\n                            //get headers\n                            const headers = {};\n                            if (response._header) {\n                                const arr = response._header.split('\\r\\n');\n                                for (let i = 0; i < arr.length; i++) {\n                                    const header = arr[i];\n                                    if (header) {\n                                        const k = header.indexOf(':');\n                                        if (k>0) {\n                                            headers[header.substr(0,k)] = header.substr(k+1);\n                                        }\n                                    }\n                                }\n                            }\n                            //get body\n                            let body = null;\n                            let encoding = null;\n                            if (_.isArray(response.output)) {\n                                if (response.output.length>0) {\n                                    body = response.output[0].substr(response._header.length);\n                                    encoding = response.outputEncodings[0];\n                                }\n                            }\n                            //build result (something like ServerResponse)\n                            const result = {\n                                statusCode: statusCode,\n                                headers: headers,\n                                body:body,\n                                encoding:encoding\n                            };\n                            return callback(null, result);\n                        }\n                        catch (err) {\n                            return callback(err);\n                        }\n                    }\n                });\n            }\n        },this)();\n\n\n    }\n\n    /**\n     * Returns an express framework middleware.\n     * This method may used when @themost application is going to be used alongside with express\n     * @returns {Function}\n     * @example\n     *\n     const theApp = new HttpApplication(\"./test/express/\");\n     //init application\n     theApp.useQuerystring()\n         .useFormatterStrategy()\n         .useAuthentication()\n         .useViewContent();\n     const app = express();\n     //register application as middleware\n     app.use(theApp.runtime());\n     //start server\n     app.listen(process.env.PORT || 3000);\n     */\n    runtime() {\n        const self = this;\n        return function runtimeParser(req, res, next) {\n            //create context\n            const context = self.createContext(req, res);\n            context.request.on('close', () => {\n                //client was disconnected abnormally\n                if (_.isObject(context)) {\n                    context.finalize(function () {\n                        if (context.response) {\n                            //if response is alive\n                            if (context.response.finished === false)\n                            //end response\n                                context.response.end();\n                        }\n                    });\n                }\n            });\n            processRequestInternal.bind(self)(context, (err)=> {\n                return context.finalize(()=> {\n                    //if error is an instance of HttpNotFoundError continue execution\n                    if (err instanceof HttpNotFoundError) {\n                        return next();\n                    }\n                    //if error is an instance of HttpError and status is 404 NOT FOUND continue execution\n                    else if ((err instanceof HttpError) && err.status === 404) {\n                        return next();\n                    }\n                    //otherwise continue execution with error\n                    else if (err) {\n                        return next(err);\n                    }\n                    if (context.response) {\n                        context.response.end();\n                    }\n                });\n            });\n\n        };\n    }\n\n}"]}