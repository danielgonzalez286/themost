{"version":3,"sources":["module.es6"],"names":["domino","fs","_","path","HttpApplicationService","AngularServerModuleDefaults","HttpError","TraceUtils","Args","bootstrapMethod","Symbol","AngularServerModule","app","directives","filters","controllers","services","modules","angular","ng","jQuery","applyDirectives","module","fn","file","self","notString","removeModule","moduleName","solvedName","require","resolve","nodeModule","cache","i","children","length","child","filename","keys","Error","bootstrapFunc","call","process","env","NODE_ENV","name","ctor","s","window","createWindow","setTimeout","clearTimeout","Object","defineProperty","document","get","configurable","enumerable","location","href","global","ext","extend","element","parentWindow","$","navigator","appCodeName","appVersion","cookieEnabled","hardwareConcurrency","language","platform","product","userAgent","HttpInternalProvider","$context","$async","$q","$http","requestConfig","config","method","cookie","request","headers","deferred","defer","promise","reject","success","then","response","data","status","error","getApplication","executeRequest","subscribe","statusCode","body","err","message","forEach","url","DirectiveHandler","args","callback","context","view","target","hasService","useService","angularServer","getService","createDocument","promises","$sceDelegateProvider","resourceUrlWhitelist","service","push","directive","filter","controller","appElement","find","injector","bootstrap","all","innerHTML","reason","e"],"mappings":"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","file":"module.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\nimport 'source-map-support/register';\nimport domino from 'domino';\nimport fs from 'fs';\nimport {_} from 'lodash';\nimport path from 'path';\nimport {HttpApplicationService} from \"../interfaces\";\nimport {AngularServerModuleDefaults} from './directives';\nimport {HttpError} from \"@themost/common/errors\";\nimport {TraceUtils, Args} from \"@themost/common/utils\";\n\n\nconst bootstrapMethod = Symbol('bootstrap');\n\n/**\n * Represents Angular JS Server module\n * @class\n * @property {*} directives\n * @property {*} controllers\n * @property {*} filters\n * @property {angular} angular\n * @property {jQuery} jQuery\n */\nexport class AngularServerModule extends HttpApplicationService {\n\n    /**\n     * @param {HttpApplication} app\n     */\n    constructor(app) {\n        super(app);\n        this.directives = { };\n        this.filters = { };\n        this.controllers = { };\n        this.services = { };\n        this.modules = { };\n        this.angular = ng.angular;\n        this.jQuery = ng.jQuery;\n        AngularServerModuleDefaults.applyDirectives(this);\n        this[bootstrapMethod] = (angular)=> {\n            return angular.module('server',[]);\n        };\n    }\n\n    /**\n     * Bootstraps angular server module.\n     * @param {Function} fn\n     * @returns {module}\n     */\n    bootstrap(fn) {\n        this[bootstrapMethod] = fn;\n    }\n\n    /**\n     * Bootstraps angular server module by loading and executing the given module\n     * @param {string} file\n     * @example\n     *   'use strict';\n     *   import {HttpApplication} from './../modules/@themost/web/index';\n     *   import {AngularServerModule} from \"../modules/@themost/web/lib/angular/module\";\n     *   //instantiate application\n     *   let app = new HttpApplication();\n     *   //set execution path\n     *   app.setExecutionPath('./test-app')\n     *   //use angular server module\n     *   .useService(AngularServerModule)\n     *   .getService(AngularServerModule)\n     *   //and set bootstrap module\n     *   .useBootstrapModule(app.mapExecutionPath('./modules/server-app'));\n     * @example\n     * //#server-app.js\n     *   'use strict';\n     *   export function bootstrap(angular) {\n     *       //initialize extensions module\n     *       const extensions = angular.module('server-extensions',[]);\n     *       //add a simple directive\n     *       extensions.directive('helloText', function() {\n     *               return {\n     *                   restrict:'EA',\n     *                   link: function(scope, element) {\n     *                       element.text('Hello User!!');\n     *                   }\n     *              }\n     *           });\n     *           //and return server module by adding server-extensions dependency\n     *           return angular.module('server',['server-extensions']);\n     *   }\n     *\n     *\n     */\n    useBootstrapModule(file) {\n        const self = this;\n        Args.notString(file,'Module');\n\n        const removeModule = (moduleName) => {\n            let solvedName = require.resolve(moduleName),\n                nodeModule = require.cache[solvedName];\n            if (nodeModule) {\n                for (let i = 0; i < nodeModule.children.length; i++) {\n                    let child = nodeModule.children[i];\n                    removeModule(child.filename);\n                }\n                delete require.cache[solvedName];\n            }\n        };\n\n        this[bootstrapMethod] = (angular) => {\n            const module = require(file);\n            const keys = _.keys(module);\n            if (keys.length==0) {\n                throw new Error('Module export is missing or is inaccesible.');\n            }\n            const bootstrapFunc = module[keys[0]];\n            if (typeof bootstrapFunc !== 'function') {\n                throw new Error('Module export invalid. Expected function.');\n            }\n            let app = bootstrapFunc.call(self, angular);\n            if (process.env.NODE_ENV==='development')\n                removeModule(file);\n            return app;\n        };\n        return this;\n    }\n\n    /**\n     * @param {string} name\n     * @param {function|Array|*=} ctor\n     * @returns AngularServerModule|function\n     */\n    service(name, ctor) {\n        if (typeof ctor === 'undefined')\n            return this.services[name];\n        this.services[name] = ctor;\n        return this;\n    }\n\n    /**\n     * @param {string} name\n     * @param {function|Array|*=} ctor\n     * @returns AngularServerModule|function\n     */\n    directive(name, ctor) {\n        if (typeof ctor === 'undefined')\n            return this.directives[name];\n        this.directives[name] = ctor;\n        return this;\n    }\n\n    /**\n     * @param {string} name\n     * @param {function|Array|*=} ctor\n     * @returns AngularServerModule|function\n     */\n    filter(name, ctor) {\n        if (typeof ctor === 'undefined')\n            return this.filters[name];\n        this.filters[name] = ctor;\n        return this;\n    }\n\n    /**\n     * @param {string} name\n     * @param {function|Array|*=} ctor\n     * @returns AngularServerModule|function\n     */\n    controller(name, ctor) {\n        if (typeof ctor === 'undefined')\n            return this.controllers[name];\n        this.controllers[name] = ctor;\n        return this;\n    }\n\n    /**\n     * Create an HTML document\n     * @param {string} s A string which represents the HTML markup of the document\n     * @returns {HTMLDocument}\n     */\n    createDocument(s) {\n        s = s || '<html/>';\n        const window = domino.createWindow(s);\n        window.setTimeout = setTimeout;\n        window.clearTimeout = clearTimeout;\n        //define parent window property\n        Object.defineProperty(window.document, 'parentWindow', { get: function(){\n            return window;\n        }, configurable:false, enumerable:false });\n        window.location.href = \"/\";\n        if (typeof global.jQuery !== 'function')\n            throw new Error('jQuery object cannot be instantiated due to missing constructor.');\n        global.jQuery(window);\n        //extend jQuery\n        const ext = require('./../jquery/server_extensions');\n        ext.extend(window.jQuery);\n        if (typeof global.angular !== 'function')\n            throw new Error('Angular JS object cannot be instantiated due to missing constructor.');\n        //initialize angular\n        global.angular(window, window.document);\n        /**\n         * @param {string|*} s\n         * @returns {HTMLElement|*}\n         */\n        window.document.element = function(s) {\n            return this.parentWindow.$(s);\n        };\n        return window.document;\n    }\n\n}\n\nconst ng = { };\n\nif (typeof ng.angular === 'undefined' || ng.angular=== null) {\n    global.window = domino.createWindow('<html />');\n    global.window.location.href = \"/\";\n    global.document = global.window.document;\n    global.navigator = { appCodeName:\"Mozilla\",\n        appVersion:\"AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.124 Safari/537.36\",\n        cookieEnabled: false,\n        hardwareConcurrency:4,\n        language:\"en-US\",\n        platform:\"Win32\",\n        product:\"Gecko\",\n        userAgent:\"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2062.124 Safari/537.36\"\n    };\n    //call jQuery initialization\n    require('./../jquery/jquery');\n    //call angular initialization\n    require('./angular');\n    //delete dummy property\n    delete global.window;\n    delete global.document;\n    //set methods\n    ng.angular = global.angular;\n    ng.jQuery = global.jQuery;\n}\n\n/**\n * @class\n * @param {HttpContext|*} $context\n * @param {*} $qs\n * @returns {$http}\n * @constructor\n * @private\n */\nfunction HttpInternalProvider($context, $async, $q) {\n\n    function $http(requestConfig) {\n        const config = {\n            method: 'get',\n            cookie: $context.request.headers.cookie\n        };\n        angular.extend(config, requestConfig);\n        const deferred = $q.defer(), promise = deferred.promise;\n\n        $async(function(resolve, reject) {\n\n            promise.success = function(fn) {\n                promise.then(function(response) {\n                    fn(response.data, response.status, response.headers, config);\n                    resolve();\n                });\n                return promise;\n            };\n            promise.error = function(fn) {\n                promise.then(null, function(response) {\n                    fn(response.data, response.status, response.headers, config);\n                    reject(new HttpError(response.status))\n                });\n                return promise;\n            };\n\n            $context.getApplication().executeRequest(config).subscribe((response)=> {\n                response.status = response.statusCode;\n                response.data = response.body;\n                deferred.resolve(response);\n            }, (err)=> {\n                if (err) {\n                    deferred.reject({ data: err.message, status:500, headers:{} });\n                }\n            });\n        });\n        return promise;\n\n    }\n\n    ['get', 'delete', 'head', 'jsonp'].forEach(function(name) {\n        $http[name] = function(url, config) {\n            return $http(angular.extend(config || {}, {\n                method: name,\n                url: url\n            }));\n        };\n    });\n\n    ['post', 'put'].forEach(function(name) {\n        $http[name] = function(url, data, config) {\n            return $http(angular.extend(config || {}, {\n                method: name,\n                url: url,\n                data: data\n            }));\n        };\n    });\n\n    return $http;\n}\n\n/**\n * @class\n */\nexport class DirectiveHandler {\n    /**\n     * @param {{context: HttpContext, target: HttpResult}} args\n     * @param callback\n     */\n    postExecuteResult(args, callback) {\n        try {\n\n            callback = callback || function() {};\n            //get context and view\n            const context = args.context, view = args.target;\n            //ensure context\n            if (typeof context === 'undefined' || context === null) {\n                return callback();\n            }\n            //ensure view\n            if (typeof view === 'undefined' || view === null) {\n                return callback();\n            }\n            //ensure view result data\n            if (typeof view.body !== 'string') {\n                return callback();\n            }\n\n            if (!args.context.getApplication().hasService(AngularServerModule)) {\n                args.context.getApplication().useService(AngularServerModule);\n            }\n            /**\n             * @type {AngularServerModule}\n             */\n            const angularServer = args.context.getApplication().getService(AngularServerModule);\n\n            //process result\n            const document = angularServer.createDocument(view.body);\n            //create server module\n            const angular = document.parentWindow.angular;\n\n            const app = angularServer[bootstrapMethod](angular);\n\n            const promises = [];\n            app.config(function($sceDelegateProvider) {\n                $sceDelegateProvider.resourceUrlWhitelist([\n                    '/templates/server/*.html'\n                ]);\n            });\n            app.service('$context', function() {\n                return context;\n            }).service('$async', function($q) {\n                /**\n                 * @param {Function} fn\n                 */\n                return function $async(fn) {\n                    const deferred = $q.defer();\n                    promises.push(deferred.promise);\n                    try {\n                        fn.call(document.parentWindow,()=>{\n                            deferred.resolve();\n                        }, (err)=> {\n                            deferred.reject(err);\n                        });\n                    }\n                    catch(err) {\n                        deferred.reject(err);\n                    }\n\n                };\n            });\n            app.service('$http', HttpInternalProvider);\n            //copy application directives\n            Object.keys(angularServer.directives).forEach(function(name) {\n                app.directive(name, angularServer.directives[name]);\n            });\n            //copy application services\n            Object.keys(angularServer.services).forEach(function(name) {\n                app.service(name, angularServer.services[name]);\n            });\n            //copy application filters\n            Object.keys(angularServer.filters).forEach(function(name) {\n                app.filter(name, angularServer.filters[name]);\n            });\n            //copy application controllers\n            Object.keys(angularServer.controllers).forEach(function(name) {\n                app.controller(name, angularServer.controllers[name]);\n            });\n            //get application element\n            const appElement = angular.element(document).find('*[server-app=\\'server\\']').get(0);\n            if (appElement) {\n                //get $q\n                const $q = angular.injector(['ng']).get('$q');\n                //initialize app element\n                angular.bootstrap(appElement, ['server']);\n                //wait for promises\n                $q.all(promises).then(function() {\n                    view.body = document.innerHTML;\n                    return callback();\n                }, function(reason) {\n                    //throw exception\n                    callback(new Error(reason));\n                });\n            }\n            else {\n                return callback();\n            }\n        }\n        catch (e) {\n            callback(e);\n        }\n    }\n}\n\n"]}