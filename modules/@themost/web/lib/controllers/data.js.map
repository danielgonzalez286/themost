{"version":3,"sources":["data.es6"],"names":["util","Rx","_","xml","HttpController","httpGet","httpAction","HttpError","HttpMethodNotAllowedError","HttpBadRequestError","HttpNotFoundError","HttpServerError","TraceUtils","httpPut","httpPost","httpDelete","HttpDataController","context","model_","self","Object","defineProperty","get","model","name","set","value","configurable","enumerable","Observable","fromNodeCallback","callback","handle","result","target","convert","params","data","save","err","create","attr","unhandle","e","isArray","insert","postNewItem","clone","JSON","parse","stringify","m","_extend","keys","i","length","key","indexOf","view","source","fields","privileges","constraints","eventListeners","attributes","forEach","x","mapping","inferMapping","calculation","views","field","test","mField","filter","y","hasOwnProperty","id","getItem","postItem","fromPromise","where","getPrimaryKey","equal","first","then","item","isNil","remove","Error","$filter","select","$select","search","$search","skip","$skip","levels","parseInt","$levels","orderBy","$order","$orderby","groupBy","$group","$groupby","expand","$expand","q","apply","split","map","replace","isNaN","orderByDescending","resolver","require","matches","testExpandExpression","top","take","count","asArray","catch","all","records","total","list","getItems","postItems","log","err1","message","code","er","parent","primaryKey","obj","associatedModel","type","parentModel","associationType","junction","property","query","$prepared","$where","$take","childField"],"mappings":"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","file":"data.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\n\nimport util from 'util';\nimport Rx from 'rx';\nimport {_} from 'lodash';\nimport xml from 'most-xml';\nimport {HttpController} from './../mvc';\nimport {httpGet,httpAction} from './../decorators';\nimport {HttpError,HttpMethodNotAllowedError,HttpBadRequestError,HttpNotFoundError,HttpServerError} from '@themost/common/errors';\nimport {TraceUtils} from '@themost/common/utils';\nimport {httpPut, httpPost, httpDelete} from \"../decorators\";\n\n\n/**\n * @classdesc HttpDataController class describes a common MOST Web Framework data controller.\n * This controller is inherited by default from all data models. It offers a set of basic actions for CRUD operations against data objects\n * and allows filtering, paging, sorting and grouping data objects with options similar to [OData]{@link http://www.odata.org/}.\n <h2>Basic Features</h2>\n <h3>Data Filtering ($filter query option)</h3>\n <p>Logical Operators</p>\n <p>The following table contains the logical operators supported in the query language:</p>\n  <table class=\"table-flat\">\n    <thead><tr><th>Operator</th><th>Description</th><th>Example</th></tr></thead>\n    <tbody>\n        <tr><td>eq</td><td>Equal</td><td>/Order/index.json?$filter=customer eq 353</td></tr>\n        <tr><td>ne</td><td>Not Equal</td><td>/Order/index.json?$filter=orderStatus/alternateName ne 'OrderDelivered'</td></tr>\n        <tr><td>gt</td><td>Greater than</td><td>/Order/index.json?$filter=orderedItem/price gt 1000</td></tr>\n        <tr><td>ge</td><td>Greater than or equal</td><td>/Order/index.json?$filter=orderedItem/price ge 500</td></tr>\n        <tr><td>lt</td><td>Lower than</td><td>/Order/index.json?$filter=orderedItem/price lt 500</td></tr>\n        <tr><td>le</td><td>Lower than or equal</td><td>/Order/index.json?$filter=orderedItem/price le 1000</td></tr>\n        <tr><td>and</td><td>Logical and</td><td>/Order/index.json?$filter=orderedItem/price gt 1000 and orderStatus/alternateName eq 'OrderPickup'</td></tr>\n        <tr><td>or</td><td>Logical or</td><td>/Order/index.json?$filter=orderStatus/alternateName eq 'OrderPickup' or orderStatus/alternateName eq 'OrderProcessing'</td></tr>\n    </tbody>\n </table>\n <p>Arithmetic Operators</p>\n <p>The following table contains the arithmetic operators supported in the query language:</p>\n <table class=\"table-flat\">\n     <thead><tr><th>Operator</th><th>Description</th><th>Example</th></tr></thead>\n     <tbody>\n     <tr><td>add</td><td>Addition</td><td>/Order/index.json?$filter=(orderedItem/price add 10) gt 1560</td></tr>\n     <tr><td>sub</td><td>Subtraction</td><td>/Order/index.json?$filter=(orderedItem/price sub 10) gt 1540</td></tr>\n     <tr><td>mul</td><td>Multiplication</td><td>/Order/index.json?$filter=(orderedItem/price mul 1.20) gt 1000</td></tr>\n     <tr><td>div</td><td>Division</td><td>/Order/index.json?$filter=(orderedItem/price div 2) le 500</td></tr>\n     <tr><td>mod</td><td>Modulo</td><td>/Order/index.json?$filter=(orderedItem/price mod 2) eq 0</td></tr>\n     </tbody>\n </table>\n <p>Functions</p>\n <p>A set of functions are also defined for use in $filter query option:</p>\n <table class=\"table-flat\">\n     <thead><tr><th>Function</th><th>Example</th></tr></thead>\n     <tbody>\n        <tr><td colspan=\"2\"><b>String Functions</b></td></tr>\n        <tr><td>startswith(field,string)</td><td>/Product/index.json?$filter=startswith(name,'Apple') eq true</td></tr>\n        <tr><td>endswith(field,string)</td><td>/Product/index.json?$filter=endswith(name,'Workstation') eq true</td></tr>\n        <tr><td>contains(field,string)</td><td>/Product/index.json?$filter=contains(name,'MacBook') eq true</td></tr>\n         <tr><td>length(field)</td><td>/Product/index.json?$filter=length(name) gt 40</td></tr>\n         <tr><td>indexof(field,string)</td><td>/Product/index.json?$filter=indexof(name,'Air') gt 1</td></tr>\n         <tr><td>substring(field,number)</td><td>/Product/index.json?$filter=substring(category,1) eq 'aptops'</td></tr>\n         <tr><td>substring(field,number,number)</td><td>/Product/index.json?$filter=substring(category,1,2) eq 'ap'</td></tr>\n         <tr><td>tolower(field)</td><td>/Product/index.json?$filter=tolower(category) eq 'laptops'</td></tr>\n         <tr><td>toupper(field)</td><td>/Product/index.json?$filter=toupper(category) eq 'LAPTOPS'</td></tr>\n         <tr><td>trim(field)</td><td>/Product/index.json?$filter=trim(category) eq 'Laptops'</td></tr>\n <tr><td colspan=\"2\"><b>Date Functions</b></td></tr>\n <tr><td>day(field)</td><td>/Order/index.json?$filter=day(orderDate) eq 4</td></tr>\n <tr><td>month(field)</td><td>/Order/index.json?$filter=month(orderDate) eq 6</td></tr>\n <tr><td>year(field)</td><td>/Order/index.json?$filter=year(orderDate) ge 2014</td></tr>\n <tr><td>hour(field)</td><td>/Order/index.json?$filter=hour(orderDate) ge 12 and hour(orderDate) lt 14</td></tr>\n <tr><td>minute(field)</td><td>/Order/index.json?$filter=minute(orderDate) gt 15 and minute(orderDate) le 30</td></tr>\n <tr><td>second(field)</td><td>/Order/index.json?$filter=second(orderDate) ge 0 and second(orderDate) le 45</td></tr>\n <tr><td>date(field)</td><td>/Order/index.json?$filter=date(orderDate) eq '2015-03-20'</td></tr>\n <tr><td colspan=\"2\"><b>Math Functions</b></td></tr>\n <tr><td>round(field)</td><td>/Product/index.json?$filter=round(price) le 389</td></tr>\n <tr><td>floor(field)</td><td>/Product/index.json?$filter=floor(price) eq 389</td></tr>\n <tr><td>ceiling(field)</td><td>/Product/index.json?$filter=ceiling(price) eq 390</td></tr>\n      </tbody>\n </table>\n <h3>Attribute Selection ($select query option)</h3>\n <p>The following table contains attribute selection expressions supported in the query language:</p>\n <table class=\"table-flat\">\n     <thead><tr><th>Description</th><th>Example</th></tr></thead>\n     <tbody>\n     <tr><td>Select attribute</td><td>/Order/index.json?$select=id,customer,orderStatus</td></tr>\n     <tr><td>Select attribute with alias</td><td>/Order/index.json?$select=id,customer/description as customerName,orderStatus/name as orderStatusName</td></tr>\n     <tr><td>Select attribute with aggregation</td><td>/Order/index.json?$select=count(id) as totalCount&$filter=orderStatus/alternateName eq 'OrderProcessing'</td></tr>\n     <tr><td>&nbsp;</td><td>/Product/index.json?$select=max(price) as maxPrice&$filter=category eq 'Laptops'</td></tr>\n     <tr><td>&nbsp;</td><td>/Product/index.json?$select=min(price) as minPrice&$filter=category eq 'Laptops'</td></tr>\n </tbody>\n </table>\n <h3>Data Sorting ($orderby or $order query options)</h3>\n <table class=\"table-flat\">\n     <thead><tr><th>Description</th><th>Example</th></tr></thead>\n     <tbody>\n        <tr><td>Ascending order</td><td>/Product/index.json?$orderby=name</td></tr>\n        <tr><td>Descending order</td><td>/Product/index.json?$orderby=category desc,name desc</td></tr>\n     </tbody>\n </table>\n  <h3>Data Paging ($top, $skip and $inlinecount query options)</h3>\n <p>The $top query option allows developers to apply paging in the result-set by giving the max number of records for each page. The default value is 25.\n The $skip query option provides a way to skip a number of records. The default value is 0.\n The $inlinecount query option includes in the result-set the total number of records of the query expression provided:\n <pre class=\"prettyprint\"><code>\n {\n     \"total\": 94,\n     \"records\": [ ... ]\n }\n  </code></pre>\n <p>The default value is false.</p>\n  </p>\n   <table class=\"table-flat\">\n      <thead><tr><th>Description</th><th>Example</th></tr></thead>\n      <tbody>\n      <tr><td>Limit records</td><td>/Product/index.json?$top=5</td></tr>\n      <tr><td>Skip records</td><td>/Product/index.json?$top=5&$skip=5</td></tr>\n      <tr><td>Paged records</td><td>/Product/index.json?$top=5&$skip=5&$inlinecount=true</td></tr>\n      </tbody>\n  </table>\n  <h3>Data Grouping ($groupby or $group query options)</h3>\n  <p>The $groupby query option allows developers to group the result-set by one or more attributes</p>\n  <table class=\"table-flat\">\n  <thead><tr><th>Description</th><th>Example</th></tr></thead>\n  <tbody>\n  <tr><td>group</td><td>/Product/index.json?$select=count(id) as totalCount,category&$groupby=category</td></tr>\n  <tr><td>group and sort</td><td>/Product/index.json?$select=count(id) as totalCount,category&$groupby=category&$orderby=count(id) desc</td></tr>\n  </tbody>\n  </table>\n <h3>Data Expanding ($expand)</h3>\n <p>The $expand query option forces response to include associated objects which are not marked as expandable by default.</p>\n <table class=\"table-flat\">\n     <thead><tr><th>Description</th><th>Example</th></tr></thead>\n     <tbody>\n     <tr><td>expand</td><td>/Order/index.json?$filter=orderStatus/alternateName eq 'OrderProcessing'&$expand=customer</td></tr>\n     </tbody>\n </table>\n <p>The $expand option is optional for a <a href=\"https://docs.themost.io/most-data/DataField.html\">DataField</a> marked as expandable.</p>\n * @class\n * @constructor\n * @augments HttpController\n * @property {DataModel} model - Gets or sets the current data model.\n * @memberOf module:most-web.controllers\n */\nexport default class HttpDataController extends HttpController {\n    /**\n     * @constructor\n     * @param {HttpContext} context\n     */\n    constructor(context) {\n        super(context);\n        let model_;\n        const self = this;\n        Object.defineProperty(this, 'model', {\n            get: function() {\n                if (model_)\n                    return model_;\n                model_ = self.context.model(self.name);\n                return model_;\n            },\n            set: function(value) {\n                model_ = value;\n            }, configurable:false, enumerable:false\n        });\n    }\n\n    /**\n     * Handles data object creation (e.g. /user/new.html, /user/new.json etc)\n     * @returns {Observable}\n     */\n    @httpGet()\n    @httpAction('new')\n    getNewItem() {\n\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            callback(null, {});\n        })();\n\n        try {\n            const self = this, context = self.context;\n            context.handle(['GET'],function() {\n                callback(null, self.result());\n            }).handle(['POST', 'PUT'],function() {\n                const target = self.model.convert(context.params[self.model.name] || context.params.data, true);\n                self.model.save(target, function(err)\n                {\n                    if (err) {\n                        callback(HttpError.create(err));\n                    }\n                    else {\n                        if (context.params.attr('returnUrl'))\n                            callback(null, context.params.attr('returnUrl'));\n                        callback(null, self.result(target));\n                    }\n                });\n            }).unhandle(function() {\n                callback(new HttpMethodNotAllowedError());\n            });\n        }\n        catch (e) {\n            callback(HttpError.create(e));\n        }\n    }\n\n    /**\n     * Handles data object insertion (e.g. /user/new.html, /user/new.json etc)\n     * @returns {Observable}\n     */\n    @httpPost()\n    @httpAction('new')\n    postNewItem(data) {\n        const self = this;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            if (_.isArray(data)) {\n                return callback(new HttpBadRequestError());\n            }\n            const target = self.model.convert(data, true);\n            self.model.insert(target, function(err)\n            {\n                if (err) {\n                    callback(HttpError.create(err));\n                }\n                else {\n                    callback(null, target);\n                }\n            });\n        })();\n    }\n\n    /**\n     * Handles data object insertion (e.g. /user/new.html, /user/new.json etc)\n     * @returns {Observable}\n     */\n    @httpPut()\n    @httpAction('new')\n    putNewItem(data) {\n        return this.postNewItem(data);\n    }\n\n    @httpGet()\n    @httpAction('schema')\n    getSchema() {\n        const self = this, context = self.context;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            if (self.model) {\n                //prepare client model\n                const clone = JSON.parse(JSON.stringify(self.model));\n                const m = util._extend({}, clone);\n                //delete private properties\n                const keys = Object.keys(m);\n                for (let i = 0; i < keys.length; i++) {\n                    const key = keys[i];\n                    if (key.indexOf(\"_\")==0)\n                        delete m[key];\n                }\n                //delete other server properties\n                delete m.view;\n                delete m.source;\n                delete m.fields;\n                delete m.privileges;\n                delete m.constraints;\n                delete m.eventListeners;\n                //set fields equal attributes\n                m.attributes = JSON.parse(JSON.stringify(self.model.attributes));\n                m.attributes.forEach(function(x) {\n                    const mapping = self.model.inferMapping(x.name);\n                    if (mapping)\n                        x.mapping = JSON.parse(JSON.stringify(mapping));\n                    //delete private properties\n                    delete x.value;\n                    delete x.calculation;\n                });\n                //prepare views and view fields\n                if (m.views) {\n                    m.views.forEach(function(view) {\n                        if (view.fields) {\n                            view.fields.forEach(function(field) {\n                                if (/\\./.test(field.name)==false) {\n                                    //extend view field\n                                    const name = field.name;\n                                    const mField = m.attributes.filter(function(y) {\n                                        return (y.name==name);\n                                    })[0];\n                                    if (mField) {\n                                        for (const key in mField) {\n                                            if (mField.hasOwnProperty(key) && !field.hasOwnProperty(key)) {\n                                                field[key] = mField[key];\n                                            }\n                                        }\n                                    }\n                                }\n                            });\n                        }\n                    });\n                }\n                callback(null, m);\n            }\n            else {\n                callback(new HttpNotFoundError());\n            }\n        })();\n\n    }\n\n    /**\n     * Handles data object display (e.g. /user/1/edit.html, /user/1/edit.json etc)\n     * @param {*} id\n     * @returns {Observable}\n     */\n    @httpGet()\n    @httpAction('edit')\n    editItem(id) {\n        return this.getItem(id);\n    }\n\n    /**\n     * Handles data object post (e.g. /user/1/edit.html, /user/1/edit.json etc)\n     * @param {*} id\n     * @returns {Observable|*}\n     */\n    @httpPost()\n    @httpAction('edit')\n    postItem(id) {\n        const self = this;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            const target = self.model.convert(data, true);\n            if (target) {\n                self.model.save(target, function(err)\n                {\n                    if (err) {\n                        callback(HttpError.create(err));\n                    }\n                    else {\n                        return callback(null, target);\n                    }\n                });\n            }\n            else {\n                callback(new HttpBadRequestError());\n            }\n        })();\n    }\n\n    /**\n     * Handles data object put (e.g. /user/1/edit.html, /user/1/edit.json etc)\n     * @param {*} id\n     * @returns {Observable|*}\n     */\n    @httpPut()\n    @httpAction('edit')\n    putItem(id) {\n        return this.postItem(id);\n    }\n\n    /**\n     * Handles data object post (e.g. /user/1/edit.html, /user/1/edit.json etc)\n     * @param {*} id\n     * @returns {Observable|*}\n     */\n    @httpDelete()\n    @httpAction('edit')\n    deleteItem(id) {\n        const self = this;\n        return Rx.Observable.fromPromise(function(id) {\n                return self.model.where(self.model.getPrimaryKey()).equal(id).first().then(function(item) {\n                    if (_.isNil(item)) {\n                        throw new HttpNotFoundError();\n                    }\n                    return self.model.remove(item);\n                });\n            })(id);\n    }\n\n    /**\n     * Handles data object display (e.g. /user/1/show.html, /user/1/show.json etc)\n     * @param {*} id\n     * @returns {Observable|*}\n     */\n    @httpGet()\n    @httpAction('show')\n    getItem(id) {\n        return Rx.Observable.fromPromise(this.model.where(this.model.getPrimaryKey()).equal(id).first)(id);\n    }\n    /**\n     * @param {Function} callback\n     * @private\n     */\n    filter(callback) {\n\n        const self = this, params = self.context.params;\n\n        if (typeof self.model !== 'object' || self.model == null) {\n            callback(new Error('Model is of the wrong type or undefined.'));\n            return;\n        }\n\n        const filter = params.$filter, select = params.$select, search = params.$search, skip = params.$skip || 0, levels = parseInt(params.$levels), orderBy = params.$order || params.$orderby, groupBy = params.$group || params.$groupby, expand = params.$expand;\n\n        self.model.filter(filter,\n            /**\n             * @param {Error} err\n             * @param {DataQueryable} q\n             */\n             function (err, q) {\n                try {\n                    if (err) {\n                        return callback(err);\n                    }\n                    else {\n                        if ((typeof search === 'string') && (search.length>0)) {\n                            q.search(search);\n                        }\n                        //set $groupby\n                        if (groupBy) {\n                            q.groupBy.apply(q, groupBy.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }));\n                        }\n                        //set $select\n                        if (select) {\n                            q.select.apply(q, select.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }));\n                        }\n                        //set $skip\n                        if (!/^\\d+$/.test(skip)) {\n                            return callback(new HttpBadRequestError(\"Skip may be a non-negative integer.\"))\n                        }\n                        //set expandable levels\n                        if (!isNaN(levels)) {\n                            q.levels(levels);\n                        }\n                        q.skip(skip);\n                        //set $orderby\n                        if (orderBy) {\n                            orderBy.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }).forEach(function(x) {\n                                if (/\\s+desc$/i.test(x)) {\n                                    q.orderByDescending(x.replace(/\\s+desc$/i, ''));\n                                }\n                                else if (/\\s+asc/i.test(x)) {\n                                    q.orderBy(x.replace(/\\s+asc/i, ''));\n                                }\n                                else {\n                                    q.orderBy(x);\n                                }\n                            });\n                        }\n                        if (expand) {\n                            const resolver = require(\"most-data/data-expand-resolver\");\n                            const matches = resolver.testExpandExpression(expand);\n                            if (matches && matches.length>0) {\n                                q.expand.apply(q, matches);\n                            }\n                        }\n                        //return\n                        callback(null, q);\n                    }\n                }\n                catch (e) {\n                   callback(e);\n                }\n            });\n    }\n\n    @httpGet()\n    @httpAction('index')\n    getItems() {\n        const self = this, context = self.context;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n\n            const top = parseInt(context.params.attr('$top')),\n                take = top > 0 ? top : (top == -1 ? top : 25),\n                count = /^true$/ig.test(context.params.attr('$inlinecount')) || false,\n                first = /^true$/ig.test(context.params.attr('$first')) || false,\n                asArray = /^true$/ig.test(context.params.attr('$array')) || false;\n\n            self.filter(\n                /**\n                 * @param {Error} err\n                 * @param {DataQueryable=} q\n                 */\n                function(err, q) {\n                    try {\n                        if (err) {\n                            return callback(HttpError.create(err));\n                        }\n                        //apply as array parameter\n                        q.asArray(asArray);\n                         if (first) {\n                            return q.first().then(function(result) {\n                                return callback(null, result);\n                            }).catch(function(err) {\n                                return callback(HttpError.create(err));\n                            });\n                        }\n\n                        if (take<0) {\n                            return q.all().then(function(result) {\n                                if (count) {\n                                    return callback(null, self.result({\n                                        records:result,\n                                        total:result.length\n                                    }));\n                                }\n                                else {\n                                    return callback(null, result);\n                                }\n                            }).catch(function(err) {\n                                return callback(HttpError.create(err));\n                            });\n                        }\n                        else {\n                            if (count) {\n                                return q.take(take).list().then(function(result) {\n                                    return callback(null, result);\n                                }).catch(function(err) {\n                                    return callback(HttpError.create(err));\n                                });\n                            }\n                            else {\n                                return q.take(take).getItems().then(function(result) {\n                                    return callback(null, result);\n                                }).catch(function(err) {\n                                    return callback(HttpError.create(err));\n                                });\n                            }\n                        }\n                    }\n                    catch (err) {\n                        return callback(err);\n                    }\n                });\n        })();\n    }\n    /**\n     * @param {*} data\n     */\n    @httpPut()\n    @httpAction('index')\n    putItems(data) {\n        return this.postItems(data);\n    }\n\n    /**\n     * @param {*} data\n     */\n    @httpPost()\n    @httpAction('index')\n    postItems(data) {\n        const self = this;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            let target;\n            try {\n                target = self.model.convert(data, true);\n            }\n            catch(err) {\n                TraceUtils.log(err);\n                const err1 = new HttpError(422, \"An error occured while converting data objects.\", err.message);\n                err1.code = 'EDATA';\n                return callback(err1);\n            }\n            if (target) {\n                self.model.save(target, function(err)\n                {\n                    if (err) {\n                        TraceUtils.log(err);\n                        callback(HttpError.create(err));\n                    }\n                    else {\n                        callback(null, self.result(target));\n                    }\n                });\n            }\n            else {\n                return callback(new HttpBadRequestError());\n            }\n        })();\n    }\n\n    @httpDelete()\n    @httpAction('index')\n    deleteItems(data) {\n        const self = this;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            //get data\n            let target;\n            try {\n                target = self.model.convert(data, true);\n            }\n            catch(err) {\n                TraceUtils.log(err);\n                const er = new HttpError(422, \"An error occured while converting data objects.\", err.message);\n                er.code = 'EDATA';\n                return callback(er);\n            }\n            if (target) {\n                self.model.remove(target, function(err)\n                {\n                    if (err) {\n                        callback(HttpError.create(err));\n                    }\n                    else {\n                        callback(null, self.result(target));\n                    }\n                });\n            }\n            else {\n                return callback(new HttpBadRequestError());\n            }\n        })();\n    }\n\n    /**\n     * Returns an instance of HttpResult class which contains a collection of items based on the specified association.\n     * This association should be a one-to-many association or many-many association.\n     * A routing for this action may be:\n     <pre class=\"prettyprint\"><code>\n     { \"url\":\"/:controller/:parent/:model/index.json\", \"mime\":\"application/json\", \"action\":\"association\" }\n     </code></pre>\n     <p>\n     or\n     </p>\n     <pre class=\"prettyprint\"><code>\n     { \"url\":\"/:controller/:parent/:model/index.html\", \"mime\":\"text/html\", \"action\":\"association\" }\n     </code></pre>\n      <pre class=\"prettyprint\"><code>\n     //get orders in JSON format\n     /GET /Party/353/Order/index.json\n     </code></pre>\n     <p>\n     This action supports common query options like $filter, $order, $top, $skip etc.\n     The result will be a result-set with associated items:\n     </p>\n     <pre class=\"prettyprint\"><code>\n        //JSON Results:\n     {\n            \"total\": 8,\n            \"skip\": 0,\n            \"records\": [\n                {\n                \"id\": 37,\n                \"customer\": 353,\n                \"orderDate\": \"2015-05-05 01:19:34.000+03:00\",\n                \"orderedItem\": {\n                    \"id\": 407,\n                    \"additionalType\": \"Product\",\n                    \"category\": \"PC Components\",\n                    \"price\": 1625.49,\n                    \"model\": \"HR5845\",\n                    \"releaseDate\": \"2015-09-20 03:35:33.000+03:00\",\n                    \"name\": \"Nvidia GeForce GTX 650 Ti Boost\",\n                    \"dateCreated\": \"2015-11-23 14:53:04.884+02:00\",\n                    \"dateModified\": \"2015-11-23 14:53:04.887+02:00\"\n                },\n                \"orderNumber\": \"OFV804\",\n                \"orderStatus\": {\n                    \"id\": 1,\n                    \"name\": \"Delivered\",\n                    \"alternateName\": \"OrderDelivered\",\n                    \"description\": \"Representing the successful delivery of an order.\"\n                },\n                \"paymentDue\": \"2015-05-25 01:19:34.000+03:00\",\n                \"paymentMethod\": {\n                    \"id\": 6,\n                    \"name\": \"Direct Debit\",\n                    \"alternateName\": \"DirectDebit\",\n                    \"description\": \"Payment by direct debit\"\n                },\n                \"additionalType\": \"Order\",\n                \"dateCreated\": \"2015-11-23 21:00:18.264+02:00\",\n                \"dateModified\": \"2015-11-23 21:00:18.266+02:00\"\n                }\n            ...]\n       ...\n    }\n    </code></pre>\n     *@returns {Observable}\n     */\n    @httpGet()\n    @httpAction('association')\n    getAssociatedItems(parent, model) {\n        const self = this;\n        return Rx.Observable.fromNodeCallback(function(callback) {\n            if (_.isNil(parent) || _.isNil(model)) {\n                return callback(new HttpBadRequestError());\n            }\n            self.model.where(self.model.primaryKey).equal(parent).select([self.model.primaryKey]).first(function(err, result) {\n                if (err) {\n                    TraceUtils.log(err);\n                    callback(new HttpServerError());\n                    return;\n                }\n                if (_.isNil(result)) {\n                    callback(new HttpNotFoundError());\n                    return;\n                }\n                //get parent object (DataObject)\n                const obj = self.model.convert(result);\n                const associatedModel = self.context.model(model);\n                if (_.isNil(associatedModel)) {\n                    callback(new HttpNotFoundError());\n                    return;\n                }\n                /**\n                 * Search for object junction\n                 */\n                let field = self.model.attributes.filter(function(x) { return x.type === associatedModel.name; })[0], mapping;\n                if (field) {\n                    /**\n                     * Get association mapping fo this field\n                     * @type {DataAssociationMapping}\n                     */\n                    mapping = self.model.inferMapping(field.name);\n                    if (mapping) {\n                        if ((mapping.parentModel===self.model.name) && (mapping.associationType==='junction')) {\n                            /**\n                             * @type {DataQueryable}\n                             */\n                            const junction = obj.property(field.name);\n                            junction.model.filter(self.context.params, function(err, q) {\n                                if (err) {\n                                    callback(err);\n                                }\n                                else {\n                                    //merge properties\n                                    if (q.query.$select) { junction.query.$select = q.query.$select; }\n                                    if (q.query.$group) { junction.query.$group = q.query.$group; }\n                                    if (q.query.$order) { junction.query.$order = q.query.$order; }\n                                    if (q.query.$prepared) { junction.query.$where = q.query.$prepared; }\n                                    if (q.query.$skip) { junction.query.$skip = q.query.$skip; }\n                                    if (q.query.$take) { junction.query.$take = q.query.$take; }\n                                    junction.list(function(err, result) {\n                                        callback(err, self.result(result));\n                                    });\n                                }\n                            });\n                            return;\n                        }\n                    }\n                }\n                field = associatedModel.attributes.filter(function(x) { return x.type === self.model.name; })[0];\n                if (_.isNil(field)) {\n                    callback(new HttpNotFoundError());\n                    return;\n                }\n                //get field mapping\n                mapping = associatedModel.inferMapping(field.name);\n                associatedModel.filter(self.context.params, function(err, q) {\n                    if (err) {\n                        callback(err);\n                    }\n                    else {\n                        q.where(mapping.childField).equal(parent).list(function(err, result) {\n                            callback(err, self.result(result));\n                        });\n                    }\n                });\n            });\n        })();\n    }\n}\n"]}