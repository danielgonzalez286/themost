{"version":3,"sources":["model.es6"],"names":["_","Q","sprintf","async","OpenDataParser","QueryExpression","SequentialEventEmitter","DataError","TraceUtils","PathUtils","DataAssociationMapping","DataModelMigration","ParserUtils","RequiredValidator","MaxLengthValidator","DataTypeValidator","DataValidatorListener","CalculatedValueListener","NotNullConstraintListener","DefaultValueListener","UniqueConstraintListener","DataModelSeedListener","DataModelCreateViewListener","DataCachingListener","DataNestedObjectListener","DataStateValidatorListener","DataObjectAssociationListener","DataQueryable","DataAttributeResolver","DataModelView","DataFilterResolver","ModelClassLoaderStrategy","ModuleLoaderStrategy","inferTagMapping_","field","self","isNil","hasOwnProperty","many","conf","context","getConfiguration","dataType","dataTypes","type","name","concat","upperFirst","primaryKey","key","EmptyQueryExpression","DataModel","obj","hidden","sealed","abstract","version","caching","fields","eventListeners","constraints","views","privileges","assign","context_","Object","defineProperty","get","set","value","enumerable","configurable","source","view","silent_","silent","pluralExpression","attributes","_clearAttributes","baseModel","base","forEach","x","test","mapping","associationType","model","clone","primary","cloned","push","find","y","undefined","primaryKey_","getPrimaryKey","p","attributeNames","map","arr","isArray","baseArr","constraintCollection","registerListeners_","bind","initialize","result","join","attr","where","text","search","params","callback","parser","$joinExpressions","$select","split","length","getDataView","resolveMember","member","cb","property","prototype","testNestedAttribute","call","member1","inferMapping","expr","expr1","resolveJunctionAttributeJoin","$expand","$name","replace","resolveNestedAttributeJoin","arrExpr","apply","joinExpr","$entity","$as","err","resolveMethod","args","filter","q","query","$filter","parse","$where","prepare","select","skip","$skip","orderBy","$orderby","$order","groupBy","$groupby","$group","expand","levels","parseInt","$levels","top","$top","$take","isNaN","take","orderByDescending","resolver","require","matches","testExpandExpression","e","equal","bQueried","and","Array","slice","arguments","n","list","first","all","max","min","inherits","Error","typeConvert","DataObjectClass","getStrategy","resolve","src","o","convertInternal_","state","cast_","dest","eachSeries","parentField","associatedModel","parentModel","cast","d","defer","save_","reject","promise","target","beforeSave","unshift","update_","insert_","remove_","migrationModel","sourceAdapter","count","migrate","cache","migration","add","appliesTo","description","title","models","db","childModel","getAttribute","indexes","toUpperCase","columns","indexed","executeInTransaction","tr","emit","m","alias","resolveField","re","RegExp","mappings_","superTypes","getSuperTypes","indexOf","tagMapping","definitionField","associatedField","childField","cascade","refersTo","PluralExpression","isBoolean","associationAdapter","validate_","process","nextTick","migrations","then","getModelDefinition","catch","getTypedItems","getTypedList","getItems","removeAllListeners","perms","on","beforeRemove","beforeExecute","afterExecute","afterUpgrade","i","listener","disabled","getApplication","afterSave","afterRemove","DataPermissionEventListener","parsers","$state","readonly","calculation","editable","castForValidation_","parseBoolean","res","item","saveCallback","saveSingleObject_","insertedId","saveBaseObject_","removeSingleObject_","once","create","insert","into","keys","update","recast","pm","nextIdentity","adapter","a","b","$insert","execute","lastIdentity","lastCallback","insertId","lastResult","save","removeCallback","delete","removeBaseObject_","cacheMapping_","cachedModel","cachedField","objCopy","validationResult","arrValidators","nullable","validation","maxLength","size","validatorModule","modulePath","getExecutionPath","debug","createInstance","validationProperties","properties","validator","setContext","validateSync","code","message","innerMessage","validate"],"mappings":"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","file":"model.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\nimport 'source-map-support/register';\nimport _ from 'lodash';\nimport Q from 'q';\nimport sprintf from 'sprintf';\nimport async from 'async';\nimport {OpenDataParser} from '@themost/query/odata';\nimport {QueryExpression} from '@themost/query/query';\nimport {SequentialEventEmitter} from '@themost/common/emitter';\nimport {DataError} from '@themost/common/errors';\nimport {TraceUtils,PathUtils} from '@themost/common/utils';\nimport {DataAssociationMapping,DataModelMigration,ParserUtils} from './types';\nimport {RequiredValidator,MaxLengthValidator,DataTypeValidator,DataValidatorListener} from \"./validators\";\nimport {CalculatedValueListener,NotNullConstraintListener,DefaultValueListener,\n    UniqueConstraintListener,\n    DataModelSeedListener, DataModelCreateViewListener, DataCachingListener} from './listeners';\nimport {DataObjectAssociationListener} from './associations';\nimport {DataNestedObjectListener} from './listeners';\nimport {DataStateValidatorListener} from './listeners';\nimport {DataQueryable,DataAttributeResolver} from './queryable';\nimport {DataModelView} from './view';\nimport {DataFilterResolver} from './filter-resolver';\nimport {ModelClassLoaderStrategy} from \"./config\";\nimport {ModuleLoaderStrategy} from \"@themost/common/config\";\n\n/**\n * @memberOf DataModel\n * @param {DataField} field\n * @private\n */\nfunction inferTagMapping_(field) {\n    /**\n     * @type {DataModel|*}\n     */\n    const self = this;\n    //validate field argument\n    if (_.isNil(field)) {\n        return;\n    }\n    //validate DataField.many attribute\n    if (!(field.hasOwnProperty('many') && field.many === true)) {\n        return;\n    }\n    //check if the type of the given field is a primitive data type\n    //(a data type that is defined in the collection of data types)\n    const conf = self.context.getConfiguration(), dataType = conf.dataTypes[field.type];\n    if (_.isNil(dataType)) {\n        return;\n    }\n    //get associated model name\n    const name = self.name.concat(_.upperFirst(field.name));\n    const primaryKey = self.key();\n    return new DataAssociationMapping({\n        \"associationType\": \"junction\",\n        \"associationAdapter\": name,\n        \"cascade\": \"delete\",\n        \"parentModel\": self.name,\n        \"parentField\": primaryKey.name,\n        \"refersTo\": field.name\n    });\n}\n\n/**\n * @ignore\n * @class\n * @augments QueryExpression\n */\nclass EmptyQueryExpression {\n    //\n}\n\n/**\n * @classdesc DataModel class extends a JSON data model and performs all data operations (select, insert, update and delete) in MOST Data Applications.\n <p>\n     These JSON schemas are in config/models folder:\n </p>\n <pre class=\"prettyprint\"><code>\n /\n + config\n   + models\n     - User.json\n     - Group.json\n     - Account.json\n     ...\n </code></pre>\n <p class=\"pln\">\n The following JSON schema presents a typical User model with fields, views, privileges, constraints, listeners, and seeding:\n </p>\n <pre class=\"prettyprint\"><code>\n {\n     \"name\": \"User\", \"id\": 90, \"title\": \"Application Users\", \"inherits\": \"Account\", \"hidden\": false, \"sealed\": false, \"abstract\": false, \"version\": \"1.4\",\n     \"fields\": [\n         {\n             \"name\": \"id\", \"title\": \"Id\", \"description\": \"The identifier of the item.\",\n             \"type\": \"Integer\",\n             \"nullable\": false,\n             \"primary\": true\n         },\n         {\n             \"name\": \"accountType\",  \"title\": \"Account Type\", \"description\": \"Contains a set of flags that define the type and scope of an account object.\",\n             \"type\": \"Integer\",\n             \"readonly\":true,\n             \"value\":\"javascript:return 0;\"\n         },\n         {\n             \"name\": \"lockoutTime\", \"title\": \"Lockout Time\", \"description\": \"The date and time that this account was locked out.\",\n             \"type\": \"DateTime\",\n             \"readonly\": true\n         },\n         {\n             \"name\": \"logonCount\", \"title\": \"Logon Count\", \"description\": \"The number of times the account has successfully logged on.\",\n             \"type\": \"Integer\",\n             \"value\": \"javascript:return 0;\",\n             \"readonly\": true\n         },\n         {\n             \"name\": \"enabled\", \"title\": \"Enabled\", \"description\": \"Indicates whether a user is enabled or not.\",\n             \"type\": \"Boolean\",\n             \"nullable\": false,\n             \"value\": \"javascript:return true;\"\n         },\n         {\n             \"name\": \"lastLogon\", \"title\": \"Last Logon\", \"description\": \"The last time and date the user logged on.\",\n             \"type\": \"DateTime\",\n             \"readonly\": true\n         },\n         {\n             \"name\": \"groups\", \"title\": \"User Groups\", \"description\": \"A collection of groups where user belongs.\",\n             \"type\": \"Group\",\n             \"expandable\": true,\n             \"mapping\": {\n                 \"associationAdapter\": \"GroupMembers\", \"parentModel\": \"Group\",\n                 \"parentField\": \"id\", \"childModel\": \"User\", \"childField\": \"id\",\n                 \"associationType\": \"junction\", \"cascade\": \"delete\",\n                 \"select\": [\n                     \"id\",\n                     \"name\",\n                     \"alternateName\"\n                 ]\n             }\n         },\n         {\n             \"name\": \"additionalType\",\n             \"value\":\"javascript:return this.model.name;\",\n             \"readonly\":true\n         },\n         {\n             \"name\": \"accountType\",\n             \"value\": \"javascript:return 0;\"\n         }\n     ], \"privileges\":[\n         { \"mask\":1, \"type\":\"self\", \"filter\":\"id eq me()\" },\n         { \"mask\":15, \"type\":\"global\", \"account\":\"*\" }\n     ],\n     \"constraints\":[\n         {\n             \"description\": \"User name must be unique across different records.\",\n             \"type\":\"unique\",\n             \"fields\": [ \"name\" ]\n         }\n     ],\n     \"views\": [\n         {\n             \"name\":\"list\", \"title\":\"Users\", \"fields\":[\n                 { \"name\":\"id\", \"hidden\":true },\n                 { \"name\":\"description\" },\n                 { \"name\":\"name\" },\n                 { \"name\":\"enabled\" , \"format\":\"yesno\" },\n                 { \"name\":\"dateCreated\", \"format\":\"moment : 'LLL'\" },\n                 { \"name\":\"dateModified\", \"format\":\"moment : 'LLL'\" }\n             ], \"order\":\"dateModified desc\"\n         }\n     ],\n     \"eventListeners\": [\n         { \"name\":\"New User Credentials Provider\", \"type\":\"/app/controllers/user-credentials-listener\" }\n     ],\n     \"seed\":[\n         {\n             \"name\":\"anonymous\",\n             \"description\":\"Anonymous User\",\n             \"groups\":[\n                 { \"name\":\"Guests\" }\n             ]\n         },\n         {\n             \"name\":\"admin@example.com\",\n             \"description\":\"Site Administrator\",\n             \"groups\":[\n                 { \"name\":\"Administrators\" }\n             ]\n         }\n     ]\n }\n </code></pre>\n *\n * @class\n * @property {string} classPath - Gets or sets a string which represents the path of the DataObject subclass associated with this model.\n * @property {string} name - Gets or sets a string that represents the name of the model.\n * @property {number} id - Gets or sets an integer that represents the internal identifier of the model.\n * @property {boolean} hidden - Gets or sets a boolean that indicates whether the current model is hidden or not. The default value is false.\n * @property {string} title - Gets or sets a title for this data model.\n * @property {boolean} sealed - Gets or sets a boolean that indicates whether current model is sealed or not. A sealed model cannot be migrated.\n * @property {boolean} abstract - Gets or sets a boolean that indicates whether current model is an abstract model or not.\n * @property {string} version - Gets or sets the version of this data model.\n * @property {string} type - Gets or sets an internal type for this model.\n * @property {DataCachingType|string} caching - Gets or sets a string that indicates the caching type for this model. The default value is none.\n * @property {string} inherits - Gets or sets a string that contains the model that is inherited by the current model.\n * @property {DataField[]} fields - Gets or sets an array that represents the collection of model fields.\n * @property {DataModelEventListener[]} eventListeners - Gets or sets an array that represents the collection of model listeners.\n * @property {Array} constraints - Gets or sets the array of constraints which are defined for this model\n * @property {DataModelView[]} views - Gets or sets the array of views which are defined for this model\n * @property {DataModelPrivilege[]} privileges - Gets or sets the array of privileges which are defined for this model\n * @property {string} source - Gets or sets a string which represents the source database object for this model.\n * @property {string} view - Gets or sets a string which represents the view database object for this model.\n * @property {DataContext|*} - Gets or sets the data context of this model.\n * @property {DataField[]} attributes - Gets an array of DataField objects which represents the collection of model fields (including fields which are inherited from the base model).\n * @property {Array} seed - An array of objects which represents a collection of items to be seeded when the model is being generated for the first time\n * @augments SequentialEventEmitter\n */\nexport class DataModel extends SequentialEventEmitter {\n    /**\n     * @constructor\n     * @param {*} obj - An object which represents the definition of the data model\n     * @param {DataContext} context - An instance of DataContext class which represents the current data context\n     */\n    constructor(obj, context) {\n        super();\n        this.hidden = false;\n        this.sealed = false;\n        this.abstract = false;\n        this.version = '0.1';\n        this.type = 'data';\n        this.caching = 'none';\n        this.fields = [];\n        this.eventListeners = [];\n        this.constraints = [];\n        this.views = [];\n        this.privileges = [];\n        //extend model if obj parameter is defined\n        if (obj)\n        {\n            if (typeof obj === 'object')\n                _.assign(this, obj);\n        }\n\n        /**\n         * Gets or sets the underlying data adapter\n         * @type {DataContext}\n         * @private\n         */\n        let context_ = context;\n        const self = this;\n        Object.defineProperty(this, 'context', { get: function() {\n            return context_;\n        }, set: function(value) {\n            context_ = value;\n        }, enumerable: false, configurable: false});\n\n        Object.defineProperty(this, 'sourceAdapter', { get: function() {\n            return _.isNil(self.source) ? self.name.concat('Base') : self.source;\n        }, enumerable: false, configurable: false});\n\n        Object.defineProperty(this, 'viewAdapter', { get: function() {\n            return _.isNil(self.view) ? self.name.concat('Data') : self.view;\n        }, enumerable: false, configurable: false});\n\n        let silent_ = false;\n        /**\n         * Prepares a silent data operation (for query, update, insert, delete etc).\n         * In a silent execution, permission check will be omitted.\n         * Any other listeners which are prepared for using silent execution will use this parameter.\n         * @param {Boolean=} value\n         * @returns DataModel\n         */\n        this.silent = function(value) {\n            if (typeof value === 'undefined')\n                silent_ = true;\n            else\n                silent_ = !!value;\n            return this;\n        };\n\n        Object.defineProperty(this, '$silent', { get: function() {\n            return silent_;\n        }, enumerable: false, configurable: false});\n\n        const pluralExpression = /([a-zA-Z]+?)([e']s|[^aiou]s)$/;\n        /**\n         * @type {Array}\n         */\n        let attributes;\n        /**\n         * @private\n         */\n        this._clearAttributes = function() {\n            attributes = null;\n        };\n\n        /**\n         * Gets an array of objects that represents the collection of fields for this model.\n         * This collection contains the fields defined in the current model and its parent.\n         * @type {Array}\n         *\n         */\n        Object.defineProperty(this, 'attributes', { get: function() {\n            //validate self field collection\n            if (typeof attributes !== 'undefined' && attributes !== null)\n                return attributes;\n            //init attributes collection\n            attributes = [];\n\n            //get base model (if any)\n            const baseModel = self.base();\n\n            let field;\n            //enumerate fields\n            self.fields.forEach(function(x) {\n                if (typeof x.many === 'undefined') {\n                    if (typeof self.context.getConfiguration().dataTypes[x.type] === 'undefined')\n                        //set one-to-many attribute (based on a naming convention)\n                        x.many = pluralExpression.test(x.name) || (x.mapping && x.mapping.associationType === 'junction');\n                    else\n                        //otherwise set one-to-many attribute to false\n                        x.many = false;\n                }\n                //re-define field model attribute\n                if (typeof x.model === 'undefined')\n                    x.model = self.name;\n                let clone = x;\n                //if base model exists and current field is not primary key field\n                if (baseModel && !x.primary) {\n                    //get base field\n                    field = baseModel.field(x.name);\n                    if (field) {\n                        //clone field\n                        clone = { };\n                        //get all inherited properties\n                        _.assign(clone, field);\n                        //get all overridden properties\n                        _.assign(clone, x);\n                        //set field model\n                        clone.model = field.model;\n                        //set cloned attribute\n                        clone.cloned = true;\n                    }\n                }\n                //finally push field\n                attributes.push(clone);\n            });\n            if (baseModel) {\n                baseModel.attributes.forEach(function(x) {\n                    if (!x.primary) {\n                        //check if member is overridden by the current model\n                        field = self.fields.find(function(y) { return y.name === x.name; });\n                        if (typeof field === 'undefined')\n                            attributes.push(x);\n                    }\n                });\n            }\n            return attributes;\n        }, enumerable: false, configurable: false});\n        /**\n         * Gets the primary key name\n         * @type String\n        */\n        this.primaryKey = undefined;\n        //local variable for DateModel.primaryKey\n        let primaryKey_;\n        Object.defineProperty(this, 'primaryKey' , { get: function() {\n            return self.getPrimaryKey();\n        }, enumerable: false, configurable: false});\n\n        this.getPrimaryKey = function() {\n            if (typeof primaryKey_ !== 'undefined') { return primaryKey_; }\n            const p = self.fields.find(function(x) { return x.primary===true; });\n            if (p) {\n                primaryKey_ = p.name;\n                return primaryKey_;\n            }\n        };\n\n        /**\n         * Gets an array that contains model attribute names\n         * @type Array\n        */\n        this.attributeNames = undefined;\n        Object.defineProperty(this, 'attributeNames' , { get: function() {\n            return self.attributes.map(function(x) {\n                return x.name;\n            });\n        }, enumerable: false, configurable: false});\n        Object.defineProperty(this, 'constraintCollection' , { get: function() {\n            const arr = [];\n            if (_.isArray(self.constraints)) {\n                //apend constraints to collection\n                self.constraints.forEach(function(x) {\n                    arr.push(x);\n                });\n            }\n            //get base model\n            const baseModel = self.base();\n            if (baseModel) {\n                //get base model constraints\n                const baseArr = baseModel.constraintCollection;\n                if (_.isArray(baseArr)) {\n                    //apend to collection\n                    baseArr.forEach(function(x) {\n                        arr.push(x);\n                    });\n                }\n            }\n            return arr;\n        }, enumerable: false, configurable: false});\n\n        //register listeners\n        registerListeners_.bind(this)();\n        //call initialize method\n        if (typeof this.initialize === 'function')\n            this.initialize();\n    }\n\n    /**\n     * Initializes the current data model. This method is used for extending the behaviour of an install of DataModel class.\n     */\n    initialize() {\n        //\n    }\n\n    /**\n     * Gets a string which represents the name of the database object that is going to be used while inserting, updating or deleting data objects\n     * @returns {string}\n     */\n    getSourceAdapter() {\n        return _.isNil(this.source) ? this.name.concat('Base') : this.source;\n    }\n\n    /**\n     * Gets a string which represents the name of the database object that is going to be used while selecting data objects.\n     * @returns {string}\n     */\n    getViewAdapter() {\n        return _.isNil(this.view) ? this.name.concat('Data') : this.view;\n    }\n\n    /**\n     * Clones the current data model\n     * @param {DataContext=} context - An instance of DataContext class which represents the current data context.\n     * @returns {DataModel} Returns a new DataModel instance\n     */\n    clone(context) {\n        return new DataModel(this, context);\n    }\n\n    join(model) {\n        const result = new DataQueryable(this);\n        return result.join(model);\n    }\n\n    /**\n     * Initializes a where statement and returns an instance of DataQueryable class.\n     * @param {String|*} attr - A string that represents the name of a field\n     * @returns DataQueryable\n    */\n    where(attr) {\n        const result = new DataQueryable(this);\n        return result.where(attr);\n    }\n\n    /**\n     * Initializes a full-text search statement and returns an instance of DataQueryable class.\n     * @param {String} text - A string that represents the text to search for\n     * @returns DataQueryable\n     */\n    search(text) {\n        const result = new DataQueryable(this);\n        return result.search(text);\n    }\n\n    /**\n     * Returns a DataQueryable instance of the current model\n     * @returns {DataQueryable}\n     */\n    asQueryable() {\n        return new DataQueryable(this);\n    }\n\n    /**\n     * Represents the callback function of DataQueryable.filter() method.\n     * @callback DataModel~FilterCallback\n     * @param {Error=} err\n     * @param {DataQueryable} q\n     */\n\n    /**\n     * Applies open data filter, ordering, grouping and paging params and returns a data queryable object\n     * @param {String|{$filter:string=, $skip:number=, $levels:number=, $top:number=, $take:number=, $order:string=, $inlinecount:string=, $expand:string=,$select:string=, $orderby:string=, $group:string=, $groupby:string=}} params - A string that represents an open data filter or an object with open data parameters\n     * @param {DataModel~FilterCallback} callback -  A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain an instance of DataQueryable class.\n     * @example\n     context.model('Order').filter(context.params, function(err,q) {\n        if (err) { return callback(err); }\n        q.take(10, function(err, result) {\n            if (err) { return callback(err); }\n            callback(null, result);\n        });\n     });\n     */\n    filter(params, callback) {\n        const self = this;\n        const parser = new OpenDataParser();\n        const $joinExpressions = [];\n        let view;\n        if (typeof params !== 'undefined' && params !== null && typeof params.$select === 'string') {\n            //split select\n            const arr = params.$select.split(',');\n            if (arr.length===1) {\n                //try to get data view\n                view = self.getDataView(arr[0]);\n            }\n        }\n        parser.resolveMember = function(member, cb) {\n            if (view) {\n                const field = view.fields.find(function(x) { return x.property === member });\n                if (field) { member = field.name; }\n            }\n            const attr = self.field(member);\n            if (attr)\n                member = attr.name;\n            if (DataAttributeResolver.prototype.testNestedAttribute.call(self,member)) {\n                try {\n                    const member1 = member.split(\"/\");\n                    const mapping = self.inferMapping(member1[0]);\n                    let expr;\n                    if (mapping && mapping.associationType === 'junction') {\n                        const expr1 = DataAttributeResolver.prototype.resolveJunctionAttributeJoin.call(self, member);\n                        expr = expr1.$expand;\n                        //replace member expression\n                        member = expr1.$select.$name.replace(/\\./g,\"/\");\n                    }\n                    else {\n                        expr = DataAttributeResolver.prototype.resolveNestedAttributeJoin.call(self, member);\n                    }\n                    if (expr) {\n                        const arrExpr = [];\n                        if (_.isArray(expr))\n                            arrExpr.push.apply(arrExpr, expr);\n                        else\n                            arrExpr.push(expr);\n                        arrExpr.forEach(function(y) {\n                            const joinExpr = $joinExpressions.find(function(x) {\n                                if (x.$entity && x.$entity.$as) {\n                                    return (x.$entity.$as === y.$entity.$as);\n                                }\n                                return false;\n                            });\n                            if (_.isNil(joinExpr))\n                                $joinExpressions.push(y);\n                        });\n                    }\n                }\n                catch (err) {\n                    cb(err);\n                    return;\n                }\n            }\n            if (typeof self.resolveMember === 'function')\n                self.resolveMember.call(self, member, cb);\n            else\n                DataFilterResolver.prototype.resolveMember.bind(self)(member, cb);\n        };\n        parser.resolveMethod = function(name, args, cb) {\n            if (typeof self.resolveMethod === 'function')\n                self.resolveMethod.bind(self)(name, args, cb);\n            else\n                DataFilterResolver.prototype.resolveMethod.bind(self)(name, args, cb);\n        };\n        let filter;\n\n        if ((params instanceof DataQueryable) && (self.name === params.model.name)) {\n            const q = new DataQueryable(self);\n            _.assign(q, params);\n            _.assign(q.query, params.query);\n            return callback(null, q);\n        }\n\n        if (typeof params === 'string') {\n            filter = params;\n        }\n        else if (typeof params === 'object') {\n            filter = params.$filter;\n        }\n\n        try {\n            parser.parse(filter, function(err, query) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    //create a DataQueryable instance\n                    const q = new DataQueryable(self);\n                    q.query.$where = query;\n                    if ($joinExpressions.length>0)\n                        q.query.$expand = $joinExpressions;\n                    //prepare\n                    q.query.prepare();\n\n                    if (typeof params === 'object') {\n                        //apply query parameters\n                        const select = params.$select, skip = params.$skip || 0, orderBy = params.$orderby || params.$order, groupBy = params.$groupby || params.$group, expand = params.$expand, levels = parseInt(params.$levels), top = params.$top || params.$take;\n                        //select fields\n                        if (typeof select === 'string') {\n                            q.select.apply(q, select.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }));\n                        }\n                        //apply group by fields\n                        if (typeof groupBy === 'string') {\n                            q.groupBy.apply(q, groupBy.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }));\n                        }\n                        if ((typeof levels === 'number') && !isNaN(levels)) {\n                            //set expand levels\n                            q.levels(levels);\n                        }\n                        //set $skip\n                        q.skip(skip);\n                        if (top)\n                            q.query.take(top);\n                        //set $orderby\n                        if (orderBy) {\n                            orderBy.split(',').map(function(x) {\n                                return x.replace(/^\\s+|\\s+$/g, '');\n                            }).forEach(function(x) {\n                                if (/\\s+desc$/i.test(x)) {\n                                    q.orderByDescending(x.replace(/\\s+desc$/i, ''));\n                                }\n                                else if (/\\s+asc/i.test(x)) {\n                                    q.orderBy(x.replace(/\\s+asc/i, ''));\n                                }\n                                else {\n                                    q.orderBy(x);\n                                }\n                            });\n                        }\n                        if (expand) {\n\n                            const resolver = require(\"./expand-resolver\");\n                            const matches = resolver.testExpandExpression(expand);\n                            if (matches && matches.length>0) {\n                                q.expand.apply(q, matches);\n                            }\n                        }\n                        //return\n                        callback(null, q);\n                    }\n                    else {\n                        //and finally return DataQueryable instance\n                        callback(null, q);\n                    }\n\n                }\n            });\n        }\n        catch(e) {\n            return callback(e);\n        }\n    }\n\n    /**\n     * Prepares a data query with the given object as parameters and returns the equivalent DataQueryable instance\n     * @param {*} obj - An object which represents the query parameters\n     * @returns DataQueryable - An instance of DataQueryable class that represents a data query based on the given parameters.\n     * @example\n     context.model('Order').find({ \"paymentMethod\":1 }).orderBy('dateCreated').take(10, function(err,result) {\n        if (err) { return callback(err); }\n        return callback(null, result);\n     });\n     */\n    find(obj) {\n        const self = this;\n        let result;\n        if (_.isNil(obj))\n        {\n            result = new DataQueryable(this);\n            result.where(self.primaryKey).equal(null);\n            return result;\n        }\n        //cast object\n        const find = {};\n        self.attributeNames.forEach(function(x)\n        {\n            if (obj.hasOwnProperty(x))\n            {\n                find[x] = obj[x];\n            }\n        });\n\n        if (find.hasOwnProperty(self.primaryKey)) {\n            result = new DataQueryable(this);\n            return result.where(self.primaryKey).equal(find[self.primaryKey]);\n        }\n        else {\n            result = new DataQueryable(this);\n            let bQueried = false;\n            //enumerate properties and build query\n            for(const key in find) {\n                if (find.hasOwnProperty(key)) {\n                    if (!bQueried) {\n                        result.where(key).equal(find[key]);\n                        bQueried = true;\n                    }\n                    else\n                        result.and(key).equal(find[key]);\n                }\n            }\n            if (!bQueried) {\n                //there is no query defined a dummy one (e.g. primary key is null)\n                result.where(self.primaryKey).equal(null);\n            }\n            return result;\n        }\n    }\n\n    /**\n     * Selects the given attribute or attributes and return an instance of DataQueryable class\n     * @param {...string} attr - An array of fields, a field or a view name\n     * @returns {DataQueryable}\n     */\n    select(attr) {\n        const result = new DataQueryable(this);\n        return result.select.apply(result, Array.prototype.slice.call(arguments));\n    }\n\n    /**\n     * Prepares an ascending order by expression and returns an instance of DataQueryable class.\n     * @param {string|*} attr - A string that is going to be used in this expression.\n     * @returns DataQueryable\n     * @example\n     context.model('Person').orderBy('givenName').list().then(function(result) {\n        done(null, result);\n     }).catch(function(err) {\n        done(err);\n     });\n    */\n    orderBy(attr) {\n        const result = new DataQueryable(this);\n        return result.orderBy(attr);\n    }\n\n    /**\n     * Takes an array of maximum [n] items.\n     * @param {Number} n - The maximum number of items that is going to be retrieved\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns DataQueryable|undefined If callback parameter is missing then returns a DataQueryable object.\n     */\n    take(n, callback) {\n        n = n || 25;\n        const result = new DataQueryable(this);\n        if (typeof callback === 'undefined')\n            return result.take(n);\n        result.take(n, callback);\n    }\n\n    /**\n     * Returns an instance of DataResultSet of the current model.\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns {Promise<T>|*} If callback parameter is missing then returns a Promise object.\n     * @deprecated Use DataModel.asQueryable().list().\n     * @example\n     context.model('User').list(function(err, result) {\n        if (err) { return done(err); }\n        return done(null, result);\n     });\n     */\n    list(callback) {\n        const result = new DataQueryable(this);\n        return result.list(callback);\n    }\n\n    /**\n     * Returns the first item of the current model.\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns {Promise<T>|*} If callback parameter is missing then returns a Promise object.\n     * @deprecated Use DataModel.asQueryable().first().\n     * @example\n     context.model('User').first(function(err, result) {\n        if (err) { return done(err); }\n        return done(null, result);\n     });\n    */\n    first(callback) {\n        const result = new DataQueryable(this);\n        return result.select(this.attributeNames).first(callback);\n    }\n\n    /**\n     * A helper function for getting an object based on the given primary key value\n     * @param {String|*} key - The primary key value to search for.\n     * @param {Function} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result, if any.\n     * @returns {Deferred|*} If callback parameter is missing then returns a Deferred object.\n     * @example\n     context.model('User').get(1).then(function(result) {\n        return done(null, result);\n    }).catch(function(err) {\n        return done(err);\n    });\n     */\n    get(key, callback) {\n        const result = new DataQueryable(this);\n        return result.where(this.primaryKey).equal(key).first(callback);\n    }\n\n    /**\n     * Returns the last item of the current model based.\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns {Promise<T>|*} If callback parameter is missing then returns a Promise object.\n     * @example\n     context.model('User').last(function(err, result) {\n        if (err) { return done(err); }\n        return done(null, result);\n     });\n     */\n    last(callback) {\n        const result = new DataQueryable(this);\n        return result.orderByDescending(this.primaryKey).select(this.attributeNames).first(callback);\n    }\n\n    /**\n     * Returns all data items.\n     * @param {Function} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result, if any.\n    */\n    all(callback) {\n        const result = new DataQueryable(this);\n        return result.select(this.attributeNames).all(callback);\n    }\n\n    /**\n     * Bypasses a number of items based on the given parameter. This method is used in data paging operations.\n     * @param {Number} n - The number of items to skip.\n     * @returns DataQueryable\n    */\n    skip(n) {\n        const result = new DataQueryable(this);\n        return result.skip(n);\n    }\n\n    /**\n     * Prepares an descending order by expression and returns an instance of DataQueryable class.\n     * @param {string|*} attr - A string that is going to be used in this expression.\n     * @returns DataQueryable\n     * @example\n     context.model('Person').orderByDescending('givenName').list().then(function(result) {\n        done(null, result);\n     }).catch(function(err) {\n        done(err);\n     });\n     */\n    orderByDescending(attr) {\n        const result = new DataQueryable(this);\n        return result.orderBy(attr);\n    }\n\n    /**\n     * Returns the maximum value for a field.\n     * @param {string} attr - A string that represents the name of the field.\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns {Promise<T>|*} If callback parameter is missing then returns a Promise object.\n     */\n    max(attr, callback) {\n        const result = new DataQueryable(this);\n        return result.max(attr, callback);\n    }\n\n    /**\n     * Returns the minimum value for a field.\n     * @param {string} attr - A string that represents the name of the field.\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @returns {Promise<T>|*} If callback parameter is missing then returns a Promise object.\n     */\n    min(attr, callback) {\n        const result = new DataQueryable(this);\n        return result.min(attr, callback);\n    }\n\n    /**\n     * Gets a DataModel instance which represents the inherited data model of this item, if any.\n     * @returns {DataModel}\n     */\n    base() {\n        if (typeof this.inherits === 'undefined' || this.inherits === null)\n            return null;\n        if (typeof this.context === 'undefined' || this.context === null)\n            throw new Error(\"The underlying data context cannot be empty.\");\n        return this.context.model(this.inherits);\n    }\n\n    /**\n     * Converts an object or a collection of objects to the corresponding data object instance\n     * @param {Array|*} obj\n     * @param {boolean=} typeConvert - Forces property value conversion for each property based on field type.\n     * @returns {DataObject|Array|*} - Returns an instance of DataObject (or an array of DataObject instances)\n     *<p>\n     This conversion of an anonymous object through DataModel.convert() may be overriden by subclassing DataObject\n     and place this class in app/models folder of a MOST Data Appllication:\n     </p>\n     <pre class=\"prettyprint\"><code>\n     /\n     + app\n       + models\n         + user-model.js\n     </code></pre>\n     <p>\n     An example of user model subclassing (user-model.js):\n     </p>\n     <pre class=\"prettyprint\"><code>\n     var util = require('util'),\n     md = require('most-data'),\n     web = require('most-web');\n\n     function UserModel(obj) {\n        UserModel.super_.call(this, 'User', obj);\n    }\n     util.inherits(UserModel, md.classes.DataObject);\n\n     UserModel.prototype.person = function (callback) {\n        var self = this, context = self.context;\n        try {\n            //search person by user name\n            return context.model('Person').where('user/name').equal(self.name).first(callback);\n        }\n        catch (err) {\n            callback(err);\n        }\n    };\n     if (typeof module !== 'undefined') module.exports = UserModel;\n     </code></pre>\n     @example\n     //get User model\n     var users = context.model('User');\n     users.where('name').equal(context.user.name).first().then(function(result) {\n        if (md.common.isNullOrUndefined(result)) {\n            return done(new Error('User cannot be found'));\n        }\n        //convert result\n        var user = users.convert(result);\n        //get user's person\n        user.person(function(err, result) {\n            if (err) { return done(err); }\n            if (md.common.isNullOrUndefined(result)) {\n                return done(new Error('Person cannot be found'));\n            }\n            console.log('Person: ' + JSON.stringify(result));\n            done(null, result);\n        });\n    }).catch(function(err) {\n       done(err);\n    });\n     */\n    convert(obj, typeConvert) {\n        const self = this;\n        if (_.isNil(obj))\n            return obj;\n        /**\n         * @constructor\n         * @augments DataObject\n         * @ignore\n         */\n        const DataObjectClass = self.context.getConfiguration().getConfiguration().getStrategy(ModelClassLoaderStrategy).resolve(self);\n        let src;\n        if (_.isArray(obj)) {\n            const arr = [];\n            obj.forEach(function(x) {\n                if (typeof x !== 'undefined' && x!==null) {\n                    const o = new DataObjectClass(self.name);\n                    if (typeof x === 'object') {\n                        _.assign(o, x);\n                    }\n                    else {\n                        src = {}; src[self.primaryKey] = x;\n                        _.assign(o, src);\n                    }\n                    if (typeConvert)\n                        convertInternal_.call(self, o);\n                    o.context = self.context;\n                    arr.push(o);\n                }\n            });\n            return arr;\n        }\n        else {\n            const result = new DataObjectClass(self.name);\n            if (typeof obj === 'object') {\n                _.assign(result, obj);\n            }\n            else {\n                src = {}; src[self.primaryKey] = obj;\n                _.assign(result, src);\n            }\n            if (typeConvert)\n                convertInternal_.call(self, result);\n            result.context = self.context;\n            return result;\n        }\n    }\n\n    /**\n     * Extracts an identifier from the given parameter.\n     * If the parameter is an object then gets the identifier property, otherwise tries to convert the given parameter to an identifier\n     * suitable for this model.\n     * @param {*} obj\n     * @returns {*|undefined}\n     * @example\n     var id = context.model('User').idOf({ id:1, \"name\":\"anonymous\"});\n     */\n    idOf(obj) {\n        if (typeof obj === 'undefined')\n            return;\n        if (obj===null)\n            return;\n        if (typeof this.primaryKey === 'undefined' || this.primaryKey === null)\n            return;\n        if (typeof obj === 'object')\n            return obj[this.primaryKey];\n        return obj;\n    }\n\n    /**\n     * Casts the given object and returns an object that is going to be used against the underlying database.\n     * @param {*} obj - The source object which is going to be cast\n     * @param {number=} state - The state of the source object.\n     * @returns {*} - Returns an object which is going to be against the underlying database.\n     */\n    cast(obj, state) {\n        return cast_.call(this, obj, state);\n    }\n\n    /**\n     * Casts the given source object and returns a data object based on the current model.\n     * @param {*} dest - The destination object\n     * @param {*} src - The source object\n     * @param {Function} callback - A callback function where the first argument will contain the Error object if an error occurred, or null otherwise.\n     */\n    recast(dest, src, callback) {\n        callback = callback || function() {};\n        const self = this;\n        if (_.isNil(src)) {\n            callback();\n            return;\n        }\n        if (_.isNil(dest)) {\n            dest = { };\n        }\n        async.eachSeries(self.fields, function(field, cb) {\n            try {\n                if (src.hasOwnProperty(field.name)) {\n                    //ensure db property removal\n                    if (field.property && field.property!==field.name)\n                        delete dest[field.name];\n                    const mapping = self.inferMapping(field.name), name = field.property || field.name;\n                    if (_.isNil(mapping)) {\n                        //set destination property\n                        dest[name] = src[field.name];\n                        cb(null);\n                    }\n                    else if (mapping.associationType==='association') {\n\n                        if (typeof dest[name] === 'object' && dest[name] ) {\n                            //check associated object\n                            if (dest[name][mapping.parentField]===src[field.name]) {\n                                //return\n                                cb(null);\n                            }\n                            else {\n                                //load associated item\n                                const associatedModel = self.context.model(mapping.parentModel);\n                                associatedModel.where(mapping.parentField).equal(src[field.name]).silent().first(function(err, result) {\n                                    if (err) {\n                                        cb(err);\n                                    }\n                                    else {\n                                        dest[name] = result;\n                                        //return\n                                        cb(null);\n                                    }\n                                });\n                            }\n                        }\n                        else {\n                            //set destination property\n                            dest[name] = src[field.name];\n                            cb(null);\n                        }\n                    }\n                }\n                else {\n                    cb(null);\n                }\n            }\n            catch (e) {\n                cb(e);\n            }\n        }, function(err) {\n            callback(err);\n        });\n    }\n\n    /**\n     * Casts the given object and returns an object that was prepared for insert.\n     * @param obj {*} - The object to be cast\n     * @returns {*}\n     */\n    new(obj) {\n        return this.cast(obj);\n    }\n\n    /**\n     * Saves the given object or array of objects\n     * @param obj {*|Array}\n     * @param callback {Function=} - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise<T>|*} - If callback parameter is missing then returns a Promise object.\n     * @example\n     //save a new group (Sales)\n     var group = { \"description\":\"Sales Users\", \"name\":\"Sales\" };\n     context.model(\"Group\").save(group).then(function() {\n            console.log('A new group was created with ID ' + group.id);\n            done();\n        }).catch(function(err) {\n            done(err);\n        });\n     */\n    save(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            save_.bind(this)(obj, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return save_.bind(this)(obj, callback);\n        }\n    }\n\n    /**\n     * Represents the callback function of DataQueryable.filter() method.\n     * @callback DataModel~ObjectStateCallback\n     * @param {Error=} err\n     * @param {DataObjectState} state\n     */\n\n    /**\n     * Infers the state of the given object.\n     * @param {DataObject|*} obj - The source object\n     * @param {DataModel~ObjectStateCallback} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     * @see DataObjectState\n     */\n    inferState(obj, callback) {\n        const self = this;\n        const e = { model:self, target:obj };\n        DataStateValidatorListener.prototype.beforeSave(e, function(err) {\n            //if error return error\n            if (err) { return callback(err); }\n            //otherwise return the calucated state\n            callback(null, e.state);\n        });\n    }\n\n    /**\n     * Gets an array of strings which contains the super types of this model e.g. User model may have ['Account','Thing'] as super types\n     * @returns {Array}\n     */\n    getSuperTypes() {\n        const result=[];\n        let baseModel = this.base();\n        while(baseModel!==null) {\n            result.unshift(baseModel.name);\n            baseModel = baseModel.base();\n        }\n        return result;\n    }\n\n    /**\n     * Updates an item or an array of items\n     * @param obj {*|Array} - The item or the array of items to update\n     * @param callback {Function=} - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise<T>|*} - If callback parameter is missing then returns a Promise object.\n     */\n    update(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            update_.bind(this)(obj, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return update_.bind(this)(obj, callback);\n        }\n    }\n\n    /**\n     * Inserts an item or an array of items\n     * @param obj {*|Array} - The item or the array of items to update\n     * @param callback {Function=} - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise<T>|*} - If callback parameter is missing then returns a Promise object.\n     */\n    insert(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            insert_.bind(this)(obj, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return insert_.bind(this)(obj, callback);\n        }\n    }\n\n    /**\n     * Deletes the given object or array of objects\n     * @param obj {*|Array} The item or the array of items to delete\n     * @param callback {Function=} - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise<T>|*} - If callback parameter is missing then returns a Promise object.\n     * @example\n     //remove group (Sales)\n     var group = { \"name\":\"Sales\" };\n     context.model(\"Group\").remove(group).then(function() {\n            done();\n        }).catch(function(err) {\n            done(err);\n        });\n     */\n    remove(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            remove_.bind(this)(obj, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return remove_.call(this, obj, callback);\n        }\n    }\n\n    /**\n     * Ensures model data adapter.\n     * @param callback\n     * @private\n     */\n    ensureModel(callback) {\n        const self = this;\n        if (self.name==='Migration') {\n            //do nothing\n            return callback();\n        }\n        //get migration model\n        const migrationModel = self.context.model(\"migration\");\n        //ensure migration\n        const version = _.isNil(self.version) ? '0.0': self.version;\n        migrationModel.where('appliesTo').equal(self.sourceAdapter).and('version').equal(version).count(function(err, result) {\n            if (err) { return callback(err); }\n            if (result>0) { return callback(); }\n            self.migrate(callback);\n        });\n    }\n\n    /**\n     * Performing an automatic migration of current data model based on the current model's definition.\n     * @param {Function} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise. The second argument will contain the result.\n     */\n    migrate(callback) {\n        const self = this;\n        //cache: data model migration\n        //prepare migration cache\n        const conf = self.context.getConfiguration();\n        conf.cache = conf.cache || {};\n        conf.cache[self.name] = conf.cache[self.name] || { };\n        if (conf.cache[self.name].version===self.version) {\n            //model has already been migrated, so do nothing\n            return callback();\n        }\n        //do not migrate sealed models\n        if (self.sealed) {\n            return callback();\n        }\n        const context = self.context;\n        //do migration\n        const fields = _.filter(self.attributes, function(x) {\n            return (self.name === x.model) && (!x.many);\n        });\n\n        if ((fields===null) || (fields.length===0))\n            throw new Error(\"Migration is not valid for this model. The model has no fields.\");\n        const migration = new DataModelMigration();\n        migration.add = _.map(fields, function(x) {\n            return _.assign({ }, x);\n        });\n        migration.version = self.version!==null ? self.version : '0.0';\n        migration.appliesTo = self.sourceAdapter;\n        migration.model = self.name;\n        migration.description = sprintf.sprintf('%s migration (version %s)', this.title, migration.version);\n        if (context===null)\n            throw new Error(\"The underlying data context cannot be empty.\");\n\n        //get all related models\n        const models = [];\n        // self.fields.filter(function(x) {\n        //     return (!conf.dataTypes[x.type] && (self.name!=x.type));\n        // }).forEach(function(x) {\n        //     var m = context.model(x.type);\n        //     if (m) {\n        //         var m1 = models.find(function(y) {\n        //             return y.name === m.name;\n        //         });\n        //     }\n        // });\n        const db = context.db;\n        const baseModel = self.base();\n        if (baseModel!==null) {\n            models.push(baseModel);\n        }\n        //validate associated models\n        migration.add.forEach(function(x) {\n            //validate mapping\n            const mapping = self.inferMapping(x.name);\n            if (mapping && mapping.associationType === 'association') {\n                if (mapping.childModel === self.name) {\n                    //get parent model\n                    const parentModel = self.context.model(mapping.parentModel), attr = parentModel.getAttribute(mapping.parentField);\n                    if (attr) {\n                        if (attr.type === 'Counter') {\n                            x.type = 'Integer';\n                        }\n                        else {\n                            x.type = attr.type;\n                        }\n\n                    }\n                }\n                migration.indexes.push({\n                    name: \"INDEX_\" + migration.appliesTo.toUpperCase() + \"_\" + x.name.toUpperCase(),\n                    columns: [ x.name ]\n                });\n            }\n            else if (x.indexed === true) {\n                migration.indexes.push({\n                    name: \"INDEX_\" + migration.appliesTo.toUpperCase() + \"_\" + x.name.toUpperCase(),\n                    columns: [ x.name ]\n                });\n            }\n        });\n\n        //execute transaction\n        db.executeInTransaction(function(tr) {\n            if (models.length===0) {\n                self.emit('before.upgrade', { model:self }, function(err) {\n                    if (err) { return tr(err); }\n                    db.migrate(migration, function(err) {\n                        if (err) { return tr(err); }\n                        if (migration['updated']) {\n                            return tr();\n                        }\n                        //execute after migrate events\n                        self.emit('after.upgrade', { model:self }, function(err) {\n                            return tr(err);\n                        });\n                    });\n                });\n            }\n            else {\n                async.eachSeries(models,function(m, cb)\n                {\n                    if (m) {\n                        m.migrate(cb);\n                    }\n                    else {\n                        return cb();\n                    }\n                }, function(err) {\n                    if (err) { return tr(err); }\n                    self.emit('before.upgrade', { model:self }, function(err) {\n                        if (err) { return tr(err); }\n                        db.migrate(migration, function(err) {\n                            if (err) { return tr(err);  }\n                            if (migration['updated']) {\n                                return tr();\n                            }\n                            //execute after migrate events\n                            self.emit('after.upgrade', { model:self }, function(err) {\n                                return tr(err);\n                            });\n                        });\n                    });\n                });\n            }\n        }, function(err) {\n            if (!err) {\n                //set migration info to configuration cache (conf.cache.model.version=[current version])\n                //cache: data model migration\n                conf.cache[self.name].version = self.version;\n            }\n            callback(err);\n        });\n    }\n\n    /**\n     * Gets an instance of DataField class which represents the primary key of this model.\n     * @returns {DataField|*}\n     */\n    key() {\n        return this.attributes.find(function(x) { return x.primary===true; });\n    }\n\n    /**\n     * Gets an instance of DataField class based on the given name.\n     * @param {String} name - The name of the field.\n     * @return {DataField|*} - Returns a data field if exists. Otherwise returns null.\n     */\n    field(name) {\n        if (typeof name !== 'string')\n            return null;\n        return this.attributes.find(function(x) { return (x.name===name) || (x.property===name); });\n    }\n\n    /**\n     *\n     * @param {string|*} attr\n     * @param {string=} alias\n     * @returns {DataQueryable|QueryField|*}\n     */\n    resolveField(attr, alias) {\n        const q = new DataQueryable(this);\n        return q.resolveField(attr, alias);\n    }\n\n    /**\n     * Gets an instance of DataModelView class which represents a model view with the given name.\n     * @param {string} name - A string that represents the name of the view.\n     * @returns {DataModelView|undefined}\n     *@example\n     var view = context.model('Person').getDataView('summary');\n     *\n     */\n    getDataView(name) {\n        const self = this;\n        const re = new RegExp('^' + name.replace('$','\\$') + '$', 'ig');\n        const view = _.find(self.views, function(x) {\n            return re.test(x.name);\n        });\n        if (_.isNil(view))\n        {\n            return _.assign(new DataModelView(self), {\n                \"name\":\"default\",\n                \"title\":\"Default View\",\n                \"fields\": self.attributes.map(function(x) {\n                    return { \"name\":x.name }\n                })\n            });\n        }\n        return _.assign(new DataModelView(self), view);\n    }\n\n    /**\n     * Gets a field association mapping based on field attributes, if any. Otherwise returns null.\n     * @param {string} name - The name of the field\n     * @returns {DataAssociationMapping|undefined}\n     */\n    inferMapping(name) {\n        const self = this;\n        //ensure model cached mappings\n        const conf = self.context.getConfiguration().model(self.name);\n        if (typeof conf === \"undefined\" || conf === null) {\n            return;\n        }\n        if (typeof conf.mappings_ === 'undefined') {\n            conf.mappings_ = { };\n        }\n        if (typeof conf.mappings_[name] !== 'undefined') {\n            if (conf.mappings_[name] instanceof DataAssociationMapping)\n                return conf.mappings_[name];\n            else\n                return  new DataAssociationMapping(conf.mappings_[name]);\n        }\n        const field = self.field(name);\n        let result;\n        if (!field)\n            return null;\n        if (field.mapping) {\n            //if field model is different than the current model\n            if (field.model !== self.name) {\n                //if field mapping is already associated with the current model\n                // (child or parent model is equal to the current model)\n                if ((field.mapping.childModel===self.name) || (field.mapping.parentModel===self.name)) {\n                    //cache mapping\n                    conf.mappings_[name] = new DataAssociationMapping(field.mapping);\n                    //do nothing and return field mapping\n                    return conf.mappings_[name];\n                }\n                //get super types\n                const superTypes = self.getSuperTypes();\n                //map an inherited association\n                //1. super model has a foreign key association with another model\n                //(where super model is the child or the parent model)\n                if (field.mapping.associationType === 'association') {\n                    //create a new cloned association\n                    result = new DataAssociationMapping(field.mapping);\n                    //check super types\n                    if (superTypes.indexOf(field.mapping.childModel)>=0) {\n                        //set child model equal to current model\n                        result.childModel = self.name;\n                    }\n                    else if (superTypes.indexOf(field.mapping.parentModel)>=0) {\n                        //set child model equal to current model\n                        result.childModel = self.name;\n                    }\n                    else {\n                        //this is an exception\n                        throw new DataError(\"EMAP\",\"An inherited data association cannot be mapped.\");\n                    }\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return the newly created DataAssociationMapping object\n                    return result;\n                }\n                //2. super model has a junction (many-to-many association) with another model\n                //(where super model is the child or the parent model)\n                else if (field.mapping.associationType === 'junction') {\n                    //create a new cloned association\n                    result = new DataAssociationMapping(field.mapping);\n                    if (superTypes.indexOf(field.mapping.childModel)>=0) {\n                        //set child model equal to current model\n                        result.childModel = self.name;\n                    }\n                    else if (superTypes.indexOf(field.mapping.parentModel)>=0) {\n                        //set parent model equal to current model\n                        result.parentModel = self.name;\n                    }\n                    else {\n                        //this is an exception\n                        throw new DataError(\"EMAP\",\"An inherited data association cannot be mapped.\");\n                    }\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return the newly created DataAssociationMapping object\n                    return result;\n                }\n            }\n            //in any other case return the assocation mapping object\n            if (field.mapping instanceof DataAssociationMapping) {\n                //cache mapping\n                conf.mappings_[name] = field.mapping;\n                //and return\n                return field.mapping;\n            }\n            result = _.assign(new DataAssociationMapping(), field.mapping);\n            //cache mapping\n            conf.mappings_[name] = result;\n            //and return\n            return result;\n        }\n        else {\n            //get field model type\n            const associatedModel = self.context.model(field.type);\n            if ((typeof associatedModel === 'undefined') || (associatedModel === null))\n            {\n                if (typeof field.many === 'boolean' && field.many) {\n                    //validate primitive type mapping\n                    const tagMapping = inferTagMapping_.bind(self)(field);\n                    if (tagMapping) {\n                        //apply data association mapping to definition\n                        const definitionField = conf.fields.find(function(x) {\n                            return x.name === field.name;\n                        });\n                        definitionField.mapping = field.mapping = tagMapping;\n                        return new DataAssociationMapping(definitionField.mapping);\n                    }\n                }\n                return null;\n            }\n            //in this case we have two possible associations. Junction or Foreign Key association\n            //try to find a field that belongs to the associated model and holds the foreign key of this model.\n            const associatedField = associatedModel.attributes.find(function(x) {\n                return x.type === self.name;\n            });\n            if (associatedField)\n            {\n                if (associatedField.many)\n                {\n                    //return a data relation (parent model is the associated model)\n                    result = new DataAssociationMapping({\n                        parentModel:associatedModel.name,\n                        parentField:associatedModel.primaryKey,\n                        childModel:self.name,\n                        childField:field.name,\n                        associationType:'association',\n                        cascade:'null'\n                    });\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return mapping\n                    return result;\n                }\n                else\n                {\n                    //return a data relation (parent model is the current model)\n                    result = new DataAssociationMapping({\n                        parentModel:self.name,\n                        parentField:self.primaryKey,\n                        childModel:associatedModel.name,\n                        childField:associatedField.name,\n                        associationType:'association',\n                        cascade:'null',\n                        refersTo:field.property || field.name\n                    });\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return mapping\n                    return result;\n                }\n            }\n            else {\n\n                //validate pluralize\n                const re = new RegExp(DataModel.PluralExpression.source),\n                    many = _.isBoolean(field.many) ? field.many : re.test(field.name);\n                if (many) {\n                    //return a data junction\n                    result = new DataAssociationMapping({\n                        associationAdapter: self.name.concat(_.upperFirst(field.name)),\n                        parentModel: self.name, parentField: self.primaryKey,\n                        childModel: associatedModel.name,\n                        childField: associatedModel.primaryKey,\n                        associationType: 'junction',\n                        cascade: 'delete'\n                    });\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return mapping\n                    return result;\n                }\n                else {\n                    result = new DataAssociationMapping({\n                        parentModel: associatedModel.name,\n                        parentField: associatedModel.primaryKey,\n                        childModel: self.name,\n                        childField: field.name,\n                        associationType: 'association',\n                        cascade: 'null'\n                    });\n                    //cache mapping\n                    conf.mappings_[name] = result;\n                    //and finally return mapping\n                    return result;\n                }\n            }\n        }\n    }\n\n    /**\n     * Validates the given object against validation rules which are defined either by the data type or the definition of each attribute\n     <p>Read more about data validation <a href=\"DataValidatorListener.html\">here</a>.</p>\n     * @param {*} obj - The data object which is going to be validated\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise|*} - If callback parameter is missing then returns a Promise object.\n     */\n    validateForUpdate(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            validate_.bind(this)(obj, 2, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return validate_.call(this, obj, callback);\n        }\n    }\n\n    /**\n     * Validates the given object against validation rules which are defined either by the data type or the definition of each attribute\n     <p>Read more about data validation <a href=\"DataValidatorListener.html\">here</a>.</p>\n     * @param {*} obj - The data object which is going to be validated\n     * @param {Function=} callback - A callback function where the first argument will contain the Error object if an error occured, or null otherwise.\n     * @returns {Promise|*} - If callback parameter is missing then returns a Promise object.\n     <p>Read more about data validation <a href=\"DataValidationListener.html\">here</a></p>\n     */\n    validateForInsert(obj, callback) {\n        if (typeof callback !== 'function') {\n            const d = Q.defer();\n            validate_.bind(this)(obj, 1, function(err, result) {\n                if (err) { return d.reject(err); }\n                d.resolve(result);\n            });\n            return d.promise;\n        }\n        else {\n            return validate_.bind(this)(obj, callback);\n        }\n    }\n\n    /**\n     * Sets the number of levels of the expandable attributes.\n     * The default value is 1 which means that any expandable attribute will be flat (without any other nested attribute).\n     * If the value is greater than 1 then the nested objects may contain other nested objects and so on.\n     * @param {Number=} value - A number which represents the number of levels which are going to be used in expandable attributes.\n     * @returns {DataQueryable}\n     * @example\n     //get orders, expand customer and get customer's nested objects if any.\n     context.model('Order')\n     .levels(2)\n     .orderByDescending('dateCreated)\n     .expand('customer')\n     .getItems().then(function(result) {\n            done(null, result);\n        }).catch(function(err) {\n            done(err);\n        });\n     */\n    levels(value) {\n        const result = new DataQueryable(this);\n        return result.levels(value);\n    }\n\n    /**\n     * Gets an array of active models which are derived from this model.\n     * @returns {Promise|*}\n     * @example\n     * context.model(\"Thing\").getSubTypes().then(function(result) {\n            console.log(JSON.stringify(result,null,4));\n            return done();\n        }).catch(function(err) {\n            return done(err);\n        });\n     */\n    getSubTypes() {\n        const self = this;\n        const d = Q.defer();\n        process.nextTick(function() {\n            const migrations = self.context.model(\"Migration\");\n            if (_.isNil(migrations)) {\n                return d.resolve([]);\n            }\n            migrations.silent()\n                .select(\"model\")\n                .groupBy(\"model\")\n                .all().then(function(result) {\n                    const conf = self.context.getConfiguration(), arr = [];\n                    result.forEach(function(x) {\n                        const m = conf.getModelDefinition(x.model);\n                        if (m && m.inherits === self.name) {\n                            arr.push(m.name);\n                        }\n                    });\n                    return d.resolve(arr);\n                }).catch(function(err) {\n                    return d.reject(err)\n                });\n        });\n        return d.promise;\n    }\n\n    /**\n     * Gets an attribute of this data model.\n     * @param {string} name\n     */\n    getAttribute(name) {\n        if (_.isNil(name)) { return; }\n        if (typeof name !== 'string') { return; }\n        return this.attributes.find(function(x) { return x.name === name; });\n    }\n\n    /**\n     * Gets a collection of DataObject instances by executing the defined query.\n     * @returns {Promise|*}\n     */\n    getTypedItems() {\n        const self = this, d = Q.defer();\n        process.nextTick(function() {\n            const q = new DataQueryable(self);\n            q.getTypedItems().then(function (result) {\n                return d.resolve(result);\n            }).catch(function(err) {\n                return d.reject(err);\n            });\n        });\n        return d.promise;\n    }\n\n    /**\n     * Gets a result set that contains a collection of DataObject instances by executing the defined query.\n     * @returns {Promise|*}\n     */\n    getTypedList() {\n        const self = this, d = Q.defer();\n        process.nextTick(function() {\n            const q = new DataQueryable(self);\n            q.getTypedList().then(function (result) {\n                return d.resolve(result);\n            }).catch(function(err) {\n                return d.reject(err);\n            });\n        });\n        return d.promise;\n    }\n\n    /**\n     * Gets a result set which contains a collection of items\n     * @returns {Promise|*}\n     */\n    getItems() {\n        const q = new DataQueryable(this);\n        return q.getItems();\n    }\n\n    /**\n     * Gets a result set which contains a collection of items\n     * @returns {Promise|*}\n     */\n    getList() {\n        const q = new DataQueryable(this);\n        return q.list();\n    }\n}\n\n/**\n * @memberOf DataModel\n * @private\n */\nfunction registerListeners_() {\n\n    /**\n     *\n     * @type {DataModel|*}\n     */\n    const self = this;\n    //register system event listeners\n    self.removeAllListeners('before.save');\n    self.removeAllListeners('after.save');\n    self.removeAllListeners('before.remove');\n    self.removeAllListeners('after.remove');\n    self.removeAllListeners('before.execute');\n    self.removeAllListeners('after.execute');\n    self.removeAllListeners('after.upgrade');\n\n    //0. Permission Event Listener\n    const perms = require('./permission');\n    //1. State validator listener\n    self.on('before.save', DataStateValidatorListener.prototype.beforeSave);\n    self.on('before.remove', DataStateValidatorListener.prototype.beforeRemove);\n    //2. Default values Listener\n    self.on('before.save', DefaultValueListener.prototype.beforeSave);\n    //3. Calculated values listener\n    self.on('before.save', CalculatedValueListener.prototype.beforeSave);\n\n    //register before execute caching\n    if (self.caching==='always' || self.caching==='conditional') {\n        self.on('before.execute', DataCachingListener.prototype.beforeExecute);\n        self.on('after.execute', DataCachingListener.prototype.afterExecute);\n    }\n\n    //migration listeners\n    self.on('after.upgrade',DataModelCreateViewListener.prototype.afterUpgrade);\n    self.on('after.upgrade',DataModelSeedListener.prototype.afterUpgrade);\n\n    /**\n    * change:8-Jun 2015\n    * description: Set lookup default listeners as obsolete.\n    */\n    ////register lookup model listeners\n    //if (this.type === 'lookup') {\n    //    //after save (clear lookup caching)\n    //    this.on('after.save', DataModelLookupCachingListener.afterSave);\n    //    //after remove (clear lookup caching)\n    //    this.on('after.remove', DataModelLookupCachingListener.afterRemove);\n    //}\n    //register configuration listeners\n    if (self.eventListeners) {\n        for (let i = 0; i < self.eventListeners.length; i++) {\n            const listener = self.eventListeners[i];\n            //get listener type (e.g. type: require('./custom-listener.js'))\n            if (listener.type && !listener.disabled)\n            {\n                /**\n                * Load event listener from the defined type\n                * @type DataEventListener\n                */\n                const m = self.context.getApplication().getConfiguration().getStrategy(ModuleLoaderStrategy).require(listener.type);\n                //if listener exports beforeSave function then register this as before.save event listener\n                if (typeof m.beforeSave === 'function')\n                    self.on('before.save', m.beforeSave);\n                //if listener exports afterSave then register this as after.save event listener\n                if (typeof m.afterSave === 'function')\n                    self.on('after.save', m.afterSave);\n                //if listener exports beforeRemove then register this as before.remove event listener\n                if (typeof m.beforeRemove === 'function')\n                    self.on('before.remove', m.beforeRemove);\n                //if listener exports afterRemove then register this as after.remove event listener\n                if (typeof m.afterRemove === 'function')\n                    self.on('after.remove', m.afterRemove);\n                //if listener exports beforeExecute then register this as before.execute event listener\n                if (typeof m.beforeExecute === 'function')\n                    self.on('before.execute', m.beforeExecute);\n                //if listener exports afterExecute then register this as after.execute event listener\n                if (typeof m.afterExecute === 'function')\n                    self.on('after.execute', m.afterExecute);\n                //if listener exports afterUpgrade then register this as after.upgrade event listener\n                if (typeof m.afterUpgrade === 'function')\n                    self.on('after.upgrade', m.afterUpgrade);\n            }\n        }\n    }\n    //before execute\n    self.on('before.execute', perms.DataPermissionEventListener.prototype.beforeExecute);\n    //before save (validate permissions)\n    self.on('before.save', perms.DataPermissionEventListener.prototype.beforeSave);\n    //before remove (validate permissions)\n    self.on('before.remove', perms.DataPermissionEventListener.prototype.beforeRemove);\n}\n\n/**\n * @memberOf DataModel\n * @private\n * @param {*} obj\n */\nfunction convertInternal_(obj) {\n    const self = this;\n\n    //get type parsers (or default type parsers)\n    const parsers = self.parsers || ParserUtils;\n\n    let parser;\n    let value;\n    self.attributes.forEach(function(x) {\n        value = obj[x.name];\n        if (value) {\n            //get parser for this type\n            parser = parsers['parse'.concat(x.type)];\n            //if a parser exists\n            if (typeof parser === 'function')\n            //parse value\n                obj[x.name] = parser(value);\n            else {\n                //get mapping\n                const mapping = self.inferMapping(x.name);\n                if (mapping) {\n                    if ((mapping.associationType==='association') && (mapping.childModel===self.name)) {\n                        const associatedModel = self.context.model(mapping.parentModel);\n                        if (associatedModel) {\n                            if (typeof value === 'object') {\n                                //set associated key value (e.g. primary key value)\n                                convertInternal_.bind(associatedModel)(value);\n                            }\n                            else {\n                                const field = associatedModel.field(mapping.parentField);\n                                if (field) {\n                                    //parse raw value\n                                    parser = parsers['parse'.concat(field.type)];\n                                    if (typeof parser === 'function')\n                                        obj[x.name] = parser(value);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    });\n}\n\n/**\n * @param {*} obj\n * @param {number=} state\n * @returns {*}\n * @private\n */\nfunction cast_(obj, state) {\n    const self = this;\n    if (obj===null)\n        return {};\n    if (typeof obj === 'object' && obj instanceof Array)\n    {\n        return obj.map(function(x) {\n            return cast_.call(self, x, state);\n        });\n    }\n    else\n    {\n        //ensure state (set default state to Insert=1)\n        state = _.isNil(state) ? (_.isNil(obj.$state) ? 1 : obj.$state) : state;\n        const result = {};\n        let name;\n        self.attributes.filter(function(x) {\n            if (x.model!==self.name) { return false; }\n            return (!x.readonly) ||\n                (x.readonly && (typeof x.calculation!=='undefined') && state===2) ||\n                (x.readonly && (typeof x.value!=='undefined') && state===1) ||\n                (x.readonly && (typeof x.calculation!=='undefined') && state===1);\n        }).filter(function(y) {\n            /*\n            change: 2016-02-27\n            author:k.barbounakis@gmail.com\n            description:exclude non editable attributes on update operation\n             */\n            return (y.state===2) ? (y.hasOwnProperty(\"editable\") ? y.editable : true) : true;\n        }).forEach(function(x) {\n            name = obj.hasOwnProperty(x.property) ? x.property : x.name;\n            if (obj.hasOwnProperty(name))\n            {\n                const mapping = self.inferMapping(name);\n                if (_.isNil(mapping))\n                    result[x.name] = obj[name];\n                else if ((mapping.associationType==='association') && (mapping.childModel===self.name)) {\n                    if ((typeof obj[name] === 'object') && (obj[name] !== null))\n                    //set associated key value (e.g. primary key value)\n                        result[x.name] = obj[name][mapping.parentField];\n                    else\n                    //set raw value\n                        result[x.name] = obj[name];\n                }\n            }\n        });\n        return result;\n    }\n}\n\n\n/**\n * @param {*} obj\n * @param {number=} state\n * @returns {*}\n * @private\n */\nfunction castForValidation_(obj, state) {\n    const self = this;\n    if (obj===null)\n        return {};\n    if (typeof obj === 'object' && obj instanceof Array)\n    {\n        return obj.map(function(x) {\n            return castForValidation_.call(self, x, state);\n        });\n    }\n    else\n    {\n        //ensure state (set default state to Insert=1)\n        state = _.isNil(state) ? (_.isNil(obj.$state) ? 1 : obj.$state) : state;\n        const result = {};\n        let name;\n        self.attributes.filter(function(x) {\n            if (x.model!==self.name) {\n                if (ParserUtils.parseBoolean(x.cloned) === false)\n                    return false;\n            }\n            return (!x.readonly) ||\n                (x.readonly && (typeof x.calculation!=='undefined') && state===2) ||\n                (x.readonly && (typeof x.value!=='undefined') && state===1) ||\n                (x.readonly && (typeof x.calculation!=='undefined') && state===1);\n        }).filter(function(y) {\n            /*\n             change: 2016-02-27\n             author:k.barbounakis@gmail.com\n             description:exclude non editable attributes on update operation\n             */\n            return (y.state===2) ? (y.hasOwnProperty(\"editable\") ? y.editable : true) : true;\n        }).forEach(function(x) {\n            name = obj.hasOwnProperty(x.property) ? x.property : x.name;\n            if (obj.hasOwnProperty(name))\n            {\n                const mapping = self.inferMapping(name);\n                if (_.isNil(mapping))\n                    result[x.name] = obj[name];\n                else if ((mapping.associationType==='association') && (mapping.childModel===self.name)) {\n                    if ((typeof obj[name] === 'object') && (obj[name] !== null))\n                    //set associated key value (e.g. primary key value)\n                        result[x.name] = obj[name][mapping.parentField];\n                    else\n                    //set raw value\n                        result[x.name] = obj[name];\n                }\n            }\n        });\n        return result;\n    }\n}\n\n/**\n *\n * @param {*|Array} obj\n * @param {Function} callback\n * @private\n */\nfunction save_(obj, callback) {\n    const self = this;\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    //ensure migration\n    self.migrate(function(err) {\n        if (err) { callback(err); return; }\n        //do save\n        const arr = [];\n        if (_.isArray(obj)) {\n            for (let i = 0; i < obj.length; i++)\n                arr.push(obj[i]);\n        }\n        else\n            arr.push(obj);\n        const db = self.context.db;\n        let res = [];\n        db.executeInTransaction(function(cb) {\n            async.eachSeries(arr, function(item, saveCallback) {\n                saveSingleObject_.bind(self)(item, function(err, result) {\n                    if (err) {\n                        return saveCallback(err);\n                    }\n                    res.push(result.insertedId);\n                    return saveCallback();\n                });\n            }, function(err) {\n                if (err) {\n                    res = null;\n                    return cb(err);\n                }\n                return cb();\n            });\n        }, function(err) {\n            return callback(err, res);\n        });\n    });\n}\n\n/**\n * @param {*} obj\n * @param {Function} callback\n * @private\n */\nfunction saveBaseObject_(obj, callback) {\n    //ensure callback\n    callback = callback || function() {};\n    const self = this, base = self.base();\n    //if obj is an array of objects throw exception (invoke callback with error)\n    if (_.isArray(obj)) {\n        return callback(new Error('Invalid argument. Base object cannot be an array.'));\n    }\n    //if current model does not have a base model\n    if (_.isNil(base)) {\n        //exit operation\n        return callback();\n    }\n    else {\n        base.silent();\n        //perform operation\n        saveSingleObject_.bind(base)(obj, function(err, result) {\n            return callback(err, result);\n        });\n    }\n}\n/**\n * @param {*} obj\n * @param {Function} callback\n * @private\n */\nfunction saveSingleObject_(obj, callback) {\n    const self = this;\n    callback = callback || function() {};\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    if (_.isArray(obj)) {\n        return callback(new Error('Invalid argument. Source object cannot be an array.'));\n    }\n    if (obj.$state === 4) {\n        return removeSingleObject_.call(self, obj, callback);\n    }\n    //get object state before any other operation\n    const state = obj.$state ? obj.$state : (obj[self.primaryKey]!==null ? 2 : 1);\n    const e = {\n        model: self,\n        target: obj,\n        state:state\n    };\n    //register nested objects listener (before save)\n    self.once('before.save', DataNestedObjectListener.prototype.beforeSave);\n    //register data association listener (before save)\n    self.once('before.save', DataObjectAssociationListener.prototype.beforeSave);\n    //register data association listener\n    self.once('after.save', DataObjectAssociationListener.prototype.afterSave);\n    //register unique constraint listener at the end of listeners collection (before emit)\n    self.once('before.save', UniqueConstraintListener.prototype.beforeSave);\n    //register data validators at the end of listeners collection (before emit)\n    self.once('before.save', DataValidatorListener.prototype.beforeSave);\n    //register not null listener at the end of listeners collection (before emit)\n    self.once('before.save', NotNullConstraintListener.prototype.beforeSave);\n    //execute before update events\n    self.emit('before.save', e, function(err) {\n        //if an error occurred\n        if (err) {\n            //invoke callback with error\n            return callback(err);\n        }\n        //otherwise execute save operation\n        else {\n            //save base object if any\n            saveBaseObject_.bind(self)(e.target, function(err, result) {\n                if (err) {\n                    return callback(err);\n                }\n                //if result is defined\n                if (result!==undefined)\n                //sync original object\n                    _.assign(e.target, result);\n                //get db context\n                const db = self.context.db;\n                //create insert query\n                const target = self.cast(e.target, e.state);\n                let q = null;\n                const key = target[self.primaryKey];\n                if (e.state===1) {\n                    //create insert statement\n                    q = QueryExpression.create().insert(target).into(self.sourceAdapter);\n                }\n                else\n                {\n                    //create update statement\n                    if (key)\n                        delete target[self.primaryKey];\n                    if (Object.keys(target).length>0)\n                        q = QueryExpression.create().update(self.sourceAdapter).set(target).where(self.primaryKey).equal(e.target[self.primaryKey]);\n                    else\n                    //object does not have any properties other than primary key. do nothing\n                        q = new EmptyQueryExpression();\n                }\n                if (q instanceof EmptyQueryExpression) {\n                    if (key)\n                        target[self.primaryKey] = key;\n                    //get updated object\n                    self.recast(e.target, target, function(err) {\n                        if (err) {\n                            //and return error\n                            return callback(err);\n                        }\n                        else {\n                            //execute after update events\n                            self.emit('after.save',e, function(err) {\n                                //and return\n                                return callback.call(self, err, e.target);\n                            });\n                        }\n                    });\n                }\n                else {\n                    const pm = e.model.field(self.primaryKey);\n                    let nextIdentity;\n                    const adapter = e.model.sourceAdapter;\n                    //search if adapter has a nextIdentity function (also primary key must be a counter and state equal to insert)\n                    if (pm.type === 'Counter' && typeof db.nextIdentity === 'function' && e.state===1) {\n                        nextIdentity = db.nextIdentity;\n                    }\n                    else {\n                        //otherwise use a dummy nextIdentity function\n                        nextIdentity = function(a, b, callback) { return callback(); }\n                    }\n                    nextIdentity.bind(db)(adapter, pm.name, function(err, insertedId) {\n                        if (err) { return callback(err); }\n                        if (insertedId) {\n                            //get object to insert\n                            if (q.$insert) {\n                                const o = q.$insert[adapter];\n                                if (o) {\n                                    //set the generated primary key\n                                    o[pm.name] = insertedId;\n                                }\n                            }\n                        }\n                        db.execute(q, null, function(err, result) {\n                            if (err) {\n                                return callback(err);\n                            }\n                            else {\n                                if (key)\n                                    target[self.primaryKey] = key;\n                                //get updated object\n                                self.recast(e.target, target, function(err) {\n                                    if (err) {\n                                        callback.call(self, err);\n                                    }\n                                    else {\n                                        if (pm.type==='Counter' && typeof db.nextIdentity !== 'function' && e.state===1) {\n                                            //if data adapter contains lastIdentity function\n                                            const lastIdentity = db.lastIdentity || function(lastCallback) {\n                                                if (_.isNil(result))\n                                                    lastCallback(null, { insertId: null});\n                                                lastCallback(null, result);\n                                            };\n                                            lastIdentity.bind(db)(function(err, lastResult) {\n                                                if (lastResult)\n                                                    if (lastResult.insertId)\n                                                        e.target[self.primaryKey] = lastResult.insertId;\n                                                //raise after save listeners\n                                                self.emit('after.save',e, function(err) {\n                                                    //invoke callback\n                                                    return callback(err, e.target);\n                                                });\n                                            });\n                                        }\n                                        else {\n                                            //raise after save listeners\n                                            self.emit('after.save',e, function(err) {\n                                                //invoke callback\n                                                return callback(err, e.target);\n                                            });\n                                        }\n                                    }\n                                });\n                            }\n                        });\n                    });\n                }\n            });\n        }\n    });\n}\n\n/**\n * @param {*|Array} obj\n * @param {Function} callback\n * @private\n */\nfunction update_(obj, callback) {\n    const self = this;\n    //ensure callback\n    callback = callback || function() {};\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    //set state\n    if (_.isArray(obj)) {\n        obj.forEach(function(x) {x['$state'] = 2; })\n    }\n    else {\n        obj['$state'] = 2;\n    }\n    self.save(obj, callback);\n}\n\n/**\n * @param {*|Array} obj\n * @param {Function} callback\n * @private\n */\nfunction insert_(obj, callback) {\n    const self = this;\n    //ensure callback\n    callback = callback || function() {};\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    //set state\n    if (_.isArray(obj)) {\n        obj.forEach(function(x) {x['$state'] = 1; })\n    }\n    else {\n        obj['$state'] = 1;\n    }\n    self.save(obj, callback);\n}\n\n/**\n *\n * @param {*|Array} obj\n * @param {Function} callback\n * @private\n */\nfunction remove_(obj, callback) {\n    const self = this;\n    if (_.isNil(obj))\n    {\n        return callback();\n    }\n\n    self.migrate(function(err) {\n        if (err) { callback(err); return; }\n        const arr = [];\n        if (_.isArray(obj)) {\n            for (let i = 0; i < obj.length; i++)\n                arr.push(obj[i]);\n        }\n        else\n            arr.push(obj);\n        //delete objects\n        const db = self.context.db;\n        db.executeInTransaction(function(cb) {\n            async.eachSeries(arr, function(item, removeCallback) {\n                removeSingleObject_.bind(self)(item, function(err) {\n                    if (err) {\n                        return removeCallback(err);\n                    }\n                    return removeCallback();\n                });\n            }, function(err) {\n                if (err) {\n                    return cb(err);\n                }\n                return cb();\n            });\n        }, function(err) {\n            return callback(err);\n        });\n    });\n}\n\n/**\n * @param {Object} obj\n * @param {Function} callback\n * @private\n */\nfunction removeSingleObject_(obj, callback) {\n    const self = this;\n    callback = callback || function() {};\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    if (_.isArray(obj)) {\n        return callback(new Error('Invalid argument. Object cannot be an array.'));\n    }\n    const e = {\n        model: self,\n        target: obj,\n        state: 4\n    };\n    //register nested objects listener\n    self.once('before.remove', DataNestedObjectListener.prototype.beforeRemove);\n    //register data association listener\n    self.once('before.remove', DataObjectAssociationListener.prototype.afterSave);\n    //execute before update events\n    self.emit('before.remove', e, function(err) {\n        //if an error occurred\n        if (err) {\n            //invoke callback with error\n            return callback(err);\n        }\n        //get db context\n        const db = self.context.db;\n        //create delete query\n        const q = QueryExpression.create().delete(self.sourceAdapter).where(self.primaryKey).equal(obj[self.primaryKey]);\n        //execute delete query\n        db.execute(q, null, function(err) {\n            if (err) {\n                return callback(err);\n            }\n            //remove base object\n            removeBaseObject_.bind(self)(e.target, function(err, result) {\n                if (err) {\n                    return callback(err);\n                }\n                if (typeof result !== 'undefined' && result !== null) {\n                    _.assign(e.target, result);\n                }\n                //execute after remove events\n                self.emit('after.remove',e, function(err) {\n                    //invoke callback\n                    return callback(err, e.target);\n                });\n            });\n        });\n    });\n\n}\n\n/**\n * @param {*} obj\n * @param {Function} callback\n * @private\n */\nfunction removeBaseObject_(obj, callback) {\n    //ensure callback\n    callback = callback || function() {};\n    const self = this, base = self.base();\n    //if obj is an array of objects throw exception (invoke callback with error)\n    if (_.isArray(obj)) {\n        return callback(new Error('Invalid argument. Object cannot be an array.'));\n    }\n    //if current model does not have a base model\n    if (_.isNil(base)) {\n        //exit operation\n        return callback();\n    }\n    else {\n        base.silent();\n        //perform operation\n        removeSingleObject_.bind(base)(obj, function(err, result) {\n            return callback(err, result);\n        });\n    }\n}\n\n/**\n * Validates that the given string is plural or not.\n * @param s {string}\n * @returns {boolean}\n * @private\n */\nDataModel.PluralExpression = /([a-zA-Z]+?)([e']s|[^aiou]s)$/;\n\n\n/**\n * @param {DataField|*} field\n * @param {DataAssociationMapping|*} mapping\n * @private\n */\nfunction cacheMapping_(field, mapping) {\n    if (_.isNil(field))\n        return;\n    //cache mapping\n    const cachedModel = this.getConfiguration().models[this.name];\n    if (cachedModel) {\n        let cachedField = cachedModel.fields.find(function(x) { return x.name === field.name });\n        if (typeof cachedField === 'undefined') {\n            //search in attributes\n            cachedField = this.attributes.find(function(x) { return x.name === field.name });\n            if (cachedField) {\n                //add overridden field\n                cachedModel.fields.push(_.assign({ }, cachedField));\n                cachedField = cachedModel.fields[cachedModel.fields.length-1];\n                //clear attributes\n                this._clearAttributes();\n            }\n        }\n        if (cachedField)\n        //add mapping\n            cachedField.mapping = mapping;\n    }\n}\n\n\n/**\n * @function\n * @param {*} obj\n * @param {number} state\n * @param {Function} callback\n * @private\n */\nfunction validate_(obj, state, callback) {\n    /**\n     * @type {DataModel|*}\n     */\n    const self = this;\n    if (_.isNil(obj)) {\n        return callback();\n    }\n    //get object copy (based on the defined state)\n    const objCopy = castForValidation_.call (self, obj, state);\n\n    const attributes = self.attributes.filter(function(x) {\n        if (x.model!==self.name) {\n            if (!x.cloned)\n                return false;\n        }\n        return (!x.readonly) ||\n            (x.readonly && (typeof x.calculation!=='undefined') && state===2) ||\n            (x.readonly && (typeof x.value!=='undefined') && state===1) ||\n            (x.readonly && (typeof x.calculation!=='undefined') && state===1);\n    }).filter(function(y) {\n        return (state===2) ? (y.hasOwnProperty(\"editable\") ? y.editable : true) : true;\n    });\n\n    async.eachSeries(attributes, function(attr, cb) {\n        let validationResult;\n        //get value\n        const value = objCopy[attr.name];\n        //build validators array\n        const arrValidators=[];\n        //-- RequiredValidator\n        if (attr.hasOwnProperty('nullable') && !attr.nullable)\n        {\n            if (state===1 && !attr.primary) {\n                arrValidators.push(new RequiredValidator());\n            }\n            else if (state===2 && !attr.primary && objCopy.hasOwnProperty(attr.name)) {\n                arrValidators.push(new RequiredValidator());\n            }\n        }\n        //-- MaxLengthValidator\n        if (attr.hasOwnProperty('size') && objCopy.hasOwnProperty(attr.name)) {\n            if (!(attr.validation && attr.validation.maxLength))\n                arrValidators.push(new MaxLengthValidator(attr.size));\n        }\n        //-- CustomValidator\n        if (attr.validation && attr.validation['validator'] && objCopy.hasOwnProperty(attr.name)) {\n            let validatorModule;\n            try {\n                if (/^\\./ig.test(attr.validation['validator'])) {\n                    const modulePath = PathUtils.join(self.context.getConfiguration().getExecutionPath(), attr.validation['validator']);\n                    validatorModule = require(modulePath);\n                }\n                else {\n                    validatorModule = require(attr.validation['validator']);\n                }\n            }\n            catch (e) {\n                TraceUtils.debug(sprintf.sprintf(\"Data validator module (%s) cannot be loaded\", attr.validation.type));\n                TraceUtils.debug(e);\n                return cb(e);\n            }\n            if (typeof validatorModule.createInstance !== 'function') {\n                TraceUtils.debug(sprintf.sprintf(\"Data validator module (%s) does not export createInstance() method.\", attr.validation.type));\n                return cb(new Error(\"Invalid data validator type.\"));\n            }\n            arrValidators.push(validatorModule.createInstance(attr));\n        }\n        //-- DataTypeValidator #1\n        if (attr.validation && objCopy.hasOwnProperty(attr.name)) {\n            if (typeof attr.validation.type === 'string') {\n                arrValidators.push(new DataTypeValidator(attr.validation.type));\n            }\n            else {\n                //convert validation data to pseudo type declaration\n                const validationProperties = {\n                    properties:attr.validation\n                };\n                arrValidators.push(new DataTypeValidator(validationProperties));\n            }\n        }\n        //-- DataTypeValidator #2\n        if (attr.type && objCopy.hasOwnProperty(attr.name)) {\n            arrValidators.push(new DataTypeValidator(attr.type));\n        }\n\n        if (arrValidators.length === 0) {\n            return cb();\n        }\n        //do validation\n        async.eachSeries(arrValidators, function(validator, cb) {\n\n            //set context\n            if (typeof validator.setContext === 'function') {\n                validator.setContext(self.context);\n            }\n            //set target\n            validator.target = obj;\n            if (typeof validator.validateSync === 'function') {\n                validationResult = validator.validateSync(value);\n                if (validationResult) {\n                    return cb(new DataError(validationResult.code || \"EVALIDATE\",validationResult.message, validationResult.innerMessage, self.name, attr.name));\n                }\n                else {\n                    return cb();\n                }\n            }\n            else if (typeof validator.validate === 'function') {\n                return validator.validate(value, function(err, validationResult) {\n                    if (err) {\n                        return cb(err);\n                    }\n                    if (validationResult) {\n                        return cb(new DataError(validationResult.code || \"EVALIDATE\",validationResult.message, validationResult.innerMessage, self.name, attr.name));\n                    }\n                    return cb();\n                });\n            }\n            else {\n                TraceUtils.debug(sprintf.sprintf(\"Data validator (%s) does not have either validate() or validateSync() methods.\", attr.validation.type));\n                return cb(new Error(\"Invalid data validator type.\"));\n            }\n        }, function(err) {\n            return cb(err);\n        });\n\n    }, function(err) {\n        return callback(err);\n    });\n}\n"]}