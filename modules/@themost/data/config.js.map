{"version":3,"sources":["config.es6"],"names":["_","TraceUtils","PathUtils","Args","RandomUtils","ConfigurationStrategy","ConfigurationBase","_dasherize","s","isString","trim","replace","toLowerCase","dasherize","mixin","AuthSettings","name","defaultUserGroup","unattendedExecutionAccount","randomHex","timeout","slidingExpiration","loginPage","dataTypesProperty","Symbol","adapterTypesProperty","DataConfigurationStrategy","config","require","hasStrategy","SchemaLoaderStrategy","useStrategy","DefaultSchemaLoaderStrategy","ModelClassLoaderStrategy","DefaultModelClassLoaderStrategy","getConfiguration","hasSourceAt","setSourceAt","configAdapterTypes","getSourceAt","self","forEach","x","invariantName","valid","adapterModule","type","main","test","createInstance","log","err","error","isNil","dataTypes","hasOwnProperty","schemaLoader","getStrategy","getModelDefinition","data","setModelDefinition","configuration","getCurrent","DefaultDataConfigurationStrategy","modelsProperty","Map","notString","result","get","iterator","keys","keyIt","next","done","value","notNull","set","filesProperty","modelPathProperty","join","getConfigurationPath","p","getModelDefinitionSuper","i","hasDataType","modelDefinition","bind","isObject","modelPath","getModelPath","nativeFsModule","fs","readdirSync","concat","files","length","r","RegExp","lastIndex","finalPath","model","DataObjectClass","isFunction","classPath","getExecutionPath","code","DataObject","resolve","base"],"mappings":"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","file":"config.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\nimport 'source-map-support/register';\nimport _ from 'lodash';\nimport {TraceUtils,PathUtils} from \"@themost/common/utils\";\nimport {Args} from \"@themost/common/utils\";\nimport {ConfigurationStrategy, ConfigurationBase} from \"@themost/common/config\";\nimport {RandomUtils} from \"@themost/common/utils\";\n\n/**\n *\n * @param s\n * @returns {*}\n * @private\n */\nfunction _dasherize(s) {\n    if (_.isString(s))\n        return _.trim(s).replace(/[_\\s]+/g, '-').replace(/([A-Z])/g, '-$1').replace(/-+/g, '-').replace(/^-/,'').toLowerCase();\n    return s;\n}\n\n/**\n * @method dasherize\n * @memberOf _\n */\n\nif (typeof _.dasherize !== 'function') {\n    _.mixin({'dasherize' : _dasherize});\n}\n\n\n/**\n * @ignore\n * @class\n * @property {string} name\n * @property {string} defaultUserGroup\n * @property {string} unattendedExecutionAccount\n * @property {number} timeout\n * @property {boolean} slidingExpiration\n * @property {string} loginPage\n */\nexport class AuthSettings {\n    constructor() {\n        this.name = '.MAUTH';\n        this.defaultUserGroup = 'Users';\n        this.unattendedExecutionAccount = RandomUtils.randomHex(16);\n        this.timeout = 480;\n        this.slidingExpiration = false;\n        this.loginPage = '/login';\n    }\n}\n\nconst dataTypesProperty = Symbol('dataTypes');\nconst adapterTypesProperty =  Symbol('adapterTypes');\n\n/**\n * @classdesc Holds the configuration of data modeling infrastructure\n * @class\n * @property {AuthSettings} auth\n * @extends ConfigurationStrategy\n *\n */\nexport class DataConfigurationStrategy extends ConfigurationStrategy {\n    /**\n     * @constructor\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n        this[dataTypesProperty] = require('./resources/dataTypes.json');\n\n        //register other strategies\n        if (!config.hasStrategy(SchemaLoaderStrategy)) {\n            config.useStrategy(SchemaLoaderStrategy, DefaultSchemaLoaderStrategy);\n        }\n        if (!config.hasStrategy(ModelClassLoaderStrategy)) {\n            config.useStrategy(ModelClassLoaderStrategy, DefaultModelClassLoaderStrategy);\n        }\n\n        if (!this.getConfiguration().hasSourceAt('adapters')) {\n            this.getConfiguration().setSourceAt('adapters',[]);\n        }\n\n        if (!this.getConfiguration().hasSourceAt('adapterTypes')) {\n            this.getConfiguration().setSourceAt('adapterTypes',[]);\n        }\n\n        if (!this.getConfiguration().hasSourceAt('settings/auth')) {\n            this.getConfiguration().setSourceAt('settings/auth', new AuthSettings());\n        }\n\n        const configAdapterTypes = this.getConfiguration().getSourceAt('adapterTypes');\n        this[adapterTypesProperty] = {};\n        const self = this;\n        //configure adapter types\n        _.forEach(configAdapterTypes, function(x) {\n            //first of all validate module\n            x.invariantName = x.invariantName || 'unknown';\n            x.name = x.name || 'Unknown Data Adapter';\n            let valid = false, adapterModule;\n            if (x.type) {\n                try {\n                    if (require.main && /^@themost\\//.test(x.type)) {\n                        adapterModule = require.main.require(x.type);\n                    }\n                    else {\n                        adapterModule = require(x.type);\n                    }\n\n                    if (typeof adapterModule.createInstance === 'function') {\n                        valid = true;\n                    }\n                    else {\n                        //adapter type does not export a createInstance(options) function\n                        TraceUtils.log(\"The specified data adapter type (%s) does not have the appropriate constructor. Adapter type cannot be loaded.\", x.invariantName);\n                    }\n                }\n                catch(err) {\n                    //catch error\n                    TraceUtils.error(err);\n                    //and log a specific error for this adapter type\n                    TraceUtils.log(\"The specified data adapter type (%s) cannot be instantiated. Adapter type cannot be loaded.\", x.invariantName);\n                }\n                if (valid) {\n                    //register adapter\n                    self[adapterTypesProperty][x.invariantName] = {\n                        invariantName:x.invariantName,\n                        name: x.name,\n                        createInstance:adapterModule.createInstance\n                    };\n                }\n            }\n            else {\n                TraceUtils.log(\"The specified data adapter type (%s) does not have a type defined. Adapter type cannot be loaded.\", x.invariantName);\n            }\n        });\n    }\n\n    /**\n     * @returns {AuthSettings|*}\n     */\n    getAuthSettings() {\n        return this.getConfiguration().getSourceAt('settings/auth');\n    }\n\n    /**\n     * @returns {Array}\n     */\n    get adapters() {\n        return this.getConfiguration().getSourceAt('adapters');\n    }\n\n    /**\n     * @returns {*}\n     */\n    get adapterTypes() {\n        return this[adapterTypesProperty];\n    }\n\n    /**\n     * @param {string} invariantName\n     * @returns {*}\n     */\n    getAdapterType(invariantName) {\n        return this[adapterTypesProperty][invariantName];\n    }\n\n    /**\n     * Returns the collection of defined data types (e.g. Integer, Float, Language etc)\n     * @returns {*}\n     */\n    get dataTypes() {\n        return this[dataTypesProperty];\n    }\n\n    /**\n     * Gets a boolean which indicates whether the specified data type is defined in data types collection or not.\n     * @param name\n     * @returns {boolean}\n     */\n    hasDataType(name) {\n        if (_.isNil(name)) {\n            return false;\n        }\n        if (typeof name !== 'string') {\n            return false;\n        }\n        return this.dataTypes.hasOwnProperty(name);\n    }\n\n    /**\n     * Gets a native object which represents the definition of the model with the given name.\n     * @param {string} name\n     * @returns {DataModel|undefined}\n     */\n    getModelDefinition(name) {\n        /**\n         * @type {SchemaLoaderStrategy}\n         */\n        const schemaLoader = this.getConfiguration().getStrategy(SchemaLoaderStrategy);\n        return schemaLoader.getModelDefinition(name);\n    }\n\n    /**\n     * Sets a data model definition in application storage.\n     * Use this method in order to override default model loading process.\n     * @param {*} data - A generic object which represents a model definition\n     * @returns {DataConfigurationStrategy}\n     * @example\n     import {DataConfigurationStrategy} from '@themost/data/config';\n     DataConfigurationStrategy.getCurrent().setModelDefinition({\n            \"name\":\"UserColor\",\n            \"version\":\"1.1\",\n            \"title\":\"User Colors\",\n            \"fields\":[\n                { \"name\": \"id\", \"title\": \"Id\", \"type\": \"Counter\", \"nullable\": false, \"primary\": true },\n                { \"name\": \"user\", \"title\": \"User\", \"type\": \"User\", \"nullable\": false },\n                { \"name\": \"color\", \"title\": \"Color\", \"type\": \"Text\", \"nullable\": false, \"size\":12 },\n                { \"name\": \"tag\", \"title\": \"Tag\", \"type\": \"Text\", \"nullable\": false, \"size\":24 }\n                ],\n            \"constraints\":[\n                {\"type\":\"unique\", \"fields\": [ \"user\" ]}\n            ],\n            \"privileges\":[\n                { \"mask\":15, \"type\":\"self\",\"filter\":\"id eq me()\" }\n                ]\n        });\n     */\n    setModelDefinition(data) {\n        /**\n         * @type {SchemaLoaderStrategy}\n         */\n        const schemaLoader = this.getConfiguration().getStrategy(SchemaLoaderStrategy);\n        schemaLoader.setModelDefinition(data);\n        return this;\n    }\n\n    /**\n     * @returns {*}\n     * @param name {string}\n     */\n    model(name) {\n        return this.getModelDefinition(name);\n    }\n    /**\n     * Gets the current data configuration\n     * @returns DataConfigurationStrategy - An instance of DataConfiguration class which represents the current data configuration\n     */\n    static getCurrent() {\n        const configuration = ConfigurationBase.getCurrent();\n        if (!configuration.hasStrategy(DataConfigurationStrategy)) {\n            configuration.useStrategy(DataConfigurationStrategy, DataConfigurationStrategy);\n        }\n        return configuration.getStrategy(DataConfigurationStrategy);\n    }\n\n}\n\n/**\n * @classdesc Represents the default data configuration strategy\n * @class\n * @extends DataConfigurationStrategy\n */\nexport class DefaultDataConfigurationStrategy extends DataConfigurationStrategy {\n    /**\n     * @constructor\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n    }\n}\n\nconst modelsProperty = Symbol('models');\n\nexport class SchemaLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n        this[modelsProperty] = new Map();\n        this.setModelDefinition({\n            \"name\":\"Migration\", \"title\":\"Data Model Migrations\", \"id\": 14,\n            \"source\":\"migrations\", \"view\":\"migrations\", \"hidden\": true, \"sealed\":true,\n            \"fields\":[\n                { \"name\":\"id\", \"type\":\"Counter\", \"primary\":true },\n                { \"name\":\"appliesTo\", \"type\":\"Text\", \"size\":180, \"nullable\":false },\n                { \"name\":\"model\", \"type\":\"Text\", \"size\":120 },\n                { \"name\":\"description\", \"type\":\"Text\", \"size\":512},\n                { \"name\":\"version\", \"type\":\"Text\", \"size\":40, \"nullable\":false }\n            ],\n            \"constraints\":[\n                { \"type\":\"unique\", \"fields\":[ \"appliesTo\", \"version\" ] }\n            ]\n        });\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @returns {*}\n     */\n    getModelDefinition(name) {\n        Args.notString(name,'Model name');\n        let result = this[modelsProperty].get(name);\n        if (typeof result !== 'undefined') {\n            return result;\n        }\n        //case insensitive search\n        const iterator = this[modelsProperty].keys();\n        let keyIt = iterator.next();\n        while(!keyIt.done) {\n            if ((typeof keyIt.value === 'string') && (keyIt.value.toLowerCase() === name.toLowerCase())) {\n                return this[modelsProperty].get(keyIt.value);\n            }\n            keyIt = iterator.next();\n        }\n    }\n\n    /**\n     *\n     * @param {*} data\n     * @returns {SchemaLoaderStrategy}\n     */\n    setModelDefinition(data) {\n        Args.notNull(data,'Model definition');\n        Args.notString(data.name,'Model name');\n        this[modelsProperty].set(data.name,data);\n        return this;\n    }\n\n    /**\n     * @returns {string[]}\n     */\n    getModels() {\n        return _.keys(this[modelsProperty]);\n    }\n\n}\n\nconst filesProperty = Symbol('files');\nconst modelPathProperty = Symbol('modelPath');\n\n/**\n * @class\n * @extends SchemaLoaderStrategy\n */\nexport class DefaultSchemaLoaderStrategy extends SchemaLoaderStrategy {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n        this[modelPathProperty] = PathUtils.join(config.getConfigurationPath(), 'models');\n    }\n\n    /**\n     * Gets a string which represents the directory which contains model definitions.\n     * @returns {*}\n     */\n    getModelPath() {\n        return this[modelPathProperty];\n    }\n\n    /**\n     * Sets the directory of model definitions.\n     * @param {string} p\n     * @returns {DefaultSchemaLoaderStrategy}\n     */\n    setModelPath(p) {\n        this[modelPathProperty] = p;\n        return this;\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @returns {*}\n     */\n    getModelDefinition(name) {\n        const getModelDefinitionSuper = super.getModelDefinition;\n        let i;\n        if (typeof name !== 'string')\n            return;\n        //exclude registered data types\n        if (this.getConfiguration().getStrategy(DataConfigurationStrategy).hasDataType(name)) {\n            return;\n        }\n        let modelDefinition = getModelDefinitionSuper.bind(this)(name);\n        //first of all try to find if model definition is already in cache\n        if (_.isObject(modelDefinition)) {\n            //and return it//and return it\n            return modelDefinition;\n        }\n        //otherwise open definition file\n        const modelPath = this.getModelPath();\n        //read files from models directory\n        //store file list in a private variable\n        if (typeof this[filesProperty] === 'undefined') {\n            const nativeFsModule = 'fs';\n            const fs = require(nativeFsModule);\n            if (typeof fs.readdirSync === 'function') {\n                this[filesProperty] = fs.readdirSync(modelPath);\n            }\n            else {\n                //try load model definition\n                try {\n                    modelDefinition = require(PathUtils.join(modelPath, name.concat('json')));\n                    this.setModelDefinition(modelDefinition);\n                }\n                catch(err) {\n                    //do nothing (log error)\n                    TraceUtils.error('An error occurred while loading definition for model %s.', name);\n                    TraceUtils.error(err);\n                }\n            }\n        }\n        //and finally get this list of file\n        const files = this[filesProperty];\n        if (files.length===0)\n            return;\n        const r = new RegExp('^' + name.concat('.json') + '$','i');\n        for (i = 0; i < files.length; i++) {\n            r.lastIndex=0;\n            if (r.test(files[i])) {\n                //build model file path\n                const finalPath = PathUtils.join(modelPath, files[i]);\n                //get model\n                const result = require(finalPath);\n                //set definition\n                this.setModelDefinition(result);\n                //and finally return this definition\n                return result;\n            }\n        }\n    }\n}\n\n/**\n * @classdesc Represents a model class loader strategy\n * @class\n * @extends ConfigurationBase\n */\nexport class ModelClassLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n    }\n}\n\n/**\n * @classdesc Represents the default model class loader strategy.\n * @class\n * @extends ConfigurationBase\n */\nexport class DefaultModelClassLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n    }\n\n    /**\n     * @param {DataModel} model\n     * @returns {Function}\n     */\n    resolve(model) {\n        Args.notNull(model, 'Model');\n        let DataObjectClass = this['DataObjectClass'];\n        if (_.isFunction(DataObjectClass)) {\n            return DataObjectClass;\n        }\n        //get model definition\n        const modelDefinition = this.getConfiguration().getStrategy(SchemaLoaderStrategy).getModelDefinition(model.name);\n        if (typeof model.classPath === 'string') {\n            modelDefinition['DataObjectClass'] = DataObjectClass = require(self.classPath);\n        }\n        else {\n            //try to find module by using capitalize naming convention\n            // e.g. OrderDetail -> OrderDetailModel.js\n            let classPath = PathUtils.join(this.getConfiguration().getExecutionPath(),'models',model.name.concat('Model.js'));\n            try {\n                modelDefinition['DataObjectClass'] = DataObjectClass = require(classPath);\n            }\n            catch(err) {\n                if (err.code === 'MODULE_NOT_FOUND') {\n                    try {\n                        //try to find module by using dasherize naming convention\n                        // e.g. OrderDetail -> order-detail-model.js\n                        classPath = PathUtils.join(this.getConfiguration().getExecutionPath(),'models',_.dasherize(model.name).concat('-model.js'));\n                        modelDefinition['DataObjectClass'] = DataObjectClass = require(classPath);\n                    }\n                    catch(err) {\n                        if (err.code === 'MODULE_NOT_FOUND') {\n                            if (typeof this['inherits'] === 'undefined' || this['inherits'] === null) {\n                                //use default DataObject class\n                                modelDefinition['DataObjectClass'] = DataObjectClass = require('./object').DataObject;\n                            }\n                            else {\n                                modelDefinition['DataObjectClass'] = DataObjectClass = this.resolve(model.base());\n                            }\n                        }\n                        else {\n                            throw err;\n                        }\n                    }\n                }\n                else {\n                    throw err;\n                }\n            }\n        }\n        return DataObjectClass;\n    }\n\n}\n\n\n"]}