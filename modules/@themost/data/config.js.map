{"version":3,"sources":["config.es6"],"names":["_","sprintf","TraceUtils","PathUtils","Args","AbstractClassError","AbstractMethodError","DataConfigurationAuth","configurationProperty","Symbol","ConfigurationStrategy","config","check","new","target","DataConfiguration","notNull","strategiesProperty","configPathProperty","executionPathProperty","dataTypesProperty","currentConfiguration","configPath","join","process","cwd","require","useStrategy","SchemaLoaderStrategy","DefaultSchemaLoaderStrategy","ModelClassLoaderStrategy","DefaultModelClassLoaderStrategy","ListenerLoaderStrategy","DefaultListenerLoaderStrategy","env","err","code","log","error","adapters","adapterTypes","Object","defineProperty","get","isArray","forEach","x","invariantName","name","valid","adapterModule","type","createInstance","auth","settings","getAuthSettings","e","er","Error","p","isNil","dataTypes","hasOwnProperty","schemaLoader","getStrategy","getModelDefinition","data","setModelDefinition","configStrategyCtor","strategyCtor","notFunction","configuration","hasStrategy","TypeError","modelsProperty","Map","notString","result","iterator","keys","keyIt","next","done","value","toLowerCase","set","filesProperty","modelPathProperty","getConfigurationPath","self","getModelDefinitionSuper","i","getConfiguration","hasDataType","modelDefinition","bind","isObject","modelPath","getModelPath","nativeFsModule","fs","readdirSync","concat","files","length","r","RegExp","lastIndex","test","finalPath","finalName","model","DataObjectClass","isFunction","classPath","getExecutionPath","rootPath","dasherize","DataObject","resolve","base","listener"],"mappings":"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","file":"config.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2014, Kyriakos Barbounakis k.barbounakis@gmail.com\n *                     Anthi Oikonomou anthioikonomou@gmail.com\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\n'use strict';\nimport 'source-map-support/register';\nimport {_} from 'lodash';\nimport sprintf from 'sprintf';\nimport {TraceUtils,PathUtils} from \"@themost/common/utils\";\nimport {Args} from \"@themost/common/utils\";\nimport {AbstractClassError, AbstractMethodError} from \"@themost/common/errors\";\n\n\n/**\n * @ignore\n * @class\n * @property {string} name\n * @property {string} defaultUserGroup\n * @property {string} unattendedExecutionAccount\n * @property {number} timeout\n * @property {boolean} slidingExpiration\n * @property {string} loginPage\n */\nexport class DataConfigurationAuth {\n    constructor() {\n\n    }\n}\n\nconst configurationProperty = Symbol('configuration');\n\n/**\n * @class\n */\nexport class ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        Args.check(new.target !== DataConfiguration, new AbstractClassError());\n        Args.notNull(config, 'Configuration');\n        this[configurationProperty] = config;\n    }\n\n    /**\n     *\n     * @returns {DataConfiguration}\n     */\n    getConfiguration() {\n        return this[configurationProperty];\n    }\n\n}\n\nconst strategiesProperty = Symbol('strategies');\nconst configPathProperty = Symbol('configurationPath');\nconst executionPathProperty = Symbol('configurationPath');\nconst dataTypesProperty = Symbol('dataTypes');\nconst currentConfiguration = Symbol('current');\n\n/**\n * @classdesc Holds the configuration of data modeling infrastructure\n * @class\n * @property {DataConfigurationAuth} auth\n *\n */\nexport class DataConfiguration {\n    /**\n     * @constructor\n     * @param {string=} configPath - The root directory of configuration files.\n     */\n    constructor(configPath) {\n\n        this[strategiesProperty] = { };\n        this[configPathProperty] = configPath || PathUtils.join(process.cwd(),'config');\n        this[executionPathProperty] = PathUtils.join(this[configPathProperty],'..');\n        this[dataTypesProperty] = require('./resources/dataTypes.json');\n        this.useStrategy(SchemaLoaderStrategy, DefaultSchemaLoaderStrategy);\n        this.useStrategy(ModelClassLoaderStrategy, DefaultModelClassLoaderStrategy);\n        this.useStrategy(ListenerLoaderStrategy, DefaultListenerLoaderStrategy);\n\n        //get application adapter types, if any\n        let config;\n        try {\n            const env = process.env['NODE_ENV'] || 'production';\n            config = require(PathUtils.join(this[configPathProperty], 'app.' + env + '.json'));\n        }\n        catch (err) {\n            if (err.code === 'MODULE_NOT_FOUND') {\n                TraceUtils.log('Data: The environment specific configuration cannot be found or is inaccesible.');\n                try {\n                    config = require(PathUtils.join(this[configPathProperty], 'app.json'));\n                }\n                catch(err) {\n                    if (err.code === 'MODULE_NOT_FOUND') {\n                        TraceUtils.log('Data: The default application configuration cannot be found or is inaccesible.');\n                    }\n                    else {\n                        TraceUtils.error('Data: An error occured while trying to open default application configuration.');\n                        TraceUtils.error(err);\n                    }\n                    config = { adapters:[], adapterTypes:[]  };\n                }\n            }\n            else {\n                TraceUtils.error('Data: An error occured while trying to open application configuration.');\n                TraceUtils.error(err);\n                config = { adapters:[], adapterTypes:[]  };\n            }\n        }\n\n        /**\n         * @type {Array}\n         * @private\n         */\n        let adapters;\n        Object.defineProperty(this, 'adapters', {\n            get: function()\n            {\n                if (adapters)\n                    return adapters;\n                /**\n                 * get data types from configuration file\n                 * @property {Array} adapters\n                 * @type {*}\n                 */\n                adapters = config.adapters || [];\n                return adapters;\n            }\n        });\n\n        const adapterTypes = { };\n\n        if (config.adapterTypes) {\n            if (_.isArray(config.adapterTypes)) {\n                config.adapterTypes.forEach(function(x) {\n                    //first of all validate module\n                    x.invariantName = x.invariantName || 'unknown';\n                    x.name = x.name || 'Unknown Data Adapter';\n                    let valid = false, adapterModule;\n                    if (x.type) {\n                        try {\n                            adapterModule = require(x.type);\n                            if (typeof adapterModule.createInstance === 'function') {\n                                valid = true;\n                            }\n                            else {\n                                //adapter type does not export a createInstance(options) function\n                                TraceUtils.log(sprintf.sprintf(\"The specified data adapter type (%s) does not have the appropriate constructor. Adapter type cannot be loaded.\", x.invariantName));\n                            }\n                        }\n                        catch(err) {\n                            //catch error\n                            TraceUtils.error(err);\n                            //and log a specific error for this adapter type\n                            TraceUtils.log(sprintf.sprintf(\"The specified data adapter type (%s) cannot be instantiated. Adapter type cannot be loaded.\", x.invariantName));\n                        }\n                        if (valid) {\n                            //register adapter\n                            adapterTypes[x.invariantName] = {\n                                invariantName:x.invariantName,\n                                name: x.name,\n                                createInstance:adapterModule.createInstance\n                            };\n                        }\n                    }\n                    else {\n                        TraceUtils.log(sprintf.sprintf(\"The specified data adapter type (%s) does not have a type defined. Adapter type cannot be loaded.\", x.invariantName));\n                    }\n                });\n            }\n        }\n\n        Object.defineProperty(this, 'adapterTypes', {\n            get: function()\n            {\n                return adapterTypes;\n            }\n        });\n\n        let auth;\n        Object.defineProperty(this, 'auth', {\n            get: function()\n            {\n                try {\n                    if (auth) { return auth; }\n                    if (typeof config.settings === 'undefined' || config.settings== null) {\n                        auth = config.auth || {};\n                        return auth;\n                    }\n                    auth = config.settings.auth || {};\n                    return auth;\n                }\n                catch(err) {\n                    TraceUtils.error('An error occured while trying to load auth configuration');\n                    TraceUtils.error(err);\n                    auth = {};\n                    return auth;\n                }\n            }\n        });\n\n        //ensure authentication settings\n        config.settings = config.settings || { };\n        config.settings.auth = config.settings.auth || { };\n        this.getAuthSettings = function() {\n            try {\n                return config.settings.auth;\n            }\n            catch(e) {\n                const er = new Error('An error occured while trying to load auth configuration');\n                er.code = \"ECONF\";\n                throw er;\n            }\n        };\n\n    }\n\n    /**\n     * Returns the collection of defined data types (e.g. Integer, Float, Language etc)\n     * @returns {*}\n     */\n    get dataTypes() {\n        return this[dataTypesProperty];\n    }\n\n    /**\n     * Sets the current execution path\n     * @param {string} p\n     */\n    setExecutionPath(p) {\n        this[executionPathProperty] = p;\n    }\n\n    /**\n     * @returns {string}\n     */\n    getExecutionPath() {\n        return this[executionPathProperty];\n    }\n\n    /**\n     * Gets a boolean which indicates whether the specified data type is defined in data types collection or not.\n     * @param name\n     * @returns {boolean}\n     */\n    hasDataType(name) {\n        if (_.isNil(name)) {\n            return false;\n        }\n        if (typeof name !== 'string') {\n            return false;\n        }\n        return this.dataTypes.hasOwnProperty(name);\n    }\n\n    /**\n     * Gets the root configuration path\n     * @returns {string}\n     */\n    getConfigurationPath() {\n        return this[configPathProperty];\n    }\n\n    /**\n     * Gets a native object which represents the definition of the model with the given name.\n     * @param {string} name\n     * @returns {DataModel|undefined}\n     */\n    getModelDefinition(name) {\n        /**\n         * @type {SchemaLoaderStrategy}\n         */\n        const schemaLoader = this.getStrategy(SchemaLoaderStrategy);\n        return schemaLoader.getModelDefinition(name);\n    };\n\n    /**\n     * Sets a data model definition in application storage.\n     * Use this method in order to override default model loading process.\n     * @param {*} data - A generic object which represents a model definition\n     * @returns {DataConfiguration}\n     * @example\n     var most = require(\"most-data\");\n     most.cfg.getCurrent().setModelDefinition({\n            \"name\":\"UserColor\",\n            \"version\":\"1.1\",\n            \"title\":\"User Colors\",\n            \"fields\":[\n                { \"name\": \"id\", \"title\": \"Id\", \"type\": \"Counter\", \"nullable\": false, \"primary\": true },\n                { \"name\": \"user\", \"title\": \"User\", \"type\": \"User\", \"nullable\": false },\n                { \"name\": \"color\", \"title\": \"Color\", \"type\": \"Text\", \"nullable\": false, \"size\":12 },\n                { \"name\": \"tag\", \"title\": \"Tag\", \"type\": \"Text\", \"nullable\": false, \"size\":24 }\n                ],\n            \"constraints\":[\n                {\"type\":\"unique\", \"fields\": [ \"user\" ]}\n            ],\n            \"privileges\":[\n                { \"mask\":15, \"type\":\"self\",\"filter\":\"id eq me()\" }\n                ]\n        });\n     */\n    setModelDefinition(data) {\n        /**\n         * @type {SchemaLoaderStrategy}\n         */\n        const schemaLoader = this.getStrategy(SchemaLoaderStrategy);\n        schemaLoader.setModelDefinition(data);\n        return this;\n    };\n\n    /**\n     * Register a configuration strategy\n     * @param {Function} configStrategyCtor\n     * @param {Function} strategyCtor\n     * @returns DataConfiguration\n     */\n    useStrategy(configStrategyCtor, strategyCtor) {\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\n        Args.notFunction(strategyCtor,\"Strategy constructor\");\n        this[strategiesProperty][`${configStrategyCtor.name}`] = new strategyCtor(this);\n        return this;\n    }\n\n    /**\n     * Gets a configuration strategy\n     * @param {Function} configStrategyCtor\n     */\n    getStrategy(configStrategyCtor) {\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\n        return this[strategiesProperty][`${configStrategyCtor.name}`];\n    }\n\n    /**\n     * Gets a configuration strategy\n     * @param {Function} configStrategyCtor\n     */\n    hasStrategy(configStrategyCtor) {\n        Args.notFunction(configStrategyCtor,\"Configuration strategy constructor\");\n        return typeof this[strategiesProperty][`${configStrategyCtor.name}`] !== 'undefined';\n    }\n\n    /**\n     * @returns {*}\n     * @param name {string}\n     */\n    model(name) {\n        return this.getModelDefinition(name);\n    }\n    /**\n     * Gets the current data configuration\n     * @returns DataConfiguration - An instance of DataConfiguration class which represents the current data configuration\n     */\n    static getCurrent() {\n        if (_.isNil(DataConfiguration[currentConfiguration])) {\n            DataConfiguration[currentConfiguration] = new DataConfiguration();\n        }\n        return DataConfiguration[currentConfiguration];\n    }\n    /**\n     * Sets the current data configuration\n     * @param {DataConfiguration} configuration\n     * @returns DataConfiguration - An instance of DataConfiguration class which represents the current data configuration\n     */\n    static setCurrent(configuration) {\n        if (configuration instanceof DataConfiguration) {\n            if (!configuration.hasStrategy(SchemaLoaderStrategy)) {\n                configuration.useStrategy(SchemaLoaderStrategy, DefaultSchemaLoaderStrategy);\n            }\n            if (!configuration.hasStrategy(ModelClassLoaderStrategy)) {\n                configuration.useStrategy(ModelClassLoaderStrategy, DefaultModelClassLoaderStrategy);\n            }\n            if (!configuration.hasStrategy(ListenerLoaderStrategy)) {\n                configuration.useStrategy(ListenerLoaderStrategy, DefaultListenerLoaderStrategy);\n            }\n            DataConfiguration[currentConfiguration] = configuration;\n            return DataConfiguration[currentConfiguration];\n        }\n        throw new TypeError('Invalid argument. Expected an instance of DataConfiguration class.');\n    }\n\n}\n\n\nconst modelsProperty = Symbol('models');\n\nexport class SchemaLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n        this[modelsProperty] = new Map();\n        this.setModelDefinition({\n            \"name\":\"Migration\", \"title\":\"Data Model Migrations\", \"id\": 14,\n            \"source\":\"migrations\", \"view\":\"migrations\", \"hidden\": true, \"sealed\":true,\n            \"fields\":[\n                { \"name\":\"id\", \"type\":\"Counter\", \"primary\":true },\n                { \"name\":\"appliesTo\", \"type\":\"Text\", \"size\":180, \"nullable\":false },\n                { \"name\":\"model\", \"type\":\"Text\", \"size\":120 },\n                { \"name\":\"description\", \"type\":\"Text\", \"size\":512},\n                { \"name\":\"version\", \"type\":\"Text\", \"size\":40, \"nullable\":false }\n            ],\n            \"constraints\":[\n                { \"type\":\"unique\", \"fields\":[ \"appliesTo\", \"version\" ] }\n            ]\n        });\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @returns {*}\n     */\n    getModelDefinition(name) {\n        Args.notString(name,'Model name');\n        let result = this[modelsProperty].get(name);\n        if (typeof result !== 'undefined') {\n            return result;\n        }\n        //case insensitive search\n        const iterator = this[modelsProperty].keys();\n        let keyIt = iterator.next();\n        while(!keyIt.done) {\n            if ((typeof keyIt.value === 'string') && (keyIt.value.toLowerCase() === name.toLowerCase())) {\n                return this[modelsProperty].get(keyIt.value);\n            }\n            keyIt = iterator.next();\n        }\n    }\n\n    /**\n     *\n     * @param {*} data\n     * @returns {SchemaLoaderStrategy}\n     */\n    setModelDefinition(data) {\n        Args.notNull(data,'Model definition');\n        Args.notString(data.name,'Model name');\n        this[modelsProperty].set(data.name,data);\n        return this;\n    }\n\n}\n\nconst filesProperty = Symbol('files');\nconst modelPathProperty = Symbol('modelPath');\n\nexport class DefaultSchemaLoaderStrategy extends SchemaLoaderStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n        this[modelPathProperty] = PathUtils.join(config.getConfigurationPath(), 'models');\n    }\n\n    /**\n     * Gets a string which represents the directory which contains model definitions.\n     * @returns {*}\n     */\n    getModelPath() {\n        return this[modelPathProperty];\n    }\n\n    /**\n     * Sets the directory of model definitions.\n     * @param {string} p\n     * @returns {DefaultSchemaLoaderStrategy}\n     */\n    setModelPath(p) {\n        this[modelPathProperty] = p;\n        return this;\n    }\n\n    /**\n     *\n     * @param {string} name\n     * @returns {*}\n     */\n    getModelDefinition(name) {\n        const self = this,\n            getModelDefinitionSuper = super.getModelDefinition;\n        let i;\n        if (typeof name !== 'string')\n            return;\n        //exclude registered data types\n        if (this.getConfiguration().hasDataType(name)) {\n            return;\n        }\n        let modelDefinition = getModelDefinitionSuper.bind(this)(name);\n        //first of all try to find if model definition is already in cache\n        if (_.isObject(modelDefinition)) {\n            //and return it//and return it\n            return modelDefinition;\n        }\n        //otherwise open definition file\n        const modelPath = this.getModelPath();\n        //read files from models directory\n        //store file list in a private variable\n        if (typeof this[filesProperty] === 'undefined') {\n            const nativeFsModule = 'fs';\n            const fs = require(nativeFsModule);\n            if (typeof fs.readdirSync === 'function') {\n                this[filesProperty] = fs.readdirSync(modelPath);\n            }\n            else {\n                //try load model definition\n                try {\n                    modelDefinition = require(PathUtils.join(modelPath, name.concat('json')));\n                    this.setModelDefinition(modelDefinition);\n                }\n                catch(err) {\n                    //do nothing (log error)\n                    TraceUtils.error('An error occurred while loading definition for model %s.', name);\n                    TraceUtils.error(err);\n                }\n            }\n        }\n        //and finally get this list of file\n        const files = this[filesProperty];\n        if (files.length==0)\n            return;\n        const r = new RegExp('^' + name.concat('.json') + '$','i');\n        for (i = 0; i < files.length; i++) {\n            r.lastIndex=0;\n            if (r.test(files[i])) {\n                //build model file path\n                const finalPath = PathUtils.join(modelPath, files[i]);\n                //get model\n                const result = require(finalPath), finalName = result.name;\n                //set definition\n                this.setModelDefinition(result);\n                //and finally return this definition\n                return result;\n            }\n        }\n    }\n}\n\nexport class ModelClassLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n    }\n}\n\nexport class DefaultModelClassLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n    }\n\n    /**\n     * @param {DataModel} model\n     * @returns {Function}\n     */\n    resolve(model) {\n        Args.notNull(model, 'Model');\n        let DataObjectClass = this['DataObjectClass'];\n        if (_.isFunction(DataObjectClass)) {\n            return DataObjectClass;\n        }\n        //get model definition\n        const modelDefinition = this.getConfiguration().getStrategy(SchemaLoaderStrategy).getModelDefinition(model.name);\n        if (typeof model.classPath === 'string') {\n            modelDefinition['DataObjectClass'] = DataObjectClass = require(self.classPath);\n        }\n        else {\n            //try to find module by using capitalize naming convention\n            // e.g. OrderDetail -> OrderDetailModel.js\n            let classPath = PathUtils.join(this.getConfiguration().getExecutionPath(),'models',this.name.concat('Model.js'));\n            try {\n                modelDefinition['DataObjectClass'] = DataObjectClass = require(classPath);\n            }\n            catch(err) {\n                if (err.code === 'MODULE_NOT_FOUND') {\n                    try {\n                        //try to find module by using dasherize naming convention\n                        // e.g. OrderDetail -> order-detail-model.js\n                        classPath = PathUtils.join(rootPath,'models',_.dasherize(this.name).concat('-model.js'));\n                        modelDefinition['DataObjectClass'] = DataObjectClass = require(classPath);\n                    }\n                    catch(err) {\n                        if (err.code === 'MODULE_NOT_FOUND') {\n                            if (typeof this['inherits'] === 'undefined' || this['inherits'] == null) {\n                                //use default DataObject class\n                                modelDefinition['DataObjectClass'] = DataObjectClass = require('./object').DataObject;\n                            }\n                            else {\n                                modelDefinition['DataObjectClass'] = DataObjectClass = this.resolve(model.base());\n                            }\n                        }\n                        else {\n                            throw err;\n                        }\n                    }\n                }\n                else {\n                    throw err;\n                }\n            }\n        }\n        return DataObjectClass;\n    }\n\n}\n\nexport class ListenerLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n    }\n}\n\nexport class DefaultListenerLoaderStrategy extends ConfigurationStrategy {\n    /**\n     *\n     * @param {DataConfiguration} config\n     */\n    constructor(config) {\n        super(config);\n    }\n\n    /**\n     * @param {*} listener\n     * @returns {*}\n     */\n    resolve(listener) {\n        Args.notNull(model, 'Listener');\n        return require(PathUtils.join(this.getConfiguration().getExecutionPath(),'listeners',listener.type));\n    }\n\n}\n\n"]}