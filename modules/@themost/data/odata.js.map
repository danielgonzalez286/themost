{"version":3,"sources":["odata.es6"],"names":["_","ConfigurationStrategy","Args","DataConfigurationStrategy","SchemaLoaderStrategy","DataModel","DataContext","XDocument","Q","pluralize","nameProperty","Symbol","entityTypesProperty","entityContainerProperty","ignoreEntityTypesProperty","builderProperty","entityTypeProperty","edmProperty","SchemaDefaultNamespace","EdmType","EdmBinary","EdmBoolean","EdmByte","EdmDateTimeOffset","EdmDouble","EdmDecimal","EdmDuration","EdmGuid","EdmInt16","EdmInt32","EdmInt64","EdmSByte","EdmSingle","EdmStream","EdmString","EdmTimeOfDay","EdmMultiplicity","Many","One","Unknown","ZeroOrOne","EntitySetKind","EntitySet","Singleton","FunctionImport","EntityTypeConfiguration","name","notString","property","ignoredProperty","navigationProperty","baseType","type","nullable","exists","findIndex","x","p","isBoolean","push","assign","multiplicity","hasProperty","splice","key","isArray","propertyRef","hasKeyIndex","addProperty","EntitySetConfiguration","builder","entityType","check","ODataModelBuilder","TypeError","hasEntity","addEntity","kind","url","getEntity","config","hasEntitySet","getEntitySet","find","indexOf","hasOwnProperty","self","promise","resolve","reject","schema","namespace","entityContainer","keys","filter","forEach","entitySet","apply","err","all","getEdm","then","doc","rootElement","createElement","setAttribute","appendChild","dataServicesElement","schemaElement","entityTypeElement","concat","keyElement","keyRefElement","propertyElement","entityContainerElement","child","childElement","childAnnotation","getUrl","EntityDataContext","configuration","getConfiguration","dataTypes","definition","model","isNil","ODataConventionModelBuilder","superAddEntitySet","strategy","getStrategy","modelEntitySet","bind","modelEntityType","inheritedAttributes","inherits","addEntitySet","derivesFrom","baseModel","base","attributeNames","attributes","primary","mapping","inferMapping","dataType","edmType","isObject","hasKey","namespacedType","addNavigationProperty","many","schemaLoader","getModelPath","nativeFsModule","fs","require","modelPath","readdir","files","models","map","test","exec","superGetEdm","result","catch","ODataJsonFormatter"],"mappings":"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","file":"odata.js","sourcesContent":["/**\n * @license\n * MOST Web Framework 2.0 Codename Blueshift\n * Copyright (c) 2017, THEMOST LP All rights reserved\n *\n * Use of this source code is governed by an BSD-3-Clause license that can be\n * found in the LICENSE file at https://themost.io/license\n */\nimport _ from 'lodash';\nimport {ConfigurationStrategy} from '@themost/common/config';\nimport {Args} from \"@themost/common/utils\";\nimport {DataConfigurationStrategy, SchemaLoaderStrategy} from \"./config\";\nimport {DataModel} from \"./model\";\nimport {DataContext} from \"./types\";\nimport {XDocument} from 'most-xml';\nimport Q from 'q';\nconst nameProperty = Symbol('name');\nconst entityTypesProperty = Symbol('entityTypes');\nconst entityContainerProperty = Symbol('entityContainer');\nconst ignoreEntityTypesProperty = Symbol('ignoredEntityTypes');\nconst builderProperty = Symbol('builder');\nconst entityTypeProperty = Symbol('entityType');\nconst edmProperty = Symbol('edm');\nimport pluralize from 'pluralize';\n\nconst SchemaDefaultNamespace = \"Edm.Models\";\n\n/**\n * @class\n * @abstract\n */\nexport class EdmType {\n\n}\n\nEdmType.EdmBinary = \"Edm.Binary\";\nEdmType.EdmBoolean=\"Edm.Boolean\";\nEdmType.EdmByte=\"Edm.Byte\";\nEdmType.EdmBoolean=\"Edm.Date\";\nEdmType.EdmDateTimeOffset=\"Edm.DateTimeOffset\";\nEdmType.EdmDouble=\"Edm.Double\";\nEdmType.EdmDecimal=\"Edm.Decimal\";\nEdmType.EdmDuration=\"Edm.Duration\";\nEdmType.EdmGuid=\"Edm.Guid\";\nEdmType.EdmInt16=\"Edm.Int16\";\nEdmType.EdmInt32=\"Edm.Int32\";\nEdmType.EdmInt64=\"Edm.Int64\";\nEdmType.EdmSByte=\"Edm.SByte\";\nEdmType.EdmSingle=\"Edm.Single\";\nEdmType.EdmStream=\"Edm.Stream\";\nEdmType.EdmString=\"Edm.String\";\nEdmType.EdmTimeOfDay=\"Edm.TimeOfDay\";\n\n/**\n * @enum\n */\nexport class EdmMultiplicity {\n\n}\nEdmMultiplicity.Many = \"Many\";\nEdmMultiplicity.One = \"One\";\nEdmMultiplicity.Unknown = \"Unknown\";\nEdmMultiplicity.ZeroOrOne = \"ZeroOrOne\";\n\n/**\n * @enum\n */\nexport class EntitySetKind {\n\n}\nEntitySetKind.EntitySet = \"EntitySet\";\nEntitySetKind.Singleton = \"Singleton\";\nEntitySetKind.FunctionImport = \"FunctionImport\";\n\n/**\n * @class\n */\nexport class EntityTypeConfiguration {\n    /**\n     *\n     * @param {string} name\n     */\n    constructor(name) {\n        Args.notString(name, 'Entity type name');\n        this[nameProperty] = name;\n        this.property = [];\n        this.ignoredProperty = [];\n        this.navigationProperty = [];\n    }\n\n    get name() {\n        return this[nameProperty];\n    }\n\n    /**\n     * @param {string} name\n     */\n    derivesFrom(name) {\n        Args.notString(name,\"Enity type name\");\n        this.baseType = name;\n    }\n\n    /**\n     * Adds a new EDM primitive property to this entity type.\n     * @param {string} name\n     * @param {string} type\n     * @param {boolean=} nullable\n     * @returns EntityTypeConfiguration\n     */\n    addProperty(name, type, nullable) {\n        Args.notString(name,\"Property name\");\n        const exists =_.findIndex(this.property, (x)=> {\n            return x.name === name;\n        });\n        if (exists<0) {\n            const p = {\n                \"name\":name,\n                \"type\":type,\n                \"nullable\":_.isBoolean(nullable) ? nullable : true\n            };\n            this.property.push(p);\n        }\n        else {\n            _.assign(this.property[exists], {\n                \"type\":type,\n                \"nullable\":_.isBoolean(nullable) ? nullable : true\n            });\n        }\n        return this;\n    }\n\n    /**\n     * Adds a new EDM navigation property to this entity type.\n     * @param {string} name\n     * @param {string} type\n     * @param {string} multiplicity\n     * @returns EntityTypeConfiguration\n     */\n    addNavigationProperty(name, type, multiplicity) {\n        Args.notString(name,\"Property name\");\n        const exists =_.findIndex(this.navigationProperty, (x)=> {\n            return x.name === name;\n        });\n\n        const p = {\n            \"name\":name,\n            \"type\": (multiplicity===\"Many\") ? `Collection(${type})` : type\n        };\n        if (multiplicity===EdmMultiplicity.ZeroOrOne) {\n            p.nullable = true;\n        }\n\n        if (exists<0) {\n            this.navigationProperty.push(p);\n        }\n        else {\n            _.assign(this.navigationProperty[exists], p);\n        }\n        return this;\n    }\n\n    /**\n     * Removes the navigation property from the entity.\n     * @param {string} name\n     * @returns {EntityTypeConfiguration}\n     */\n    removeNavigationProperty(name) {\n        Args.notString(name,\"Property name\");\n        const hasProperty =_.findIndex(this.property, (x)=> {\n            return x.name === name;\n        });\n        if (hasProperty>=0) {\n            this.property.splice(hasProperty, 1);\n        }\n        return this;\n    }\n\n    /**\n     * Ignores a property from the entity\n     * @param name\n     * @returns {EntityTypeConfiguration}\n     */\n    ignore(name) {\n        Args.notString(name,\"Property name\");\n        const hasProperty =_.findIndex(this.ignoredProperty, (x)=> {\n            return x.name === name;\n        });\n        if (hasProperty>=0) {\n            return this;\n        }\n        this.ignoredProperty.push(name);\n\n    }\n\n    /**\n     * Removes the property from the entity.\n     * @param {string} name\n     * @returns {EntityTypeConfiguration}\n     */\n    removeProperty(name) {\n        Args.notString(name,\"Property name\");\n        const hasProperty =_.findIndex(this.property, (x)=> {\n            return x.name === name;\n        });\n        if (hasProperty>=0) {\n            this.property.splice(hasProperty, 1);\n        }\n        return this;\n    }\n\n    /**\n     * Removes the property from the entity keys collection.\n     * @param {string} name\n     * @returns {EntityTypeConfiguration}\n     */\n    removeKey(name) {\n        Args.notString(name,\"Key name\");\n        if (this.key && _.isArray(this.key.propertyRef)) {\n            const hasKeyIndex = _.findIndex(this.key.propertyRef, (x)=> {\n                return x.name === name;\n            });\n            if (hasKeyIndex<0) {\n                return this;\n            }\n            this.key.propertyRef.splice(hasKeyIndex, 1);\n            return this;\n        }\n    }\n\n    /**\n     * Configures the key property(s) for this entity type.\n     * @param {string} name\n     * @param {string} type\n     * @returns {EntityTypeConfiguration}\n     */\n    hasKey(name, type) {\n        this.addProperty(name, type, false);\n        this.key = {\n            propertyRef: [\n                {\n                    \"name\": name\n                }\n            ]\n        };\n        return this;\n    }\n\n}\n\n/**\n *\n */\nexport class EntitySetConfiguration {\n    /**\n     * @param {ODataModelBuilder} builder\n     * @param {string} entityType\n     * @param {string} name\n     */\n    constructor(builder, entityType, name) {\n        Args.check(builder instanceof ODataModelBuilder, new TypeError('Invalid argument. Configuration builder must be an instance of ODataModelBuilder class'));\n        Args.notString(entityType, 'Entity Type');\n        Args.notString(name, 'EntitySet Name');\n        this[builderProperty] = builder;\n        this[entityTypeProperty] = entityType;\n        //ensure entity type\n        if (!this[builderProperty].hasEntity(this[entityTypeProperty])) {\n            this[builderProperty].addEntity(this[entityTypeProperty]);\n        }\n        this.name = name;\n        this.kind = EntitySetKind.EntitySet;\n        //use the given name as entity set URL by default\n        this.url = name;\n    }\n\n    hasUrl(url) {\n        Args.notString(url, 'Entity Resource Path');\n        this.url = url;\n    }\n\n    getUrl() {\n        return this.url;\n    }\n\n    /**\n     * @returns {EntityTypeConfiguration}\n     */\n    get entityType() {\n        if (!this[builderProperty].hasEntity(this[entityTypeProperty])) {\n            return this[builderProperty].addEntity(this[entityTypeProperty]);\n        }\n        return this[builderProperty].getEntity(this[entityTypeProperty]);\n    }\n\n}\n\n/**\n * @classdesc Represents the OData model builder of an HTTP application\n * @class\n */\nexport class ODataModelBuilder extends ConfigurationStrategy {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n        this[entityTypesProperty] = {};\n        this[ignoreEntityTypesProperty] = [];\n        this[entityContainerProperty] = [];\n    }\n\n    /**\n     * Gets a registered entity type\n     * @param {string} name\n     * @returns {EntityTypeConfiguration}\n     */\n    getEntity(name) {\n        Args.notString(name, 'Entity type name');\n        return this[entityTypesProperty][name];\n    }\n\n    /**\n     * Registers an entity type\n     * @param {string} name\n     * @returns {EntityTypeConfiguration}\n     */\n    addEntity(name) {\n        if (!this.hasEntity(name)) {\n            this[entityTypesProperty][name] = new EntityTypeConfiguration(name);\n        }\n        return this.getEntity(name)\n    }\n\n    /**\n     * Checks if the given entity set exists in entity container\n     * @param {string} name\n     * @returns {boolean}\n     */\n    hasEntitySet(name) {\n        return _.findIndex(this[entityContainerProperty], (x) => {\n            return x.name === name;\n        })>=0;\n    }\n\n    /**\n     * Registers an entity type\n     * @param {string} entityType\n     * @param {string} name\n     * @returns {EntitySetConfiguration}\n     */\n    addEntitySet(entityType, name) {\n        if (!this.hasEntitySet(name)) {\n            this[entityContainerProperty].push(new EntitySetConfiguration(this, entityType, name));\n        }\n        return this.getEntitySet(name);\n    }\n\n    /**\n     * Gets an entity set\n     * @param name\n     * @returns {EntitySetConfiguration}\n     */\n    getEntitySet(name) {\n        Args.notString(name, 'EntitySet Name');\n        return _.find(this[entityContainerProperty], (x)=> {\n            return x.name === name;\n        });\n    }\n\n    /**\n     * Ignores the entity type with the given name\n     * @param {string} name\n     * @returns {ODataModelBuilder}\n     */\n    ignore(name) {\n        const hasEntity = this[ignoreEntityTypesProperty].indexOf(name);\n        if (hasEntity < 0) {\n            this[ignoreEntityTypesProperty].push(name);\n        }\n        return this;\n    }\n\n    /**\n     * Checks if the given entity type exists in entity's collection\n     * @param {string} name\n     * @returns {boolean}\n     */\n    hasEntity(name) {\n        return this[entityTypesProperty].hasOwnProperty(name);\n    }\n\n    /**\n     * Creates and returns a structure based on the configuration performed using this builder\n     * @returns {Promise}\n     */\n    getEdm() {\n        const self = this;\n        return Q.promise((resolve, reject) => {\n            try{\n                const schema = {\n                    namespace:SchemaDefaultNamespace,\n                    entityType:[],\n                    entityContainer: {\n                        \"name\":\"DefaultContainer\",\n                        \"entitySet\":[]\n                    }\n                };\n                //get entity types by excluding ignored entities\n                const keys = _.filter(_.keys(self[entityTypesProperty]), (x)=> {\n                    return self[ignoreEntityTypesProperty].indexOf(x)<0;\n                });\n                //enumerate entity types\n                _.forEach(keys, (key)=> {\n                    schema.entityType.push(self[entityTypesProperty][key]);\n                });\n                //enumerate entity sets\n                schema.entityContainer.entitySet.push.apply(schema.entityContainer.entitySet, self[entityContainerProperty]);\n\n                return resolve(schema);\n            }\n            catch(err) {\n                return reject(err);\n            }\n        });\n    }\n\n    /**\n     * @param {boolean=} all\n     * @returns {ODataModelBuilder}\n     */\n    clean(all) {\n        delete this[edmProperty];\n        if (typeof all === 'boolean' && all === true) {\n            this[entityTypesProperty] = {};\n            this[ignoreEntityTypesProperty] = [];\n            this[entityContainerProperty] = [];\n        }\n        return this;\n    }\n\n    /**\n     * Creates and returns an XML structure based on the configuration performed using this builder\n     * @returns {Promise<XDocument>}\n     */\n    getEdmDocument() {\n        const self = this;\n        return Q.promise((resolve, reject) => {\n            try{\n                return self.getEdm().then((schema)=> {\n                    const doc = new XDocument();\n                    const rootElement = doc.createElement(\"edmx:Edmx\");\n                    rootElement.setAttribute(\"xmlns:edmx\", \"http://docs.oasis-open.org/odata/ns/edmx\");\n                    rootElement.setAttribute(\"Version\",\"4.0\");\n                    doc.appendChild(rootElement);\n\n                    const dataServicesElement = doc.createElement(\"edmx:DataServices\");\n                    const schemaElement = doc.createElement(\"Schema\");\n                    schemaElement.setAttribute(\"xmlns\", \"http://docs.oasis-open.org/odata/ns/edm\");\n                    schemaElement.setAttribute(\"Namespace\", schema.namespace);\n                    //schemaElement.setAttribute(\"Namespace\", \"Most.Data.Models\");\n\n                    //append edmx:DataServices > Schema\n                    dataServicesElement.appendChild(schemaElement);\n                    _.forEach(schema.entityType,\n                        /**\n                         *\n                         * @param {EntityTypeConfiguration} entityType\n                         */\n                        (entityType) => {\n\n                            //create element Schema > EntityType\n                            const entityTypeElement = doc.createElement(\"EntityType\");\n                            entityTypeElement.setAttribute(\"Name\", entityType.name);\n                            entityTypeElement.setAttribute(\"OpenType\", true);\n                            if (entityType.baseType) {\n                                entityTypeElement.setAttribute(\"BaseType\", schema.namespace.concat(\".\", entityType.baseType));\n                            }\n\n                            if (entityType.key && entityType.key.propertyRef) {\n                                const keyElement = doc.createElement('Key');\n                                _.forEach(entityType.key.propertyRef, (key)=> {\n                                    const keyRefElement = doc.createElement('PropertyRef');\n                                    keyRefElement.setAttribute(\"Name\",key.name);\n                                    keyElement.appendChild(keyRefElement);\n                                });\n                                entityTypeElement.appendChild(keyElement);\n                            }\n                            //enumerate properties\n                            _.forEach(entityType.property, function(x) {\n                                const propertyElement = doc.createElement('Property');\n                                propertyElement.setAttribute(\"Name\",x.name);\n                                propertyElement.setAttribute(\"Type\",x.type);\n                                if (_.isBoolean(x.nullable) && (x.nullable===false)) {\n                                    propertyElement.setAttribute(\"Nullable\",false);\n                                }\n                                entityTypeElement.appendChild(propertyElement);\n                            });\n                            //enumerate navigation properties\n                            _.forEach(entityType.navigationProperty, function(x) {\n                                const propertyElement = doc.createElement('NavigationProperty');\n                                propertyElement.setAttribute(\"Name\",x.name);\n                                propertyElement.setAttribute(\"Type\",x.type);\n                                if (!x.nullable) {\n                                    propertyElement.setAttribute(\"Nullable\",false);\n                                }\n                                entityTypeElement.appendChild(propertyElement);\n                            });\n                            //append Schema > EntityType\n                            schemaElement.appendChild(entityTypeElement);\n                        });\n\n                    //create Schema > EntityContainer\n                    const entityContainerElement = doc.createElement(\"EntityContainer\");\n                    entityContainerElement.setAttribute(\"Name\", schema.entityContainer.name || \"DefaultContainer\");\n\n                    _.forEach(schema.entityContainer.entitySet,\n                        /**\n                         * @param {EntitySetConfiguration} child\n                         */\n                        (child) => {\n                            const childElement = doc.createElement(child.kind);\n                            childElement.setAttribute(\"Name\", child.name);\n                            if ((child.kind === EntitySetKind.EntitySet) || (child.kind === EntitySetKind.Singleton)) {\n                                childElement.setAttribute(\"EntityType\", schema.namespace.concat(\".\", child.entityType.name));\n                            }\n                            const childAnnotation = doc.createElement(\"Annotation\");\n                            childAnnotation.setAttribute(\"Term\", \"Org.OData.Core.V1.ResourcePath\");\n                            childAnnotation.setAttribute(\"String\", child.getUrl());\n                            childElement.appendChild(childAnnotation);\n                            //append Schema > EntityContainer > (EntitySet, Singleton, FunctionImport)\n                            entityContainerElement.appendChild(childElement);\n                        });\n\n                    //append Schema > EntityContainer\n                    schemaElement.appendChild(entityContainerElement);\n\n                    //append edmx:Edmx > edmx:DataServices\n                    rootElement.appendChild(dataServicesElement);\n                    return resolve(doc);\n                });\n            }\n            catch(err) {\n                return reject(err);\n            }\n        });\n\n    }\n\n}\n\nclass EntityDataContext extends DataContext {\n    /**\n     * @param {DataConfigurationStrategy=} configuration\n     */\n    constructor(configuration) {\n        super();\n        this.getConfiguration = ()=> configuration;\n    }\n\n    model(name) {\n        if (this.getConfiguration().dataTypes.hasOwnProperty(name)) {\n            return;\n        }\n        const definition = this.getConfiguration().model(name);\n        if (_.isNil(definition)) {\n            return;\n        }\n        return new DataModel(definition, this);\n    }\n\n}\n\n/**\n * @class\n * @augments ODataModelBuilder\n */\nexport class ODataConventionModelBuilder extends ODataModelBuilder {\n    /**\n     *\n     * @param {ConfigurationBase} config\n     */\n    constructor(config) {\n        super(config);\n    }\n\n    /**\n     * Automatically registers an entity type from the given model\n     * @param {string} entityType\n     * @param {string} name\n     * @returns {EntitySetConfiguration}\n     */\n    addEntitySet(entityType, name) {\n        const self = this;\n        const superAddEntitySet = super.addEntitySet;\n        /**\n         * @type {EntityTypeConfiguration}\n         */\n        if (this.hasEntitySet(name)) {\n            return this.getEntitySet(name);\n        }\n        /**\n         * @type {DataConfigurationStrategy|*}\n         */\n        const strategy = self.getConfiguration().getStrategy(DataConfigurationStrategy);\n        if (strategy) {\n            let modelEntitySet = superAddEntitySet.bind(self)(entityType, name);\n            /**\n             * @type {EntityTypeConfiguration}\n             */\n            let modelEntityType = modelEntitySet.entityType;\n            /**\n             * @type {DataModel}\n             */\n            const definition = strategy.model(entityType);\n            if (definition) {\n                const model = new DataModel(definition, new EntityDataContext(strategy));\n                let inheritedAttributes = [];\n                if (model.inherits) {\n                    //add base entity\n                    self.addEntitySet(model.inherits, pluralize(model.inherits));\n                    //set inheritance\n                    modelEntityType.derivesFrom(model.inherits);\n                    const baseModel = model.base();\n                    if (baseModel) {\n                        inheritedAttributes = baseModel.attributeNames;\n                    }\n                }\n                _.forEach(_.filter(model.attributes, function(x) {\n                    if (x.primary && model.inherits) {\n                        return false;\n                    }\n                    return (x.model === model.name) && (inheritedAttributes.indexOf(x.name)<0);\n                }), function(x) {\n                    const name = x.property || x.name;\n                    const mapping = model.inferMapping(x.name);\n                    if (_.isNil(mapping)) {\n                        //find data type\n                        const dataType = strategy.dataTypes[x.type];\n                        //add property\n                        const edmType = _.isObject(dataType) ? (dataType.hasOwnProperty(\"edmtype\") ? dataType[\"edmtype\"]: \"Edm.\" + x.type) : SchemaDefaultNamespace.concat(\".\",x.type);\n                        modelEntityType.addProperty(name, edmType, x.nullable);\n                        if (x.primary) {\n                            modelEntityType.hasKey(name, edmType);\n                        }\n                    }\n                    else {\n                        const namespacedType = SchemaDefaultNamespace.concat(\".\",x.type);\n                        //add navigation property\n                        modelEntityType.addNavigationProperty(name, namespacedType, x.many ? EdmMultiplicity.Many: EdmMultiplicity.One);\n                        //add navigation property entity (if type is not a primitive type)\n                        if (!strategy.dataTypes.hasOwnProperty(x.type)) {\n                            self.addEntitySet(x.type, pluralize(x.type));\n                        }\n                    }\n                });\n            }\n            return modelEntitySet;\n        }\n        return superAddEntitySet.bind(self)(entityType, name);\n    }\n\n    /**\n     * @returns {Promise}\n     */\n    initialize() {\n        const self = this;\n        return Q.promise((resolve, reject) => {\n            /**\n             * @type {SchemaLoaderStrategy|DefaultSchemaLoaderStrategy|*}\n             */\n            const schemaLoader = self.getConfiguration().getStrategy(SchemaLoaderStrategy);\n            if (typeof schemaLoader.getModelPath === 'function') {\n                const nativeFsModule = 'fs';\n                const fs = require(nativeFsModule);\n                const modelPath = schemaLoader.getModelPath();\n                if (_.isNil(modelPath)) {\n                    return resolve();\n                }\n                return fs.readdir(modelPath, (err, files) => {\n                    try {\n                        if (err) {\n                            return reject(err);\n                        }\n                        const models = _.map( _.filter(files, function(x) {\n                            return /\\.json$/.test(x);\n                        }), (x) => {\n                            return /(.*?)\\.json$/.exec(x)[1];\n                        });\n                        _.forEach(models, (x)=> {\n                            if (!_.isNil(x)) {\n                                self.addEntitySet(x, pluralize(x));\n                            }\n                        });\n                        return resolve();\n                    }\n                    catch(err) {\n                        return reject(err);\n                    }\n                });\n            }\n            return resolve();\n        });\n\n    }\n\n    /**\n     * Creates and returns a structure based on the configuration performed using this builder\n     * @returns {Promise}\n     */\n    getEdm() {\n        const self = this, superGetEdm = super.getEdm;\n        return Q.promise((resolve, reject) => {\n            try{\n                if (_.isObject(self[edmProperty])) {\n                    return resolve(self[edmProperty]);\n                }\n                return superGetEdm.bind(self)().then((result) => {\n                    self[edmProperty] = result;\n                    return resolve(self[edmProperty]);\n                }).catch((err)=> {\n                    return reject(err);\n                });\n            }\n            catch(err) {\n                return reject(err);\n            }\n        });\n    }\n}\n\nexport class ODataJsonFormatter {\n\n}"]}